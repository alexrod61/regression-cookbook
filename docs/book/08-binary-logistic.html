<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Binary Logistic Regression – The Regression Cookbook (in development)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../book/09-binomial-logistic.html" rel="next">
<link href="../book/discrete-zone.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script><script src="../site_libs/quarto-diagram/mermaid-init.js"></script><link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../custom.css">
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">The Regression Cookbook (in development)</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
    <a href="https://github.com/alexrod61/regression-cookbook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../book/discrete-zone.html">Discrete Cuisine</a></li><li class="breadcrumb-item"><a href="../book/08-binary-logistic.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Binary Logistic Regression</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../img/cookbook.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/meet-the-team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Meet the Team</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/privacy-policy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Website Privacy Policy</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/audience-scope.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Audience and Scope</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Ready for Regression Cooking!</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/02-stats-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Basic Cuisine: A Review on Probability and Frequentist Statistical Inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../book/continuous-zone.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Continuous Cuisine</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/03-ols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Ordinary Least-squares Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/04-gamma.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Gamma Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/05-beta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Soup-erb Beta Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/06-parametric-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Crunchified Parametric Survival Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/07-semiparametric-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Butteryfied Semiparametric Survival Regression</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../book/discrete-zone.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Discrete Cuisine</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/08-binary-logistic.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Binary Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/09-binomial-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Cheesified Binomial Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/10-classical-poisson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Classical Poisson Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/11-negative-binomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Umami-zing Negative Binomial Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/12-zero-inflated-poisson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Spicetacular Zero-Inflated Poisson Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/13-generalized-poisson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Herbalicious Generalized Poisson Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/14-multinomial-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Multinomial Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/15-ordinal-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Tang-tastic Ordinal Logistic Regression</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/A-dictionary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">ML-Stats Dictionary</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/B-greek-alphabet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Greek Alphabet</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/C-distributional-mind-map.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Distributional Mind Map</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/D-regression-mind-map.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Regression Mind Map</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">The recipe</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">8.1</span> Introduction</a></li>
  <li><a href="#why-ordinary-least-squares-fails-for-binary-outcomes" id="toc-why-ordinary-least-squares-fails-for-binary-outcomes" class="nav-link" data-scroll-target="#why-ordinary-least-squares-fails-for-binary-outcomes"><span class="header-section-number">8.2</span> Why Ordinary Least Squares Fails for Binary Outcomes</a></li>
  <li>
<a href="#the-logit-function" id="toc-the-logit-function" class="nav-link" data-scroll-target="#the-logit-function"><span class="header-section-number">8.3</span> The Logit Function</a>
  <ul>
<li><a href="#logit-a-link-between-probability-and-linear-predictors" id="toc-logit-a-link-between-probability-and-linear-predictors" class="nav-link" data-scroll-target="#logit-a-link-between-probability-and-linear-predictors"><span class="header-section-number">8.3.1</span> Logit: A Link Between Probability and Linear Predictors</a></li>
  <li><a href="#from-log-odds-back-to-probability" id="toc-from-log-odds-back-to-probability" class="nav-link" data-scroll-target="#from-log-odds-back-to-probability"><span class="header-section-number">8.3.2</span> From Log-Odds Back to Probability</a></li>
  <li><a href="#understanding-the-s-shape" id="toc-understanding-the-s-shape" class="nav-link" data-scroll-target="#understanding-the-s-shape"><span class="header-section-number">8.3.3</span> Understanding the “S” Shape</a></li>
  <li><a href="#the-logistic-function-and-its-shape-code" id="toc-the-logistic-function-and-its-shape-code" class="nav-link" data-scroll-target="#the-logistic-function-and-its-shape-code"><span class="header-section-number">8.3.4</span> The Logistic Function and Its Shape (Code)</a></li>
  </ul>
</li>
  <li>
<a href="#case-study-understanding-financial-behaviors" id="toc-case-study-understanding-financial-behaviors" class="nav-link" data-scroll-target="#case-study-understanding-financial-behaviors"><span class="header-section-number">8.4</span> Case Study: Understanding Financial Behaviors</a>
  <ul>
<li>
<a href="#case-study-setup-data-goal" id="toc-case-study-setup-data-goal" class="nav-link" data-scroll-target="#case-study-setup-data-goal"><span class="header-section-number">8.4.1</span> Case Study Setup: Data + Goal</a>
  <ul class="collapse">
<li><a href="#why-probability-matters-asymmetric-costs" id="toc-why-probability-matters-asymmetric-costs" class="nav-link" data-scroll-target="#why-probability-matters-asymmetric-costs">Why probability matters: asymmetric costs</a></li>
  </ul>
</li>
  <li>
<a href="#study-design-and-data-prep" id="toc-study-design-and-data-prep" class="nav-link" data-scroll-target="#study-design-and-data-prep"><span class="header-section-number">8.4.2</span> Study Design and Data Prep</a>
  <ul class="collapse">
<li><a href="#study-design-high-level" id="toc-study-design-high-level" class="nav-link" data-scroll-target="#study-design-high-level">Study design (high-level)</a></li>
  <li><a href="#data-preparation-steps" id="toc-data-preparation-steps" class="nav-link" data-scroll-target="#data-preparation-steps">Data preparation steps</a></li>
  <li><a href="#influential-points-and-outliers" id="toc-influential-points-and-outliers" class="nav-link" data-scroll-target="#influential-points-and-outliers">Influential points and outliers</a></li>
  </ul>
</li>
  <li><a href="#data-preparation-in-action" id="toc-data-preparation-in-action" class="nav-link" data-scroll-target="#data-preparation-in-action"><span class="header-section-number">8.4.3</span> Data Preparation in Action</a></li>
  </ul>
</li>
  <li>
<a href="#fitting-the-binary-logistic-regression-model" id="toc-fitting-the-binary-logistic-regression-model" class="nav-link" data-scroll-target="#fitting-the-binary-logistic-regression-model"><span class="header-section-number">8.5</span> Fitting the Binary Logistic Regression Model</a>
  <ul>
<li><a href="#model-specification" id="toc-model-specification" class="nav-link" data-scroll-target="#model-specification"><span class="header-section-number">8.5.1</span> Model Specification</a></li>
  <li><a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model"><span class="header-section-number">8.5.2</span> Fitting the Model</a></li>
  <li><a href="#model-output-interpretation" id="toc-model-output-interpretation" class="nav-link" data-scroll-target="#model-output-interpretation"><span class="header-section-number">8.5.3</span> Model Output Interpretation</a></li>
  </ul>
</li>
  <li>
<a href="#interpreting-model-results-log-odds-and-odds-ratios" id="toc-interpreting-model-results-log-odds-and-odds-ratios" class="nav-link" data-scroll-target="#interpreting-model-results-log-odds-and-odds-ratios"><span class="header-section-number">8.6</span> Interpreting Model Results: Log-Odds and Odds Ratios</a>
  <ul>
<li><a href="#the-log-odds-output" id="toc-the-log-odds-output" class="nav-link" data-scroll-target="#the-log-odds-output"><span class="header-section-number">8.6.1</span> The “Log-Odds” Output</a></li>
  <li><a href="#from-log-odds-to-odds-ratios" id="toc-from-log-odds-to-odds-ratios" class="nav-link" data-scroll-target="#from-log-odds-to-odds-ratios"><span class="header-section-number">8.6.2</span> From Log-Odds to Odds Ratios</a></li>
  <li><a href="#a-simplified-model-for-interpretation" id="toc-a-simplified-model-for-interpretation" class="nav-link" data-scroll-target="#a-simplified-model-for-interpretation"><span class="header-section-number">8.6.3</span> A Simplified Model for Interpretation</a></li>
  </ul>
</li>
  <li><a href="#from-log-odds-to-probabilities-simple-model" id="toc-from-log-odds-to-probabilities-simple-model" class="nav-link" data-scroll-target="#from-log-odds-to-probabilities-simple-model"><span class="header-section-number">8.7</span> From Log-Odds to Probabilities (Simple Model)</a></li>
  <li>
<a href="#data-preparation-and-wrangling" id="toc-data-preparation-and-wrangling" class="nav-link" data-scroll-target="#data-preparation-and-wrangling"><span class="header-section-number">8.8</span> Data Preparation and Wrangling</a>
  <ul>
<li><a href="#handling-missing-data" id="toc-handling-missing-data" class="nav-link" data-scroll-target="#handling-missing-data"><span class="header-section-number">8.8.1</span> Handling Missing Data</a></li>
  <li><a href="#encoding-categorical-variables" id="toc-encoding-categorical-variables" class="nav-link" data-scroll-target="#encoding-categorical-variables"><span class="header-section-number">8.8.2</span> Encoding Categorical Variables</a></li>
  <li><a href="#splitting-the-data" id="toc-splitting-the-data" class="nav-link" data-scroll-target="#splitting-the-data"><span class="header-section-number">8.8.3</span> Splitting the Data</a></li>
  </ul>
</li>
  <li>
<a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda"><span class="header-section-number">8.9</span> Exploratory Data Analysis (EDA)</a>
  <ul>
<li><a href="#classifying-variables" id="toc-classifying-variables" class="nav-link" data-scroll-target="#classifying-variables"><span class="header-section-number">8.9.1</span> Classifying Variables</a></li>
  <li><a href="#visualizing-distributions" id="toc-visualizing-distributions" class="nav-link" data-scroll-target="#visualizing-distributions"><span class="header-section-number">8.9.2</span> Visualizing Distributions</a></li>
  <li><a href="#exploring-relationships-with-binary-outcome" id="toc-exploring-relationships-with-binary-outcome" class="nav-link" data-scroll-target="#exploring-relationships-with-binary-outcome"><span class="header-section-number">8.9.3</span> Exploring Relationships with Binary Outcome</a></li>
  <li><a href="#what-the-correlation-plot-tells-us-and-what-it-doesnt" id="toc-what-the-correlation-plot-tells-us-and-what-it-doesnt" class="nav-link" data-scroll-target="#what-the-correlation-plot-tells-us-and-what-it-doesnt"><span class="header-section-number">8.9.4</span> What the Correlation Plot Tells Us (and What It Doesn’t)</a></li>
  </ul>
</li>
  <li>
<a href="#data-modelling" id="toc-data-modelling" class="nav-link" data-scroll-target="#data-modelling"><span class="header-section-number">8.10</span> Data Modelling</a>
  <ul>
<li><a href="#model-setup-distribution-link" id="toc-model-setup-distribution-link" class="nav-link" data-scroll-target="#model-setup-distribution-link"><span class="header-section-number">8.10.1</span> Model setup: distribution + link</a></li>
  <li><a href="#parameters-and-interpretation-scope" id="toc-parameters-and-interpretation-scope" class="nav-link" data-scroll-target="#parameters-and-interpretation-scope"><span class="header-section-number">8.10.2</span> Parameters and interpretation scope</a></li>
  </ul>
</li>
  <li>
<a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation"><span class="header-section-number">8.11</span> Estimation</a>
  <ul>
<li><a href="#maximum-likelihood-estimation-mle" id="toc-maximum-likelihood-estimation-mle" class="nav-link" data-scroll-target="#maximum-likelihood-estimation-mle"><span class="header-section-number">8.11.1</span> Maximum Likelihood Estimation (MLE)</a></li>
  </ul>
</li>
  <li>
<a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference"><span class="header-section-number">8.12</span> Inference</a>
  <ul>
<li><a href="#wald-tests" id="toc-wald-tests" class="nav-link" data-scroll-target="#wald-tests"><span class="header-section-number">8.12.1</span> Wald Tests</a></li>
  <li><a href="#likelihood-ratio-tests" id="toc-likelihood-ratio-tests" class="nav-link" data-scroll-target="#likelihood-ratio-tests"><span class="header-section-number">8.12.2</span> Likelihood Ratio Tests</a></li>
  <li><a href="#confidence-intervals" id="toc-confidence-intervals" class="nav-link" data-scroll-target="#confidence-intervals"><span class="header-section-number">8.12.3</span> Confidence Intervals</a></li>
  <li>
<a href="#interpreting-the-inference-results" id="toc-interpreting-the-inference-results" class="nav-link" data-scroll-target="#interpreting-the-inference-results"><span class="header-section-number">8.12.4</span> Interpreting the Inference Results</a>
  <ul class="collapse">
<li><a href="#wald-tests-individual-predictor-significance" id="toc-wald-tests-individual-predictor-significance" class="nav-link" data-scroll-target="#wald-tests-individual-predictor-significance">Wald Tests: Individual Predictor Significance</a></li>
  <li><a href="#likelihood-ratio-test-is-the-full-model-better" id="toc-likelihood-ratio-test-is-the-full-model-better" class="nav-link" data-scroll-target="#likelihood-ratio-test-is-the-full-model-better">Likelihood Ratio Test: Is the Full Model Better?</a></li>
  <li><a href="#confidence-intervals-for-odds-ratios" id="toc-confidence-intervals-for-odds-ratios" class="nav-link" data-scroll-target="#confidence-intervals-for-odds-ratios">Confidence Intervals for Odds Ratios</a></li>
  <li><a href="#practical-implications" id="toc-practical-implications" class="nav-link" data-scroll-target="#practical-implications">Practical Implications</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#coefficient-interpretation" id="toc-coefficient-interpretation" class="nav-link" data-scroll-target="#coefficient-interpretation"><span class="header-section-number">8.13</span> Coefficient Interpretation</a>
  <ul>
<li><a href="#odds-ratios-and-their-meaning" id="toc-odds-ratios-and-their-meaning" class="nav-link" data-scroll-target="#odds-ratios-and-their-meaning"><span class="header-section-number">8.13.1</span> Odds Ratios and Their Meaning</a></li>
  <li><a href="#pitfalls-in-interpretation" id="toc-pitfalls-in-interpretation" class="nav-link" data-scroll-target="#pitfalls-in-interpretation"><span class="header-section-number">8.13.2</span> Pitfalls in Interpretation</a></li>
  <li><a href="#example-from-loan-default-dataset" id="toc-example-from-loan-default-dataset" class="nav-link" data-scroll-target="#example-from-loan-default-dataset"><span class="header-section-number">8.13.3</span> Example from Loan Default Dataset</a></li>
  <li><a href="#visualizing-predicted-probabilities" id="toc-visualizing-predicted-probabilities" class="nav-link" data-scroll-target="#visualizing-predicted-probabilities"><span class="header-section-number">8.13.4</span> Visualizing Predicted Probabilities</a></li>
  </ul>
</li>
  <li>
<a href="#predictions" id="toc-predictions" class="nav-link" data-scroll-target="#predictions"><span class="header-section-number">8.14</span> Predictions</a>
  <ul>
<li><a href="#predicted-probabilities-vs.-predicted-classes" id="toc-predicted-probabilities-vs.-predicted-classes" class="nav-link" data-scroll-target="#predicted-probabilities-vs.-predicted-classes"><span class="header-section-number">8.14.1</span> Predicted Probabilities vs.&nbsp;Predicted Classes</a></li>
  <li><a href="#evaluating-performance" id="toc-evaluating-performance" class="nav-link" data-scroll-target="#evaluating-performance"><span class="header-section-number">8.14.2</span> Evaluating Performance</a></li>
  </ul>
</li>
  <li>
<a href="#goodness-of-fit-model-selection" id="toc-goodness-of-fit-model-selection" class="nav-link" data-scroll-target="#goodness-of-fit-model-selection"><span class="header-section-number">8.15</span> Goodness of Fit &amp; Model Selection</a>
  <ul>
<li><a href="#pseudo-r-squared-measures" id="toc-pseudo-r-squared-measures" class="nav-link" data-scroll-target="#pseudo-r-squared-measures"><span class="header-section-number">8.15.1</span> Pseudo R-Squared Measures</a></li>
  <li><a href="#analysis-of-deviance" id="toc-analysis-of-deviance" class="nav-link" data-scroll-target="#analysis-of-deviance"><span class="header-section-number">8.15.2</span> Analysis of Deviance</a></li>
  <li><a href="#information-criteria" id="toc-information-criteria" class="nav-link" data-scroll-target="#information-criteria"><span class="header-section-number">8.15.3</span> Information Criteria</a></li>
  </ul>
</li>
  <li>
<a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics"><span class="header-section-number">8.16</span> Model Diagnostics</a>
  <ul>
<li><a href="#deviance-residuals" id="toc-deviance-residuals" class="nav-link" data-scroll-target="#deviance-residuals"><span class="header-section-number">8.16.1</span> Deviance Residuals</a></li>
  <li><a href="#binned-residual-plots" id="toc-binned-residual-plots" class="nav-link" data-scroll-target="#binned-residual-plots"><span class="header-section-number">8.16.2</span> Binned Residual Plots</a></li>
  <li><a href="#detecting-influential-points" id="toc-detecting-influential-points" class="nav-link" data-scroll-target="#detecting-influential-points"><span class="header-section-number">8.16.3</span> Detecting Influential Points</a></li>
  </ul>
</li>
  <li>
<a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">8.17</span> Results</a>
  <ul>
<li><a href="#predictive-analysis" id="toc-predictive-analysis" class="nav-link" data-scroll-target="#predictive-analysis"><span class="header-section-number">8.17.1</span> Predictive Analysis</a></li>
  <li><a href="#inferential-analysis" id="toc-inferential-analysis" class="nav-link" data-scroll-target="#inferential-analysis"><span class="header-section-number">8.17.2</span> Inferential Analysis</a></li>
  <li><a href="#model-summary-coefficients-and-odds-ratios" id="toc-model-summary-coefficients-and-odds-ratios" class="nav-link" data-scroll-target="#model-summary-coefficients-and-odds-ratios"><span class="header-section-number">8.17.3</span> Model Summary: Coefficients and Odds Ratios</a></li>
  <li><a href="#classification-performance" id="toc-classification-performance" class="nav-link" data-scroll-target="#classification-performance"><span class="header-section-number">8.17.4</span> Classification Performance</a></li>
  </ul>
</li>
  <li><a href="#r-output-4" id="toc-r-output-4" class="nav-link" data-scroll-target="#r-output-4"><span class="header-section-number">8.18</span> R Output</a></li>
  <li>
<a href="#python-output-4" id="toc-python-output-4" class="nav-link" data-scroll-target="#python-output-4"><span class="header-section-number">8.19</span> Python Output</a>
  <ul>
<li><a href="#roc-curve-and-auc" id="toc-roc-curve-and-auc" class="nav-link" data-scroll-target="#roc-curve-and-auc"><span class="header-section-number">8.19.1</span> ROC Curve and AUC</a></li>
  </ul>
</li>
  <li>
<a href="#storytelling" id="toc-storytelling" class="nav-link" data-scroll-target="#storytelling"><span class="header-section-number">8.20</span> Storytelling</a>
  <ul>
<li>
<a href="#bringing-the-model-to-life" id="toc-bringing-the-model-to-life" class="nav-link" data-scroll-target="#bringing-the-model-to-life"><span class="header-section-number">8.20.1</span> Bringing the Model to Life</a>
  <ul class="collapse">
<li><a href="#the-default-risk-landscape" id="toc-the-default-risk-landscape" class="nav-link" data-scroll-target="#the-default-risk-landscape">The Default Risk Landscape</a></li>
  <li><a href="#model-limitations-and-caveats" id="toc-model-limitations-and-caveats" class="nav-link" data-scroll-target="#model-limitations-and-caveats">Model Limitations and Caveats</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#when-to-use-binary-logistic-regression" id="toc-when-to-use-binary-logistic-regression" class="nav-link" data-scroll-target="#when-to-use-binary-logistic-regression"><span class="header-section-number">8.21</span> When to Use Binary Logistic Regression</a>
  <ul>
<li><a href="#ideal-use-cases" id="toc-ideal-use-cases" class="nav-link" data-scroll-target="#ideal-use-cases"><span class="header-section-number">8.21.1</span> Ideal Use Cases</a></li>
  <li><a href="#when-not-to-use-binary-logistic-regression" id="toc-when-not-to-use-binary-logistic-regression" class="nav-link" data-scroll-target="#when-not-to-use-binary-logistic-regression"><span class="header-section-number">8.21.2</span> When NOT to Use Binary Logistic Regression</a></li>
  <li><a href="#assumptions-to-check" id="toc-assumptions-to-check" class="nav-link" data-scroll-target="#assumptions-to-check"><span class="header-section-number">8.21.3</span> Assumptions to Check</a></li>
  </ul>
</li>
  <li>
<a href="#limitations-and-extensions" id="toc-limitations-and-extensions" class="nav-link" data-scroll-target="#limitations-and-extensions"><span class="header-section-number">8.22</span> Limitations and Extensions</a>
  <ul>
<li>
<a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations"><span class="header-section-number">8.22.1</span> Limitations</a>
  <ul class="collapse">
<li><a href="#assumes-linear-log-odds" id="toc-assumes-linear-log-odds" class="nav-link" data-scroll-target="#assumes-linear-log-odds">1. Assumes Linear Log-Odds</a></li>
  <li><a href="#sensitive-to-outliers-and-influential-points" id="toc-sensitive-to-outliers-and-influential-points" class="nav-link" data-scroll-target="#sensitive-to-outliers-and-influential-points">2. Sensitive to Outliers and Influential Points</a></li>
  <li><a href="#requires-sufficient-sample-size" id="toc-requires-sufficient-sample-size" class="nav-link" data-scroll-target="#requires-sufficient-sample-size">3. Requires Sufficient Sample Size</a></li>
  <li><a href="#cannot-handle-perfect-separation" id="toc-cannot-handle-perfect-separation" class="nav-link" data-scroll-target="#cannot-handle-perfect-separation">4. Cannot Handle Perfect Separation</a></li>
  <li><a href="#multicollinearity-inflates-standard-errors" id="toc-multicollinearity-inflates-standard-errors" class="nav-link" data-scroll-target="#multicollinearity-inflates-standard-errors">5. Multicollinearity Inflates Standard Errors</a></li>
  </ul>
</li>
  <li>
<a href="#extensions" id="toc-extensions" class="nav-link" data-scroll-target="#extensions"><span class="header-section-number">8.22.2</span> Extensions</a>
  <ul class="collapse">
<li><a href="#mixed-effects-logistic-regression" id="toc-mixed-effects-logistic-regression" class="nav-link" data-scroll-target="#mixed-effects-logistic-regression">Mixed-Effects Logistic Regression</a></li>
  <li><a href="#generalized-additive-models-gams" id="toc-generalized-additive-models-gams" class="nav-link" data-scroll-target="#generalized-additive-models-gams">Generalized Additive Models (GAMs)</a></li>
  <li><a href="#penalized-logistic-regression-ridge-lasso-elastic-net" id="toc-penalized-logistic-regression-ridge-lasso-elastic-net" class="nav-link" data-scroll-target="#penalized-logistic-regression-ridge-lasso-elastic-net">Penalized Logistic Regression (Ridge, Lasso, Elastic Net)</a></li>
  <li><a href="#bayesian-logistic-regression" id="toc-bayesian-logistic-regression" class="nav-link" data-scroll-target="#bayesian-logistic-regression">Bayesian Logistic Regression</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">8.23</span> Summary</a>
  <ul>
<li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways"><span class="header-section-number">8.23.1</span> Key Takeaways</a></li>
  <li><a href="#looking-ahead" id="toc-looking-ahead" class="nav-link" data-scroll-target="#looking-ahead"><span class="header-section-number">8.23.2</span> Looking Ahead</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/alexrod61/regression-cookbook/edit/main/book/08-binary-logistic.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/alexrod61/regression-cookbook/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/alexrod61/regression-cookbook/blob/main/book/08-binary-logistic.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../book/discrete-zone.html">Discrete Cuisine</a></li><li class="breadcrumb-item"><a href="../book/08-binary-logistic.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Binary Logistic Regression</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title">Binary Logistic Regression</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><!--#
# Quarto Document Setup
# ======================================================
# This section defines metadata and execution rules for the chapter.
# - "title" sets the chapter title displayed in the rendered book.
# - "execute: eval: false" prevents R/Python code from being run 
#   during rendering (useful if code is illustrative, or if setup 
#   is handled separately).
# ====================================================== --><!-- ======================================================
Google Analytics Tracking Snippet
------------------------------------------------------
- This loads the Google Analytics "gtag.js" script asynchronously 
  so it does not block page rendering.
- The `id` value ("G-7PRVEBE1EF") is your unique measurement ID.
- `window.dataLayer` is initialized if it doesn’t exist already.
- The `gtag` function pushes tracking events into the dataLayer.
- `gtag('js', new Date());` records the time the analytics script 
  was loaded.
- `gtag('config', 'G-7PRVEBE1EF');` activates tracking for this ID.
------------------------------------------------------
You can safely move this block into the YAML `include-in-header` 
if you want it injected site-wide, rather than repeating it per 
chapter.
====================================================== --><!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7PRVEBE1EF"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7PRVEBE1EF');
</script><!-- 
This block creates a **Mermaid mindmap diagram** that shows how different 
chapters in the book fit into the broader context of regression analysis.  

- It organizes regression models by the type of outcome variable (Continuous vs. Discrete).  
- Each branch links to a chapter in the book (e.g., OLS, Gamma Regression, Beta Regression).  
- This diagram provides readers with a "map" of where Binary Logistic Regression fits in.  
--><div id="fig-binary-logistic-regression" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-binary-logistic-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"></figure><p></p>
<div>
<pre class="mermaid mermaid-js">mindmap
  root((Regression 
  Analysis)
    Continuous &lt;br/&gt;Outcome Y
      {{Unbounded &lt;br/&gt;Outcome Y}}
        )Chapter 3: &lt;br/&gt;Ordinary &lt;br/&gt;Least Squares &lt;br/&gt;Regression(
          (Normal &lt;br/&gt;Outcome Y)
      {{Nonnegative &lt;br/&gt;Outcome Y}}
        )Chapter 4: &lt;br/&gt;Gamma Regression(
          (Gamma &lt;br/&gt;Outcome Y)
      {{Bounded &lt;br/&gt;Outcome Y &lt;br/&gt; between 0 and 1}}
        )Chapter 5: Beta &lt;br/&gt;Regression(
          (Beta &lt;br/&gt;Outcome Y)
      {{Nonnegative &lt;br/&gt;Survival &lt;br/&gt;Time Y}}
        )Chapter 6: &lt;br/&gt;Parametric &lt;br/&gt; Survival &lt;br/&gt;Regression(
          (Exponential &lt;br/&gt;Outcome Y)
          (Weibull &lt;br/&gt;Outcome Y)
          (Lognormal &lt;br/&gt;Outcome Y)
        )Chapter 7: &lt;br/&gt;Semiparametric &lt;br/&gt;Survival &lt;br/&gt;Regression(
          (Cox Proportional &lt;br/&gt;Hazards Model)
            (Hazard Function &lt;br/&gt;Outcome Y)
    Discrete &lt;br/&gt;Outcome Y
      {{Binary &lt;br/&gt;Outcome Y}}
        {{Ungrouped &lt;br/&gt;Data}}
          )Chapter 8: &lt;br/&gt;Binary Logistic &lt;br/&gt;Regression(
            (Bernoulli &lt;br/&gt;Outcome Y)
</pre>
</div>
<p></p>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-binary-logistic-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.1
</figcaption></figure>
</div>
<div class="LO">
<div class="LO-header">
<p><strong>Learning Objectives</strong></p>
</div>
<div class="LO-container">
<p>By the end of this chapter, you will be able to:</p>
<ul>
<li>Explain how <strong>Binary Logistic Regression</strong> models the probability of a binary outcome using <strong>log-odds</strong>.</li>
<li>Describe why <strong>Ordinary Least Squares</strong> is not appropriate for binary outcomes, and how the <strong>logistic function</strong> addresses this.</li>
<li>Fit a binary logistic regression model in both <code>R</code> and <code>Python</code>.</li>
<li>Interpret <strong>log-odds</strong>, <strong>odds ratios</strong>, and <strong>predicted probabilities</strong> in real-world contexts.</li>
<li>Evaluate model fit using metrics such as <strong>accuracy</strong>, <strong>confusion matrices</strong>, and <strong>ROC curves</strong>.</li>
<li>Identify when binary logistic regression is the <strong>appropriate tool</strong>, and understand its <strong>limitations</strong>.</li>
</ul>
</div>
</div>
<section id="introduction" class="level2" data-number="8.1"><h2 data-number="8.1" class="anchored" data-anchor-id="introduction">
<span class="header-section-number">8.1</span> Introduction</h2>
<p>In many real-world problems, the outcome we’re trying to predict is <strong>not a number</strong> — it’s a <strong>yes or no</strong>, <strong>success or failure</strong>, <strong>clicked or didn’t click</strong>. For example:</p>
<ul>
<li>Will a student <strong>default on a loan</strong> given their credit score and income?</li>
<li>Will a student <strong>pass a course</strong> based on whether they have a part-time job and how many hours they studied?</li>
<li>Will a student <strong>likely graduate within 4 years</strong>, based on their academic record and declared major?</li>
</ul>
<p>These outcomes are <strong>binary</strong>: they can take on only two possible values, typically coded as <code>1</code> (event occurs) and <code>0</code> (event does not occur).</p>
<p>To model such outcomes, we need a regression approach that produces <strong>predicted probabilities</strong> between 0 and 1 — not arbitrary numbers on the real line. This is where <strong>Binary Logistic Regression</strong> comes in.</p>
<p>In this chapter, we’ll see how logistic regression:</p>
<ul>
<li>Links input variables to the <strong>log-odds</strong> of the outcome,</li>
<li>Produces interpretable coefficients (like <strong>odds ratios</strong>), and</li>
<li>Helps us make informed predictions in binary classification problems.</li>
</ul></section><section id="why-ordinary-least-squares-fails-for-binary-outcomes" class="level2" data-number="8.2"><h2 data-number="8.2" class="anchored" data-anchor-id="why-ordinary-least-squares-fails-for-binary-outcomes">
<span class="header-section-number">8.2</span> Why Ordinary Least Squares Fails for Binary Outcomes</h2>
<p>To understand the need for logistic regression, consider applying Ordinary Least Squares (OLS) to a <strong>binary outcome</strong>.</p>
<p>Suppose we are trying to predict whether a student <strong>defaulted</strong> on a loan (<code>1</code>) or <strong>did not default</strong> (<code>0</code>) using a continuous predictor like <code>credit_score</code>.</p>
<p>In this chapter we use the <strong>BLR (Binary Logistic Regression)</strong> dataset, which contains student-level information such as <strong>credit score</strong>, <strong>income</strong>, and other demographic/financial variables. Our outcome of interest is <strong><code>defaulted</code></strong>, a binary indicator where <code>1</code> means the student defaulted on a loan and <code>0</code> means they did not. We’ll start with a single predictor (<code>credit_score</code>) to illustrate the core ideas, then later extend to multiple predictors.</p>
<p>Before diving into the technical reasons why OLS is inappropriate for binary outcomes, let’s look at a simplified version of the dataset we’ll use throughout this chapter:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Prepare data: numeric default variable and select predictor</span></span>
<span><span class="va">blr_data</span> <span class="op">&lt;-</span> <span class="va">BLR</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">credit_score</span>, <span class="va">defaulted</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>defaulted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">defaulted</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Below is a sample of this dataset:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 9%">
<col style="width: 16%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 9%">
</colgroup>
<thead><tr class="header">
<th style="text-align: right;"><strong>credit_score</strong></th>
<th style="text-align: right;"><strong>income</strong></th>
<th style="text-align: right;"><strong>education_years</strong></th>
<th style="text-align: right;"><strong>married</strong></th>
<th style="text-align: right;"><strong>owns_home</strong></th>
<th style="text-align: right;"><strong>age</strong></th>
<th style="text-align: right;"><strong>defaulted</strong></th>
<th style="text-align: right;"><strong>successes</strong></th>
<th style="text-align: right;"><strong>trials</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">850</td>
<td style="text-align: right;">154100</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">606</td>
<td style="text-align: right;">34100</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">846</td>
<td style="text-align: right;">73000</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">702</td>
<td style="text-align: right;">41300</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">843</td>
<td style="text-align: right;">50800</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">610</td>
<td style="text-align: right;">33400</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">572</td>
<td style="text-align: right;">24600</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">795</td>
<td style="text-align: right;">57700</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">796</td>
<td style="text-align: right;">37100</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">690</td>
<td style="text-align: right;">72300</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">10</td>
</tr>
</tbody>
</table>
<p>Now, let’s narrow in on the key variables of interest for this section.</p>
<div style="width: 40%; margin-left: 0;">
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: right;"><strong>credit_score</strong></th>
<th style="text-align: right;"><strong>defaulted</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">850</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">606</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">846</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">702</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">843</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">610</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">572</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">795</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">796</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">690</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<p>This dataset allows us to examine whether a student defaulted on a loan (<code>defaulted = 1</code>) based on their <code>credit_score</code>. It’s a classic binary outcome: a “yes” or “no” event.</p>
<p>If we use OLS, we estimate:</p>
<p><span class="math display">\[
\mathbb{E}(Y_i \mid X_i) = \pi_i = \beta_0 + \beta_1 X_i
\]</span></p>
<p>This means we’re treating the <strong>probability of default</strong> (<span class="math inline">\(\pi_i\)</span>) as a linear function of credit score.</p>
<p>However, there are <strong>two fundamental issues</strong> with using OLS here:</p>
<ol type="1">
<li>The linear model can produce predicted values <strong>less than 0</strong> or <strong>greater than 1</strong> — which doesn’t make sense when modeling a <strong>probability</strong>.</li>
<li>OLS assumes <strong>constant variance</strong> of the residuals, but binary outcomes inherently violate this assumption, because their variance depends on the mean:</li>
</ol>
<p><span class="math display">\[
\text{Var}(Y_i) = \pi_i(1 - \pi_i)
\]</span></p>
<p>To see this issue in action, let’s try fitting an OLS regression model using our binary outcome and a continuous predictor. While OLS is designed to minimize squared error, it doesn’t account for the discrete nature of the response — which means it can return predicted probabilities below 0 or above 1. In the example below, we use a customer’s credit score to predict the probability of default, and you’ll see how the linear model fails to respect the fundamental constraints of probability.</p>
<div id="fig-ols-failure-binary" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ols-failure-binary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/ols-failure-credit-score3.svg" class="img-fluid figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ols-failure-binary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.2: OLS fails to constrain predictions between 0 and 1, despite binary outcomes.
</figcaption></figure>
</div>
<p>These limitations make OLS unsuitable for <strong>modeling a binary outcome as a probability</strong>.<br>
To properly model the <strong>probability of the event</strong> (here, default), we need a method that:</p>
<ul>
<li>Produces predictions strictly between 0 and 1,</li>
<li>Accounts for the fact that the variance depends on the mean, and</li>
<li>Connects our predictors to the probability of the event in a way that is easy to interpret.</li>
</ul>
<p>The key idea is to <strong>transform the probability</strong> so that it can be modeled as a linear function without breaking these rules.<br>
In the next section, we’ll see how the <strong>logit transformation</strong> does exactly that.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ⚠️ This OLS fit is not appropriate for binary outcomes.</span></span>
<span><span class="co"># We include it here only to illustrate why logistic regression is needed.</span></span>
<span></span>
<span><span class="co"># Load necessary libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare data: numeric default variable and select predictor</span></span>
<span><span class="va">blr_data</span> <span class="op">&lt;-</span> <span class="va">BLR</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">credit_score</span>, <span class="va">defaulted</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>defaulted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">defaulted</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit an OLS model (not ideal for binary outcome)</span></span>
<span><span class="va">ols_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span>, data <span class="op">=</span> <span class="va">blr_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add predicted values</span></span>
<span><span class="va">blr_data</span><span class="op">$</span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">ols_model</span>, newdata <span class="op">=</span> <span class="va">blr_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot actual data and OLS-fitted line</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">blr_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">credit_score</span>, y <span class="op">=</span> <span class="va">defaulted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.05</span>, width <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">predicted</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"OLS Fitted Line on Binary Data"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Credit Score"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Predicted Probability of Default"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ⚠️ This OLS fit is not appropriate for binary outcomes.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We include it here only to illustrate why logistic regression is needed.</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract relevant columns from the BLR dataset</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>blr <span class="op">=</span> r.data[<span class="st">'BLR'</span>]</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> blr[[<span class="st">'credit_score'</span>, <span class="st">'defaulted'</span>]].copy()</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'defaulted'</span>] <span class="op">=</span> df[<span class="st">'defaulted'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit an OLS model</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(df[<span class="st">'credit_score'</span>])</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(df[<span class="st">'defaulted'</span>], X).fit()</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'predicted'</span>] <span class="op">=</span> model.predict(X)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the actual binary outcomes and OLS predictions</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>ax.scatter(df[<span class="st">'credit_score'</span>], df[<span class="st">'defaulted'</span>], alpha<span class="op">=</span><span class="fl">0.4</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Actual Data'</span>, s<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>ax.plot(df[<span class="st">'credit_score'</span>], df[<span class="st">'predicted'</span>], color<span class="op">=</span><span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'OLS Fit'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"OLS Fitted Line on Binary Data"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Credit Score"</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Predicted Probability of Default"</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">1.2</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-binary-logistic_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>(-0.3, 1.2)</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-binary-logistic_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="the-logit-function" class="level2" data-number="8.3"><h2 data-number="8.3" class="anchored" data-anchor-id="the-logit-function">
<span class="header-section-number">8.3</span> The Logit Function</h2>
<p>In Section 8.2, we saw that modeling probability directly with a linear equation can produce impossible values (less than 0 or greater than 1) and ignores the way variance changes with the mean.</p>
<p>The fix is to apply a transformation that:</p>
<ul>
<li>Expands the (0, 1) probability range to the entire real line,</li>
<li>Is reversible, so we can convert back to probabilities, and</li>
<li>Preserves the ordering of probabilities.</li>
</ul>
<p>One transformation that checks all these boxes is the <strong>logit function</strong>.</p>
<section id="logit-a-link-between-probability-and-linear-predictors" class="level3" data-number="8.3.1"><h3 data-number="8.3.1" class="anchored" data-anchor-id="logit-a-link-between-probability-and-linear-predictors">
<span class="header-section-number">8.3.1</span> Logit: A Link Between Probability and Linear Predictors</h3>
<p>The <strong>logit function</strong> transforms the probability <span class="math inline">\(\pi_i\)</span> into a value on the entire real line: <span class="math display">\[
\text{logit}(\pi_i) = \log\!\left(\frac{\pi_i}{1 - \pi_i}\right) = \beta_0 + \beta_1 X_i
\]</span></p>
<p>This transformation:</p>
<ul>
<li>Is <strong>monotonic</strong> (it preserves order),</li>
<li>Maps probabilities <span class="math inline">\(\pi_i \in (0, 1)\)</span> to <span class="math inline">\((-\infty, \infty)\)</span>, and</li>
<li>Solves the range issue of OLS by letting us fit a linear model in the transformed space.</li>
</ul>
<p>By modeling the <strong>log-odds</strong> as a linear function of predictors and then inverting the transformation, we obtain valid predicted <strong>probabilities</strong> that remain within <span class="math inline">\([0,1]\)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>logit function</strong> is defined as: <span class="math display">\[
\text{logit}(\pi_i) = \log\!\left(\frac{\pi_i}{1 - \pi_i}\right)
\]</span> It models the <strong>log-odds</strong> of the outcome as a linear function of predictors.</p>
</div>
</div>
</section><section id="from-log-odds-back-to-probability" class="level3" data-number="8.3.2"><h3 data-number="8.3.2" class="anchored" data-anchor-id="from-log-odds-back-to-probability">
<span class="header-section-number">8.3.2</span> From Log-Odds Back to Probability</h3>
<p>While the model calculates linearly on the log-odds scale, we ultimately want to understand the probability of the outcome (<span class="math inline">\(\pi_i\)</span>). To do this, we invert the logit function.</p>
<p>The inverse of the logit is the <strong>Sigmoid function</strong> (also called the logistic function):</p>
<p><span class="math display">\[
\pi_i = \frac{1}{1 + e^{-(\beta_0 + \beta_1 X_i)}}
\]</span></p>
<p>This function takes our linear prediction (<span class="math inline">\(\beta_0 + \beta_1 X_i\)</span>), which can range from <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(+\infty\)</span>, and “squashes” it into the range <span class="math inline">\((0, 1)\)</span>. This mathematical trick ensures that no matter how extreme our predictor values get, our predicted probability never exceeds 1 or drops below 0.</p>
<div id="fig-logistic-curve" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-logistic-curve-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/logistic-curve.svg" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-logistic-curve-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.3: The Logistic Function showing the S-shape curve
</figcaption></figure>
</div>
</section><section id="understanding-the-s-shape" class="level3" data-number="8.3.3"><h3 data-number="8.3.3" class="anchored" data-anchor-id="understanding-the-s-shape">
<span class="header-section-number">8.3.3</span> Understanding the “S” Shape</h3>
<p>The sigmoid function is not just a boundary enforcer; it fundamentally changes how we interpret the relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. Unlike a straight line, the sigmoid curve is <strong>non-linear</strong>.</p>
<p><strong>1. The Steep Middle (High Sensitivity)</strong> When the probability is near 0.5 (the “tipping point”), the curve is steepest. This means that small changes in the predictor <span class="math inline">\(X\)</span> result in <strong>large changes</strong> in the probability <span class="math inline">\(\pi_i\)</span>.</p>
<ul>
<li>
<em>Context:</em> If a borrower is borderline (e.g., 50/50 chance of default), a small improvement in their credit score can drastically reduce their default risk.</li>
</ul>
<p><strong>2. The Flat Tails (Diminishing Returns)</strong> As the probability approaches 0 or 1, the curve flattens out (asymptotes). In these regions, even large changes in <span class="math inline">\(X\)</span> result in <strong>tiny changes</strong> in <span class="math inline">\(\pi_i\)</span>.</p>
<ul>
<li>
<em>Context:</em> If a borrower has a near-perfect credit score (risk <span class="math inline">\(\approx 0.01\%\)</span>), increasing their score further makes almost no difference to their probability of default. The model recognizes that they are already “maxed out” on safety.</li>
</ul>
<p>This captures a realistic property of many binary outcomes: <strong>interventions are most effective when the outcome is uncertain.</strong></p>
<p>This transformation lets us use a linear predictor on the <strong>log-odds</strong> scale and then recover valid probabilities.<br>
This idea forms the basis of <strong>binary logistic regression</strong>, introduced next.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Visualizing the Difference
</div>
</div>
<div class="callout-body-container callout-body">
<p>In OLS (linear regression), the slope <span class="math inline">\(\,\beta_1\,\)</span> is a <strong>constant change in the mean response</strong>: <span class="math display">\[
\mathbb{E}[Y \mid x+1] - \mathbb{E}[Y \mid x] = \beta_1.
\]</span></p>
<p>In logistic regression, the relationship is linear on the <strong>log-odds (logit) scale</strong>: <span class="math display">\[
\log\!\left(\frac{\pi(x)}{1-\pi(x)}\right)=\beta_0+\beta_1 x.
\]</span> So <span class="math inline">\(\beta_1\)</span> is still a <strong>constant slope</strong>—but it is constant in <strong>log-odds</strong>: a one-unit increase in <span class="math inline">\(x\)</span> adds <span class="math inline">\(\beta_1\)</span> to the log-odds (equivalently, it multiplies the odds by <span class="math inline">\(e^{\beta_1}\)</span>), holding other predictors fixed.</p>
<p>What <em>isn’t</em> constant is the change in <strong>probability</strong>. The marginal effect on probability depends on <span class="math inline">\(\pi(x)\)</span>: <span class="math display">\[
\frac{d\pi(x)}{dx}=\beta_1\,\pi(x)\big(1-\pi(x)\big),
\]</span> which is largest near <span class="math inline">\(\pi(x)=0.5\)</span> and shrinks as <span class="math inline">\(\pi(x)\)</span> approaches 0 or 1.</p>
</div>
</div>
<hr></section><section id="the-logistic-function-and-its-shape-code" class="level3" data-number="8.3.4"><h3 data-number="8.3.4" class="anchored" data-anchor-id="the-logistic-function-and-its-shape-code">
<span class="header-section-number">8.3.4</span> The Logistic Function and Its Shape (Code)</h3>
<p>The following plot illustrates this behavior. Notice how the linear model (red dashed line) marches blindly past 0 and 1, while the logistic model (blue solid line) respects the boundaries and shows the characteristic “S” shape.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Logistic vs Linear fit demo</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Grid of linear predictor values (η)</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span>, length.out <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Logistic sigmoid: π(η)</span></span>
<span><span class="va">pi</span>  <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Naive linear "probability" for comparison</span></span>
<span><span class="co"># passes through (0, 0.5) with moderate slope</span></span>
<span><span class="va">p_lin</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.25</span> <span class="op">*</span> <span class="va">eta</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  eta    <span class="op">=</span> <span class="va">eta</span>,</span>
<span>  sigmoid <span class="op">=</span> <span class="va">pi</span>,</span>
<span>  linear  <span class="op">=</span> <span class="va">p_lin</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">eta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Logistic S-curve</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">sigmoid</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.4</span>, color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Naive linear line</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">linear</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"#E74C3C"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Vertical marker for steepest change near π ≈ 0.5</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                   y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.7</span><span class="op">)</span>, yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               colour <span class="op">=</span> <span class="st">"gray40"</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">0.7</span>, y <span class="op">=</span> <span class="fl">0.55</span>,</span>
<span>           label <span class="op">=</span> <span class="st">"Steepest change\nat π ≈ 0.5"</span>,</span>
<span>           size <span class="op">=</span> <span class="fl">3.5</span>, hjust <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"gray30"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Linear predictor (η = β0 + β1 X)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Probability (π)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"The Sigmoid 'S-Curve' vs. Linear Fit"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Logistic regression captures diminishing returns at the extremes"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Blue: Logistic Sigmoid (Valid Probabilities). Red: Naive Linear (Violates Bounds)."</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">11</span>, colour <span class="op">=</span> <span class="st">"gray40"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.special <span class="im">import</span> expit  <span class="co"># logistic / sigmoid</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid of linear predictor values (η)</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>eta <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">400</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic sigmoid π(η)</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>pi <span class="op">=</span> expit(eta)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Naive linear "probability" (same as R: 0.5 + 0.25η)</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>p_lin <span class="op">=</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.25</span> <span class="op">*</span> eta</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic S-curve</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>plt.plot(eta, pi, label<span class="op">=</span><span class="st">"Logistic Sigmoid (Valid $\pi$)"</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="fl">2.0</span>, color<span class="op">=</span><span class="st">"steelblue"</span>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Naive linear line</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>plt.plot(eta, p_lin, <span class="st">"--"</span>, label<span class="op">=</span><span class="st">"Naive Linear (Violates Bounds)"</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>         linewidth<span class="op">=</span><span class="fl">1.5</span>, color<span class="op">=</span><span class="st">"#E74C3C"</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Vertical marker around steepest change near π ≈ 0.5</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>y_lo, y_hi <span class="op">=</span> expit(<span class="op">-</span><span class="fl">0.7</span>), expit(<span class="fl">0.7</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">0</span>], [y_lo, y_hi], color<span class="op">=</span><span class="st">"gray40"</span>, linewidth<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="fl">0.7</span>, <span class="fl">0.55</span>, <span class="st">"Steepest change</span><span class="ch">\n</span><span class="st">at $\pi </span><span class="ch">\\</span><span class="st">approx 0.5$"</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>         fontsize<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"gray30"</span>, ha<span class="op">=</span><span class="st">"left"</span>, va<span class="op">=</span><span class="st">"center"</span>)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>plt.yticks(np.arange(<span class="dv">0</span>, <span class="fl">1.01</span>, <span class="fl">0.25</span>))</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r"Linear predictor ($\eta = \beta_0 + \beta_1 X$)"</span>)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r"Probability ($\pi$)"</span>)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"The Sigmoid 'S-Curve' vs. Linear Fit"</span>)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div id="fig-logistic-sigmoid" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-logistic-sigmoid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/logistic-sigmoid.svg" class="img-fluid figure-img" style="width:90.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-logistic-sigmoid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.4: The Sigmoid ‘S-Curve’ vs.&nbsp;Linear Fit. The logistic model (blue solid line) respects the [0,1] probability bounds and captures the non-linear “diminishing returns” at the extremes, whereas the linear model (red dashed line) extends indefinitely.
</figcaption></figure>
</div>
<hr></section></section><section id="case-study-understanding-financial-behaviors" class="level2" data-number="8.4"><h2 data-number="8.4" class="anchored" data-anchor-id="case-study-understanding-financial-behaviors">
<span class="header-section-number">8.4</span> Case Study: Understanding Financial Behaviors</h2>
<p>Statistical models are most useful when they connect to a real-world problem. In this case study, we use binary logistic regression to model <strong>default risk</strong>—the probability that a student <strong>defaults</strong> on a loan.</p>
<hr>
<section id="case-study-setup-data-goal" class="level3" data-number="8.4.1"><h3 data-number="8.4.1" class="anchored" data-anchor-id="case-study-setup-data-goal">
<span class="header-section-number">8.4.1</span> Case Study Setup: Data + Goal</h3>
<p>We’ll use the <code>Logistic_Regression</code> dataset (packaged in <code>cookbook</code>). The outcome is:</p>
<ul>
<li>
<code>defaulted</code> (binary: <code>1 = default</code>, <code>0 = no default</code>)</li>
</ul>
<p>and we model the probability of default for each student, <span class="math inline">\(\pi_i = P(Y_i = 1 \mid \mathbf{x}_i)\)</span>, using a mix of predictors such as:</p>
<ul>
<li>
<code>credit_score</code> (numeric; higher typically means lower risk)</li>
<li>
<code>income</code> (numeric; annual income)</li>
<li>
<code>age</code> (numeric)</li>
<li>
<code>loan_amount</code> (numeric)</li>
<li>
<code>student</code> (categorical: yes/no)</li>
</ul>
<p>Banks and lenders face a practical question:</p>
<blockquote class="blockquote">
<p><em>Given a customer’s financial history, how risky is this loan?</em></p>
</blockquote>
<p>Even though the final decision is “approve” or “deny,” the key modeling goal is to estimate a <strong>probability of default</strong> (risk). That probability can later be converted into a decision using a chosen threshold (e.g., “approve only if <span class="math inline">\(\hat{\pi}_i &lt; 0.10\)</span>”).</p>
<section id="why-probability-matters-asymmetric-costs" class="level4"><h4 class="anchored" data-anchor-id="why-probability-matters-asymmetric-costs">Why probability matters: asymmetric costs</h4>
<p>Errors are not equally costly:</p>
<ul>
<li>
<strong>False positive:</strong> predict default, but the customer would have paid.<br><em>Cost:</em> opportunity cost (lost interest).</li>
<li>
<strong>False negative:</strong> predict safe, but the customer defaults.<br><em>Cost:</em> potential loss of principal (and associated costs).</li>
</ul>
<p>Because false negatives are often more expensive, we care about a calibrated probability <span class="math inline">\(\hat{\pi}_i\)</span>, not just a yes/no label.</p>
<hr></section></section><section id="study-design-and-data-prep" class="level3" data-number="8.4.2"><h3 data-number="8.4.2" class="anchored" data-anchor-id="study-design-and-data-prep">
<span class="header-section-number">8.4.2</span> Study Design and Data Prep</h3>
<p>Before fitting the model, we set up the analysis and prepare the data.</p>
<section id="study-design-high-level" class="level4"><h4 class="anchored" data-anchor-id="study-design-high-level">Study design (high-level)</h4>
<ul>
<li>
<strong>Predictors:</strong> a mix of continuous and categorical variables.</li>
<li>
<strong>Outcome:</strong> binary (<code>defaulted</code>).</li>
<li>
<strong>Assumptions / modelling requirements:</strong>
<ul>
<li>
<strong>Independence:</strong> observations are (approximately) independent.</li>
<li>
<strong>Linearity in the log-odds:</strong> predictors relate linearly to the log-odds of default.</li>
<li>
<strong>No perfect multicollinearity (identifiability):</strong> predictors must not be perfectly redundant (e.g., one column is an exact linear combination of others), so coefficients are uniquely estimable.</li>
</ul>
</li>
</ul></section><section id="data-preparation-steps" class="level4"><h4 class="anchored" data-anchor-id="data-preparation-steps">Data preparation steps</h4>
<p>We’ll do three practical steps that help ensure fair evaluation and stable estimation:</p>
<ol type="1">
<li>
<strong>Check class balance.</strong> If defaults are rare, accuracy alone can be misleading.</li>
<li>
<strong>Split into training/testing sets</strong> to evaluate generalization and reduce overfitting.</li>
<li>
<strong>Stratify the split</strong> so the default rate is similar in both sets.</li>
</ol></section><section id="influential-points-and-outliers" class="level4"><h4 class="anchored" data-anchor-id="influential-points-and-outliers">Influential points and outliers</h4>
<p>All regression-style models can be influenced by unusual observations. In logistic regression, the most important cases are often <strong>high-leverage points</strong> (unusual predictor values) and situations close to <strong>separation</strong> (predictors almost perfectly predict the outcome), both of which can strongly affect the fitted probabilities.</p>
<p>Before modeling, it’s worth checking for:</p>
<ul>
<li>
<strong>Data entry errors</strong> (impossible values).</li>
<li>
<strong>Extreme leverage points</strong> (legitimate but unusually large/small predictor values that may disproportionately influence the fit).</li>
</ul>
<hr></section></section><section id="data-preparation-in-action" class="level3" data-number="8.4.3"><h3 data-number="8.4.3" class="anchored" data-anchor-id="data-preparation-in-action">
<span class="header-section-number">8.4.3</span> Data Preparation in Action</h3>
<p>Below, we check the default rate and create a stratified train/test split.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rsample.tidymodels.org">rsample</a></span><span class="op">)</span> <span class="co"># Part of tidymodels for splitting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Check Class Imbalance</span></span>
<span><span class="co"># Notice if defaults are rare (e.g., &lt; 10%)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">$</span><span class="va">defaulted</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Stratified Split</span></span>
<span><span class="co"># We use 'strata = defaulted' to ensure both sets have the same % of defaults</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">initial_split</a></span><span class="op">(</span><span class="va">BLR</span>, prop <span class="op">=</span> <span class="fl">0.70</span>, strata <span class="op">=</span> <span class="va">defaulted</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">training</a></span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span>
<span><span class="va">test_data</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">testing</a></span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Verify the split</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Check Class Imbalance</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'defaulted'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Stratified Split</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We use 'stratify=y' to ensure both sets have the same % of defaults</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">'defaulted'</span>])</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    X, y, </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    test_size<span class="op">=</span><span class="fl">0.3</span>, </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">123</span>, </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    stratify<span class="op">=</span>y  <span class="co"># Crucial for imbalanced data</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Verify the split</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Training set shape: </span><span class="sc">{</span>X_train<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Testing set shape: </span><span class="sc">{</span>X_test<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr></section></section><section id="fitting-the-binary-logistic-regression-model" class="level2" data-number="8.5"><h2 data-number="8.5" class="anchored" data-anchor-id="fitting-the-binary-logistic-regression-model">
<span class="header-section-number">8.5</span> Fitting the Binary Logistic Regression Model</h2>
<p>Now that we’ve prepared the data, we fit the model. Our goal is to estimate the unknown parameters (<span class="math inline">\(\beta\)</span>) that link our predictors (like <code>credit_score</code>) to the probability of default.</p>
<hr>
<section id="model-specification" class="level3" data-number="8.5.1"><h3 data-number="8.5.1" class="anchored" data-anchor-id="model-specification">
<span class="header-section-number">8.5.1</span> Model Specification</h3>
<p>We define the relationship between the predictors and the probability of default <span class="math inline">\(\pi_i\)</span> as:</p>
<p><span class="math display">\[
\log\!\left(\frac{\pi_i}{1 - \pi_i}\right) = \beta_0 + \beta_1\,\text{credit\_score}_i + \beta_2\,\text{income}_i + \dots + \beta_k X_{ki}
\]</span></p>
<p>Here is what the parameters entail:</p>
<ul>
<li>
<span class="math inline">\(\pi_i\)</span>: The probability that the <span class="math inline">\(i\)</span>-th student defaults.</li>
<li>
<span class="math inline">\(\beta_0\)</span> (<strong>The Intercept</strong>): The log-odds of default when all predictors are zero (often outside the meaningful range of the data, so mainly a baseline reference).</li>
<li>
<span class="math inline">\(\beta_1, \dots, \beta_k\)</span> (<strong>The Slopes</strong>): For a one-unit increase in the <strong>corresponding predictor</strong> <span class="math inline">\(X_j\)</span> (e.g., <code>credit_score</code> or <code>income</code>), <span class="math inline">\(\beta_j\)</span> is the change in the <strong>log-odds</strong> of default, <strong>holding all other predictors fixed</strong>. Equivalently, the odds are multiplied by <span class="math inline">\(e^{\beta_j}\)</span>.</li>
</ul></section><section id="fitting-the-model" class="level3" data-number="8.5.2"><h3 data-number="8.5.2" class="anchored" data-anchor-id="fitting-the-model">
<span class="header-section-number">8.5.2</span> Fitting the Model</h3>
<p>To estimate these <span class="math inline">\(\beta\)</span> parameters, we use <strong>Maximum Likelihood Estimation (MLE)</strong>.</p>
<p>In R, we use the <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> function (Generalized Linear Model). Crucially, we must specify <code>family = binomial</code>.</p>
<ul>
<li><p><strong>Why <code>family = binomial</code>?</strong> Standard regression (OLS) assumes the target variable follows a <strong>Normal (Gaussian)</strong> distribution. However, our target is binary (0/1), which follows a <strong>Bernoulli/Binomial</strong> distribution. This argument tells the software to switch from “Least Squares” to “Maximum Likelihood” using the binomial distribution.</p></li>
<li><p><strong>Why Logit?</strong> By default, <code>family = binomial</code> uses the <strong>logit</strong> link function. While other links exist (like <em>probit</em>), the logit is preferred for its interpretability (odds ratios) and mathematical properties.</p></li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit the model using Generalized Linear Model (glm)</span></span>
<span><span class="co"># family = binomial automatically defaults to link = "logit"</span></span>
<span><span class="va">fit_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">loan_amount</span> <span class="op">+</span> <span class="va">student</span>,</span>
<span>               data <span class="op">=</span> <span class="va">BLR</span>,</span>
<span>               family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_glm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Define Predictors (X) and Target (y)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: We access the R dataframe 'BLR' using 'r.BLR'</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.BLR</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[[<span class="st">'credit_score'</span>, <span class="st">'income'</span>, <span class="st">'age'</span>, <span class="st">'loan_amount'</span>, <span class="st">'student'</span>]]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Add Intercept manually (Statsmodels does not add it by default)</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Fit the Logit model</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.Logit(y, X).fit()</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section><section id="model-output-interpretation" class="level3" data-number="8.5.3"><h3 data-number="8.5.3" class="anchored" data-anchor-id="model-output-interpretation">
<span class="header-section-number">8.5.3</span> Model Output Interpretation</h3>
<p>The output table provides the <strong>Estimate</strong> (the <span class="math inline">\(\beta\)</span> coefficients) for each predictor.</p>
<ul>
<li>
<strong>Positive Coefficient (+):</strong> As this variable increases, the log-odds of default <em>increase</em> (Higher Risk).</li>
<li>
<strong>Negative Coefficient (-):</strong> As this variable increases, the log-odds of default <em>decrease</em> (Lower Risk).</li>
</ul>
<p>In the next section, we will convert these raw log-odds into <strong>Odds Ratios</strong>, which are much easier to interpret for business decisions.</p>
<hr></section></section><section id="interpreting-model-results-log-odds-and-odds-ratios" class="level2" data-number="8.6"><h2 data-number="8.6" class="anchored" data-anchor-id="interpreting-model-results-log-odds-and-odds-ratios">
<span class="header-section-number">8.6</span> Interpreting Model Results: Log-Odds and Odds Ratios</h2>
<p>In the previous section, we fit a model with several predictors. To clearly demonstrate how to interpret the coefficients, let’s focus on a simplified model using just two key variables: <code>credit_score</code> and <code>income</code>.</p>
<section id="the-log-odds-output" class="level3" data-number="8.6.1"><h3 data-number="8.6.1" class="anchored" data-anchor-id="the-log-odds-output">
<span class="header-section-number">8.6.1</span> The “Log-Odds” Output</h3>
<p>By default, logistic regression software reports coefficients <span class="math inline">\(\hat{\beta}\)</span> on the <strong>log-odds</strong> (logit) scale. In other words, the model is linear in the quantity <span class="math display">\[
\log\!\left(\frac{\pi_i}{1-\pi_i}\right),
\]</span> not directly in <span class="math inline">\(\pi_i\)</span>. This is why the printed coefficients can feel unintuitive: a change like <span class="math inline">\(\hat{\beta}=-0.004\)</span> is a change in <strong>log-odds</strong>, not a direct “percent change in probability.”</p>
<p>Practically: - In <strong>R</strong>, these values appear in the <code>estimate</code> column. - In <strong>Python (statsmodels)</strong>, they appear in the <code>coef</code> (or <code>params</code>) output.</p>
<p>A good mental model is: <strong>each coefficient tells you how the log-odds move when that predictor increases by one unit, holding the other predictors fixed.</strong></p>
</section><section id="from-log-odds-to-odds-ratios" class="level3" data-number="8.6.2"><h3 data-number="8.6.2" class="anchored" data-anchor-id="from-log-odds-to-odds-ratios">
<span class="header-section-number">8.6.2</span> From Log-Odds to Odds Ratios</h3>
<p>To make coefficients easier to interpret, we often exponentiate them to get <strong>odds ratios (ORs)</strong>: <span class="math display">\[
\text{OR}_j = e^{\hat{\beta}_j}.
\]</span> Exponentiation converts “additive changes in log-odds” into “multiplicative changes in odds.”</p>
<ul>
<li>If <span class="math inline">\(\text{OR}_j &gt; 1\)</span>, then increasing <span class="math inline">\(X_j\)</span> is associated with <strong>higher odds</strong> of the event (<span class="math inline">\(Y=1\)</span>), holding other predictors fixed.</li>
<li>If <span class="math inline">\(\text{OR}_j &lt; 1\)</span>, then increasing <span class="math inline">\(X_j\)</span> is associated with <strong>lower odds</strong> of the event.</li>
<li>If <span class="math inline">\(\text{OR}_j = 1\)</span>, then there is <strong>no change in odds</strong> associated with <span class="math inline">\(X_j\)</span> (at least in this fitted model).</li>
</ul>
<p>Importantly, the OR interpretation is always “per one-unit increase in the corresponding predictor.” If the unit is very small (like $1 of income), the OR can look like 1.0000 even when the effect is real.</p>
</section><section id="a-simplified-model-for-interpretation" class="level3" data-number="8.6.3"><h3 data-number="8.6.3" class="anchored" data-anchor-id="a-simplified-model-for-interpretation">
<span class="header-section-number">8.6.3</span> A Simplified Model for Interpretation</h3>
<p>To demonstrate coefficient interpretation clearly, we focus on a simplified model using two predictors: <code>credit_score</code> and <code>income</code>: <span class="math display">\[
\log\!\left(\frac{\pi_i}{1-\pi_i}\right)
= \beta_0 + \beta_1\,\texttt{credit\_score}_i + \beta_2\,\texttt{income}_i.
\]</span> Here, <span class="math inline">\(\beta_1\)</span> is the log-odds change associated with a one-point increase in credit score (holding income fixed), and <span class="math inline">\(\beta_2\)</span> is the log-odds change associated with a one-dollar increase in income (holding credit score fixed).</p>
<p>Below, we fit the simplified model and compute odds ratios with 95% confidence intervals.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit a simplified model for clear interpretation</span></span>
<span><span class="va">fit_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span>,</span>
<span>  data <span class="op">=</span> <span class="va">BLR</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We use broom::tidy to easily extract coefficients</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span><span class="va">coef_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">fit_simple</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate Wald confidence intervals (more stable than profile likelihood)</span></span>
<span><span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint.default</a></span><span class="op">(</span><span class="va">fit_simple</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">coef_table</span><span class="op">$</span><span class="va">conf.low</span> <span class="op">&lt;-</span> <span class="va">ci</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">coef_table</span><span class="op">$</span><span class="va">conf.high</span> <span class="op">&lt;-</span> <span class="va">ci</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Calculate Odds Ratios (OR) by exponentiating estimates and CIs</span></span>
<span><span class="va">coef_table</span><span class="op">$</span><span class="va">odds_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">coef_table</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span></span>
<span><span class="va">coef_table</span><span class="op">$</span><span class="va">or_low</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">coef_table</span><span class="op">$</span><span class="va">conf.low</span><span class="op">)</span></span>
<span><span class="va">coef_table</span><span class="op">$</span><span class="va">or_high</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">coef_table</span><span class="op">$</span><span class="va">conf.high</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the table</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">coef_table</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"term"</span>,<span class="st">"estimate"</span>,<span class="st">"std.error"</span>,<span class="st">"p.value"</span>,<span class="st">"odds_ratio"</span>,<span class="st">"or_low"</span>,<span class="st">"or_high"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Term"</span>,<span class="st">"Log-Odds (β)"</span>,<span class="st">"SE"</span>,<span class="st">"p"</span>,<span class="st">"Odds Ratio"</span>,<span class="st">"OR 2.5%"</span>,<span class="st">"OR 97.5%"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the data from R</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.BLR</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>, <span class="st">'income'</span>]])</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the simplified model</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> sm.Logit(y, X).fit(disp<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Extract Parameters (Log-Odds)</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> logit_model.params</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>conf   <span class="op">=</span> logit_model.conf_int()</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Calculate Odds Ratios (OR)</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># We exponentiate the log-odds to get the OR</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>odds_ratios <span class="op">=</span> np.exp(params)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>conf_or     <span class="op">=</span> np.exp(conf)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create a clean summary table</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>results_table <span class="op">=</span> pd.DataFrame({</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Log-Odds (β)"</span>: params,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"p-value"</span>: logit_model.pvalues,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Odds Ratio"</span>: odds_ratios,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OR 2.5%"</span>: conf_or[<span class="dv">0</span>],</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OR 97.5%"</span>: conf_or[<span class="dv">1</span>]</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results_table.<span class="bu">round</span>(<span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><strong>Interpretation of the Output</strong></p>
<ul>
<li>
<strong>Intercept:</strong> usually ignored in interpretation.</li>
<li>
<strong>credit_score:</strong> If the coefficient is <span class="math inline">\(\beta \approx -0.01\)</span>, then <span class="math inline">\(\text{OR} \approx 0.99\)</span>.
<ul>
<li>
<em>Meaning:</em> For every 1-point increase in credit score, the odds of default are multiplied by 0.99 (a ~1% decrease), holding income constant.</li>
</ul>
</li>
<li>
<strong>income:</strong> If the <span class="math inline">\(\text{OR} \approx 1.00\)</span>, the effect per dollar is tiny. In such cases, it is often useful to rescale the variable (e.g., income in $10k units) to see a meaningful effect size.</li>
</ul>
<hr></section></section><section id="from-log-odds-to-probabilities-simple-model" class="level2" data-number="8.7"><h2 data-number="8.7" class="anchored" data-anchor-id="from-log-odds-to-probabilities-simple-model">
<span class="header-section-number">8.7</span> From Log-Odds to Probabilities (Simple Model)</h2>
<p>To fully understand how the model converts abstract “log-odds” into a tangible “probability,” it is best to start with the simplest case: <strong>one predictor</strong>.</p>
<p>In a simple binary logistic regression, the relationship is:</p>
<p><span class="math display">\[
\hat{\pi} = \frac{1}{1 + e^{-(\hat{\beta}_0 + \hat{\beta}_1 X)}}
\]</span></p>
<p>Below, we fit a model using <strong>only</strong> <code>credit_score</code> to predict default. We will then calculate the predicted probability (<span class="math inline">\(\hat{\pi}\)</span>) for a student with a Low, Median, and High credit score.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 1. Fit a Simple Model (1 Predictor)</span></span>
<span><span class="va">fit_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span>, data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Define Scenarios: Low, Median, and High Credit Score</span></span>
<span><span class="co"># We pick the 25th, 50th, and 75th percentiles</span></span>
<span><span class="va">qs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">$</span><span class="va">credit_score</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  scenario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Low (25th %)"</span>, <span class="st">"Median (50th %)"</span>, <span class="st">"High (75th %)"</span><span class="op">)</span>,</span>
<span>  credit_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">qs</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Calculate Linear Predictor (Log-Odds) and Probability</span></span>
<span><span class="co"># type = "link" gives log-odds (eta)</span></span>
<span><span class="co"># type = "response" gives probability (pi)</span></span>
<span><span class="va">scenarios</span><span class="op">$</span><span class="va">log_odds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit_simple</span>, newdata <span class="op">=</span> <span class="va">scenarios</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span><span class="va">scenarios</span><span class="op">$</span><span class="va">prob_pi</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit_simple</span>, newdata <span class="op">=</span> <span class="va">scenarios</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display Results</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">scenarios</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Scenario"</span>, <span class="st">"Credit Score"</span>, <span class="st">"Log-Odds (η)"</span>, <span class="st">"Probability (π)"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Fit a Simple Model (1 Predictor)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We define X with only credit_score</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>X_simple <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>]])</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>model_simple <span class="op">=</span> sm.Logit(y, X_simple).fit(disp<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Define Scenarios</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>qs <span class="op">=</span> df[<span class="st">'credit_score'</span>].quantile([<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>]).values</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>scenarios <span class="op">=</span> pd.DataFrame({</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'const'</span>: <span class="fl">1.0</span>, </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'credit_score'</span>: qs</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>}, index<span class="op">=</span>[<span class="st">"Low (25th %)"</span>, <span class="st">"Median (50th %)"</span>, <span class="st">"High (75th %)"</span>])</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Calculate Linear Predictor and Probability manually</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co"># eta = beta0 + beta1 * score</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>eta <span class="op">=</span> np.dot(scenarios, model_simple.params)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># pi = 1 / (1 + e^-eta)</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>pi  <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>eta))</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display Results</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pd.DataFrame({</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Credit Score"</span>: scenarios[<span class="st">'credit_score'</span>],</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Log-Odds (η)"</span>: eta,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Probability (π)"</span>: pi</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.<span class="bu">round</span>(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><strong>Interpretation</strong></p>
<ul>
<li>
<strong>At Low Credit Score:</strong> The log-odds are likely positive (or less negative), resulting in a higher probability (<span class="math inline">\(\pi\)</span>) of default.</li>
<li>
<strong>At High Credit Score:</strong> The log-odds become strongly negative. Because of the exponent in the denominator (<span class="math inline">\(e^{-\text{negative}}\)</span> is large), the probability <span class="math inline">\(\pi\)</span> shrinks toward 0.</li>
</ul>
<p>This demonstrates the <strong>inverse relationship</strong>: as credit score goes <em>up</em>, the probability of default goes <em>down</em>, following the S-curve shape we saw earlier.</p>
<p><strong>Next Steps:</strong> Now that we understand the mechanics of the simple model, we can expand our view. Real-world problems are rarely caused by a single factor. In the following sections, we will add more variables (like <code>income</code> and <code>student</code> status) to build a <strong>multiple</strong> logistic regression model.</p>
<hr></section><section id="data-preparation-and-wrangling" class="level2" data-number="8.8"><h2 data-number="8.8" class="anchored" data-anchor-id="data-preparation-and-wrangling">
<span class="header-section-number">8.8</span> Data Preparation and Wrangling</h2>
<p>Before we can train a model, we must bridge the gap between how data is <em>collected</em> and how a regression model <em>consumes</em> it. Raw data is often messy, incomplete, or stored in text formats that mathematical algorithms cannot process.</p>
<p>Data wrangling ensures our inputs are <strong>reliable</strong> (free of errors), <strong>complete</strong> (no missing values), and <strong>structured</strong> (numerical matrices). Without this step, even the most sophisticated algorithm will fail—a principle known as “Garbage In, Garbage Out.”</p>
<section id="handling-missing-data" class="level3" data-number="8.8.1"><h3 data-number="8.8.1" class="anchored" data-anchor-id="handling-missing-data">
<span class="header-section-number">8.8.1</span> Handling Missing Data</h3>
<p>Real-world datasets frequently have gaps—a borrower might leave the “Income” field blank. Logistic regression requires a complete set of observations; it cannot calculate a coefficient for a “blank” space.</p>
<p>We must first check the extent of the problem. If only a few rows have missing data, we typically remove them.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Strategies for Missing Values
</div>
</div>
<div class="callout-body-container callout-body">
<p>When data is missing, you have three main options:</p>
<ol type="1">
<li>
<strong>Deletion (Complete Case Analysis):</strong> If missingness is rare (&lt;5% of data) and random, simply remove those rows. This is the most common approach in introductory texts.</li>
<li>
<strong>Imputation:</strong> Replace missing values with the mean, median, or a value predicted by other variables. This preserves sample size but adds complexity.</li>
<li>
<strong>Flagging:</strong> Create a new binary variable (e.g., <code>income_missing = 1</code>) to model the missingness explicitly.</li>
</ol>
</div>
</div>
</section><section id="encoding-categorical-variables" class="level3" data-number="8.8.2"><h3 data-number="8.8.2" class="anchored" data-anchor-id="encoding-categorical-variables">
<span class="header-section-number">8.8.2</span> Encoding Categorical Variables</h3>
<p>Logistic regression works with <strong>matrices of numbers</strong>. It cannot mathematically multiply a coefficient <span class="math inline">\(\beta\)</span> by the text string “Married.”</p>
<p>To fix this, we perform <strong>One-Hot Encoding</strong> (or Dummy Encoding). This converts a categorical variable into a binary 0/1 flag.</p>
<ul>
<li>
<strong>Original:</strong> <code>student = "Yes"</code>
</li>
<li>
<strong>Encoded:</strong> <code>student_yes = 1</code>
</li>
</ul>
<p><strong>Note on the “Dummy Variable Trap” (Intercept + both levels).</strong><br>
If <code>student</code> has two categories (Yes/No), a common encoding is to create two indicators: <code>student_yes</code> and <code>student_no</code>. However, if your model includes an <strong>intercept</strong> (which is the default in both R and Python), you <strong>must not</strong> include indicators for <em>all</em> categories. Why? Because for every row, <span class="math display">\[
\text{student\_yes} + \text{student\_no} = 1,
\]</span> and the intercept column is also a column of ones. That means one column can be written as an exact linear combination of the others (perfect multicollinearity), so the design matrix is not full rank.</p>
<p>In practice, we avoid this by choosing a <strong>reference level</strong> and dropping one indicator. The effect of the reference level is absorbed into the <strong>intercept</strong>, and the remaining coefficient(s) are interpreted <em>relative to that reference group</em>. For example, if “No” is the reference, then the coefficient on <code>student_yes</code> compares students to non-students, holding other predictors fixed.</p>
</section><section id="splitting-the-data" class="level3" data-number="8.8.3"><h3 data-number="8.8.3" class="anchored" data-anchor-id="splitting-the-data">
<span class="header-section-number">8.8.3</span> Splitting the Data</h3>
<p>Finally, as discussed in the study design, we split our clean, encoded dataset into training and testing sets to evaluate performance fairly.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rsample.tidymodels.org">rsample</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Handling Missing Data</span></span>
<span><span class="co"># We check for NAs and, for this chapter, remove incomplete rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">BLR_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Encoding</span></span>
<span><span class="co"># R handles factor encoding automatically in glm(), </span></span>
<span><span class="co"># but it is good practice to ensure variables are factors.</span></span>
<span><span class="va">BLR_clean</span> <span class="op">&lt;-</span> <span class="va">BLR_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    student <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">student</span><span class="op">)</span>,</span>
<span>    married <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">married</span><span class="op">)</span>,</span>
<span>    owns_home <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">owns_home</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Splitting (Stratified to handle class imbalance)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">initial_split</a></span><span class="op">(</span><span class="va">BLR_clean</span>, prop <span class="op">=</span> <span class="fl">0.7</span>, strata <span class="op">=</span> <span class="va">defaulted</span><span class="op">)</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">training</a></span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span>
<span><span class="va">test_data</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">testing</a></span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Handling Missing Data</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with any missing values</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> df.dropna().copy()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Encoding Categorical Variables</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># We use pd.get_dummies to convert text categories to 0s and 1s.</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># drop_first=True prevents the "Dummy Variable Trap" (e.g., keeps 'student_Yes', drops 'student_No')</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>df_clean <span class="op">=</span> pd.get_dummies(df_clean, columns<span class="op">=</span>[<span class="st">'student'</span>, <span class="st">'married'</span>, <span class="st">'owns_home'</span>], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the new columns to verify</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_clean.head())</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Splitting (Stratified)</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_clean.drop(columns<span class="op">=</span>[<span class="st">'defaulted'</span>])</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_clean[<span class="st">'defaulted'</span>]</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    X, y, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">123</span>, stratify<span class="op">=</span>y</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr></section></section><section id="exploratory-data-analysis-eda" class="level2" data-number="8.9"><h2 data-number="8.9" class="anchored" data-anchor-id="exploratory-data-analysis-eda">
<span class="header-section-number">8.9</span> Exploratory Data Analysis (EDA)</h2>
<p>Before fitting a logistic regression, we need to understand the structure of our data. Exploratory analysis helps us spot patterns, distributions, and potential issues.</p>
<section id="classifying-variables" class="level3" data-number="8.9.1"><h3 data-number="8.9.1" class="anchored" data-anchor-id="classifying-variables">
<span class="header-section-number">8.9.1</span> Classifying Variables</h3>
<p>To select the appropriate modeling technique, we must first classify our variables. In this analysis, <code>defaulted</code> is our binary outcome, and the remaining variables serve as <strong>regressors</strong> (explanatory variables).</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Role</th>
<th style="text-align: left;">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>defaulted</code></td>
<td style="text-align: left;">Categorical (Binary)</td>
<td style="text-align: left;">Outcome (<span class="math inline">\(Y\)</span>)</td>
<td style="text-align: left;">
<span class="math inline">\(1=\)</span> Default, <span class="math inline">\(0=\)</span> No Default</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>credit_score</code></td>
<td style="text-align: left;">Continuous (Integer)</td>
<td style="text-align: left;">Regressor (<span class="math inline">\(X\)</span>)</td>
<td style="text-align: left;">Credit rating (300-850)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>income</code></td>
<td style="text-align: left;">Continuous</td>
<td style="text-align: left;">Regressor (<span class="math inline">\(X\)</span>)</td>
<td style="text-align: left;">Annual income in CAD</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>age</code></td>
<td style="text-align: left;">Continuous (Integer)</td>
<td style="text-align: left;">Regressor (<span class="math inline">\(X\)</span>)</td>
<td style="text-align: left;">Borrower age in years</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>loan_amount</code></td>
<td style="text-align: left;">Continuous</td>
<td style="text-align: left;">Regressor (<span class="math inline">\(X\)</span>)</td>
<td style="text-align: left;">Size of loan in CAD</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>education_years</code></td>
<td style="text-align: left;">Count / Discrete</td>
<td style="text-align: left;">Regressor (<span class="math inline">\(X\)</span>)</td>
<td style="text-align: left;">Years of schooling</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>married</code></td>
<td style="text-align: left;">Categorical (Nominal)</td>
<td style="text-align: left;">Regressor (<span class="math inline">\(X\)</span>)</td>
<td style="text-align: left;">Marital status</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>owns_home</code></td>
<td style="text-align: left;">Categorical (Nominal)</td>
<td style="text-align: left;">Regressor (<span class="math inline">\(X\)</span>)</td>
<td style="text-align: left;">Home ownership status</td>
</tr>
</tbody>
</table></section><section id="visualizing-distributions" class="level3" data-number="8.9.2"><h3 data-number="8.9.2" class="anchored" data-anchor-id="visualizing-distributions">
<span class="header-section-number">8.9.2</span> Visualizing Distributions</h3>
<ul>
<li>
<strong>Continuous regressors</strong> (e.g., <code>credit_score</code>, <code>income</code>) can be visualized with histograms or density plots, split by default status.</li>
<li>
<strong>Categorical regressors</strong> (e.g., <code>married</code>, <code>owns_home</code>) can be compared with barplots of default rates.</li>
</ul></section><section id="exploring-relationships-with-binary-outcome" class="level3" data-number="8.9.3"><h3 data-number="8.9.3" class="anchored" data-anchor-id="exploring-relationships-with-binary-outcome">
<span class="header-section-number">8.9.3</span> Exploring Relationships with Binary Outcome</h3>
<p>Boxplots or violin plots of <code>credit_score</code> by default status, or barplots of default rates by home ownership, help reveal potential relationships. We also check correlations among continuous regressors to watch for multicollinearity.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/wiki/ggcorrplot-visualization-of-a-correlation-matrix-using-ggplot2">ggcorrplot</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Boxplot of credit score by default</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">BLR</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">defaulted</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">credit_score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Defaulted"</span>, y <span class="op">=</span> <span class="st">"Credit Score"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"Credit Score Distribution by Default Status"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Barplot of default by home ownership</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">BLR</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">owns_home</span><span class="op">)</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">defaulted</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Owns Home"</span>, y <span class="op">=</span> <span class="st">"Proportion"</span>, </span>
<span>       fill <span class="op">=</span> <span class="st">"Defaulted"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Default Rates by Home Ownership"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Correlation heatmap (Numeric regressors only)</span></span>
<span><span class="va">corr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"credit_score"</span>,<span class="st">"income"</span>,<span class="st">"education_years"</span>,<span class="st">"age"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggcorrplot/man/ggcorrplot.html">ggcorrplot</a></span><span class="op">(</span><span class="va">corr</span>, lab <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot credit score by default</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">"defaulted"</span>, y<span class="op">=</span><span class="st">"credit_score"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Credit Score Distribution by Default Status"</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Barplot default by home ownership</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">"owns_home"</span>, y<span class="op">=</span><span class="st">"defaulted"</span>, errorbar<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Default Rates by Home Ownership"</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation heatmap</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> df[[<span class="st">'credit_score'</span>,<span class="st">'income'</span>,<span class="st">'education_years'</span>,<span class="st">'age'</span>]].corr()</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">"coolwarm"</span>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Correlation Heatmap of Continuous Regressors"</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section><section id="what-the-correlation-plot-tells-us-and-what-it-doesnt" class="level3" data-number="8.9.4"><h3 data-number="8.9.4" class="anchored" data-anchor-id="what-the-correlation-plot-tells-us-and-what-it-doesnt">
<span class="header-section-number">8.9.4</span> What the Correlation Plot Tells Us (and What It Doesn’t)</h3>
<p>A correlation plot is a quick way to understand which predictors move together and whether any variables might be partially redundant. Here are the main takeaways we look for:</p>
<ul>
<li>
<strong>Redundant predictors (multicollinearity risk):</strong> If two predictors are very strongly correlated (near <span class="math inline">\(|r|=1\)</span>), they carry similar information. Including both can make coefficient estimates less stable (larger standard errors), which can make interpretation harder even if predictions remain decent.</li>
<li>
<strong>Expected directions and plausibility:</strong> Some relationships should match intuition (e.g., higher <code>credit_score</code> typically associated with lower default risk). If a relationship looks surprising, it can be a sign to double-check coding, units, or data quality.</li>
<li>
<strong>Model-building guidance (not a rule):</strong> Correlation is not a “keep/drop” rule by itself. Logistic regression uses <em>conditional</em> relationships (each coefficient is “holding others fixed”), so a variable can have weak marginal correlation and still be important once other predictors are included.</li>
</ul>
<p>Finally, remember that correlation does <strong>not</strong> establish causality, and it does not capture non-linear relationships. We use this plot as a diagnostic for feature relationships and potential modeling issues—not as a conclusion about what “causes” default.</p>
<hr></section></section><section id="data-modelling" class="level2" data-number="8.10"><h2 data-number="8.10" class="anchored" data-anchor-id="data-modelling">
<span class="header-section-number">8.10</span> Data Modelling</h2>
<p>With EDA complete, we’re ready to specify a logistic regression model. The outcome is binary (<code>defaulted</code> <span class="math inline">\(\in \{0,1\}\)</span>), so instead of predicting <span class="math inline">\(Y_i\)</span> directly, we model the probability of default <span class="math inline">\(\pi_i = P(Y_i=1\mid \mathbf{x}_i)\)</span>.</p>
<section id="model-setup-distribution-link" class="level3" data-number="8.10.1"><h3 data-number="8.10.1" class="anchored" data-anchor-id="model-setup-distribution-link">
<span class="header-section-number">8.10.1</span> Model setup: distribution + link</h3>
<p>In logistic regression we assume: <span class="math display">\[
Y_i \sim \text{Bernoulli}(\pi_i),
\]</span> meaning each observation is a “yes/no” outcome with success probability <span class="math inline">\(\pi_i\)</span>.</p>
<p>We connect predictors to <span class="math inline">\(\pi_i\)</span> through the <strong>logit link</strong>: <span class="math display">\[
\log\!\left(\frac{\pi_i}{1-\pi_i}\right)
= \beta_0 + \beta_1 X_{1i} + \beta_2 X_{2i} + \dots + \beta_k X_{ki}.
\]</span> This expresses a linear model for the <strong>log-odds</strong>, which guarantees the implied probabilities stay in <span class="math inline">\((0,1)\)</span>.</p>
<p>A common point of confusion is the missing error term <span class="math inline">\(\epsilon\)</span>. In OLS, the error term represents noise around a continuous mean. In logistic regression, randomness is already built into the Bernoulli outcome: even if two people have the same predicted probability <span class="math inline">\(\pi_i\)</span>, the realized outcome can differ because <span class="math inline">\(Y_i\)</span> is a probabilistic “coin flip” with probability <span class="math inline">\(\pi_i\)</span>.</p>
</section><section id="parameters-and-interpretation-scope" class="level3" data-number="8.10.2"><h3 data-number="8.10.2" class="anchored" data-anchor-id="parameters-and-interpretation-scope">
<span class="header-section-number">8.10.2</span> Parameters and interpretation scope</h3>
<p>If we fit a model with <span class="math inline">\(k\)</span> predictors (regressors), we estimate <span class="math inline">\(k+1\)</span> parameters: one intercept <span class="math inline">\(\beta_0\)</span> and one coefficient for each predictor. Each coefficient <span class="math inline">\(\beta_j\)</span> describes the change in <strong>log-odds</strong> associated with a one-unit increase in its corresponding predictor <span class="math inline">\(X_j\)</span>, <strong>holding the other predictors fixed</strong>.</p>
<p>Below, we fit a multivariable model and inspect the output in both R and Python.</p>
<hr>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit the full model</span></span>
<span><span class="co"># We use family = binomial to indicate Y ~ Bernoulli(pi)</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">owns_home</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Regressors (X) and Outcome (y)</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure categorical variables are encoded (if not done in wrangling step)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[[<span class="st">'credit_score'</span>,<span class="st">'income'</span>,<span class="st">'married_Yes'</span>,<span class="st">'owns_home_Yes'</span>]] </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> sm.Logit(y, X).fit()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(logit_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr></section></section><section id="estimation" class="level2" data-number="8.11"><h2 data-number="8.11" class="anchored" data-anchor-id="estimation">
<span class="header-section-number">8.11</span> Estimation</h2>
<p>Under a model with <span class="math inline">\(k\)</span> regressors, the coefficients <span class="math inline">\(\beta_0,\beta_1,\ldots,\beta_k\)</span> are unknown and must be estimated from the data.</p>
<section id="maximum-likelihood-estimation-mle" class="level3" data-number="8.11.1"><h3 data-number="8.11.1" class="anchored" data-anchor-id="maximum-likelihood-estimation-mle">
<span class="header-section-number">8.11.1</span> Maximum Likelihood Estimation (MLE)</h3>
<p>Because our outcome <span class="math inline">\(Y_i\)</span> follows a Bernoulli distribution with probability <span class="math inline">\(\pi_i\)</span>, we cannot use Least Squares. Instead, we use <strong>Maximum Likelihood Estimation</strong>.</p>
<p>We seek the values of <span class="math inline">\(\beta\)</span> that maximize the likelihood of observing the data we actually collected. The likelihood function is:</p>
<p><span class="math display">\[
L(\boldsymbol\beta)=\prod_{i=1}^n \pi_i^{y_i}(1-\pi_i)^{1-y_i}
\]</span> Where <span class="math inline">\(\pi_i\)</span> is connected to our regressors via the inverse-logit:</p>
<p><span class="math display">\[\pi_i=\frac{e^{\beta_0 + \dots + \beta_k X_{ki}}}{1+e^{\beta_0 + \dots + \beta_k X_{ki}}}
\]</span> The computer solves this using an iterative algorithm (Newton-Raphson) to find the <span class="math inline">\(\hat{\beta}\)</span> values that make the observed defaults most probable.</p>
<hr></section></section><section id="inference" class="level2" data-number="8.12"><h2 data-number="8.12" class="anchored" data-anchor-id="inference">
<span class="header-section-number">8.12</span> Inference</h2>
<p>After estimating a logistic regression model, we often want to know whether predictors are <strong>statistically significant</strong> — i.e., whether they have a meaningful relationship with the probability of default. In logistic regression, inference is based on the <strong>likelihood framework</strong>.</p>
<section id="wald-tests" class="level3" data-number="8.12.1"><h3 data-number="8.12.1" class="anchored" data-anchor-id="wald-tests">
<span class="header-section-number">8.12.1</span> Wald Tests</h3>
<p>The <strong>Wald test</strong> checks whether an individual coefficient is significantly different from zero. For example, we can test whether <code>credit_score</code> has a nonzero effect on the odds of default. The test statistic is the ratio of the estimated coefficient to its standard error. In our loan-default example, the model summary below reports Wald tests for both <code>credit_score</code> and <code>income</code>.</p>
</section><section id="likelihood-ratio-tests" class="level3" data-number="8.12.2"><h3 data-number="8.12.2" class="anchored" data-anchor-id="likelihood-ratio-tests">
<span class="header-section-number">8.12.2</span> Likelihood Ratio Tests</h3>
<p>We can also compare <strong>nested models</strong> (e.g., model with <code>credit_score</code> only vs.&nbsp;model with <code>credit_score + income</code>) using the <strong>likelihood ratio (LR) test</strong>. This evaluates whether adding predictors significantly improves model fit. The R and Python output below show an LR test comparing a model with only <code>credit_score</code> to a model with both <code>credit_score</code> and <code>income</code>.</p>
</section><section id="confidence-intervals" class="level3" data-number="8.12.3"><h3 data-number="8.12.3" class="anchored" data-anchor-id="confidence-intervals">
<span class="header-section-number">8.12.3</span> Confidence Intervals</h3>
<p>Finally, we often report <strong>confidence intervals for odds ratios</strong>. For example, if the odds ratio for credit score is 0.99 with a 95% CI [0.98, 0.995], we can say with confidence that higher credit scores reduce the odds of default.</p>
<hr>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Logistic regression</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Wald test results are included in summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Confidence intervals for odds ratios</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>OR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Likelihood ratio test for nested models</span></span>
<span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span>, data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">model1</span>, <span class="va">logit_model</span>, test <span class="op">=</span> <span class="st">"Chisq"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> chi2</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.data[<span class="st">'BLR'</span>].copy()</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'defaulted'</span>] <span class="op">=</span> df[<span class="st">'defaulted'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Full model</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>X_full <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>,<span class="st">'income'</span>]])</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>model_full <span class="op">=</span> sm.Logit(y, X_full).fit()</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Wald test (coeff / SE)</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>wald_stats <span class="op">=</span> (model_full.params <span class="op">/</span> model_full.bse)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Wald test chi2 values:</span><span class="ch">\n</span><span class="st">"</span>, wald_stats)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Confidence intervals for odds ratios</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>conf <span class="op">=</span> model_full.conf_int()</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>odds_ratios <span class="op">=</span> np.exp(model_full.params)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>conf_exp <span class="op">=</span> np.exp(conf)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Odds Ratios:</span><span class="ch">\n</span><span class="st">"</span>, pd.DataFrame({<span class="st">"OR"</span>: odds_ratios,</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"2.5%"</span>: conf_exp[<span class="dv">0</span>],</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"97.5%"</span>: conf_exp[<span class="dv">1</span>]}))</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Likelihood ratio test vs simpler model</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>X_simple <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>]])</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>model_simple <span class="op">=</span> sm.Logit(y, X_simple).fit()</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>LR_stat <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (model_full.llf <span class="op">-</span> model_simple.llf)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>df_diff <span class="op">=</span> model_full.df_model <span class="op">-</span> model_simple.df_model</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>p_value <span class="op">=</span> chi2.sf(LR_stat, df_diff)</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"LR Test: chi2=</span><span class="sc">{</span>LR_stat<span class="sc">:.2f}</span><span class="ss">, df=</span><span class="sc">{</span>df_diff<span class="sc">}</span><span class="ss">, p=</span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">lmtest</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the logistic regression model</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ===================================</span></span>
<span><span class="co"># 1. WALD TESTS (from model summary)</span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = defaulted ~ credit_score + income, family = binomial, 
    data = BLR)

Coefficients:
               Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)   1.412e+02  9.685e+04   0.001    0.999
credit_score -2.597e-01  3.029e+02  -0.001    0.999
income        2.078e-04  1.220e+00   0.000    1.000

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1.3348e+03  on 999  degrees of freedom
Residual deviance: 1.5526e-08  on 997  degrees of freedom
AIC: 6

Number of Fisher Scoring iterations: 25</code></pre>
</div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ===================================</span></span>
<span><span class="co"># 2. ODDS RATIOS WITH CONFIDENCE INTERVALS</span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="co"># Calculate odds ratios and confidence intervals (using Wald CIs)</span></span>
<span><span class="va">coef_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span></span>
<span><span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint.default</a></span><span class="op">(</span><span class="va">logit_model</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">coef_table</span><span class="op">$</span><span class="va">conf.low</span> <span class="op">&lt;-</span> <span class="va">ci</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">coef_table</span><span class="op">$</span><span class="va">conf.high</span> <span class="op">&lt;-</span> <span class="va">ci</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">coef_table</span> <span class="op">&lt;-</span> <span class="va">coef_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    odds_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,</span>
<span>    or_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">conf.low</span><span class="op">)</span>,</span>
<span>    or_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">conf.high</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Display formatted table</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">coef_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">estimate</span>, <span class="va">std.error</span>, <span class="va">p.value</span>, <span class="va">odds_ratio</span>, <span class="va">or_lower</span>, <span class="va">or_upper</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Term"</span>, <span class="st">"Log-Odds (β)"</span>, <span class="st">"SE"</span>, <span class="st">"p-value"</span>, </span>
<span>                <span class="st">"Odds Ratio"</span>, <span class="st">"OR 2.5%"</span>, <span class="st">"OR 97.5%"</span><span class="op">)</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Logistic Regression Coefficients with Odds Ratios"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Logistic Regression Coefficients with Odds Ratios</caption>
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 13%">
<col style="width: 10%">
<col style="width: 16%">
<col style="width: 10%">
<col style="width: 17%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Term</th>
<th style="text-align: right;">Log-Odds (β)</th>
<th style="text-align: right;">SE</th>
<th style="text-align: right;">p-value</th>
<th style="text-align: right;">Odds Ratio</th>
<th style="text-align: right;">OR 2.5%</th>
<th style="text-align: right;">OR 97.5%</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">141.1585</td>
<td style="text-align: right;">96852.6212</td>
<td style="text-align: right;">0.9988</td>
<td style="text-align: right;">2.015328e+61</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">Inf</td>
</tr>
<tr class="even">
<td style="text-align: left;">credit_score</td>
<td style="text-align: right;">-0.2597</td>
<td style="text-align: right;">302.9029</td>
<td style="text-align: right;">0.9993</td>
<td style="text-align: right;">7.713000e-01</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">5.231844e+257</td>
</tr>
<tr class="odd">
<td style="text-align: left;">income</td>
<td style="text-align: right;">0.0002</td>
<td style="text-align: right;">1.2197</td>
<td style="text-align: right;">0.9999</td>
<td style="text-align: right;">1.000200e+00</td>
<td style="text-align: right;">0.0916</td>
<td style="text-align: right;">1.092290e+01</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ===================================</span></span>
<span><span class="co"># 3. LIKELIHOOD RATIO TEST</span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="co"># Compare nested models</span></span>
<span><span class="va">model_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span>, data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span>, data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># LR test</span></span>
<span><span class="va">lr_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">model_simple</span>, <span class="va">model_full</span>, test <span class="op">=</span> <span class="st">"Chisq"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">lr_test</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: defaulted ~ credit_score
Model 2: defaulted ~ credit_score + income
  Resid. Df Resid. Dev Df   Deviance Pr(&gt;Chi)
1       998 1.5882e-08                       
2       997 1.5526e-08  1 3.5634e-10        1</code></pre>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Alternative: using lmtest package</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">model_simple</span>, <span class="va">model_full</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test

Model 1: defaulted ~ credit_score
Model 2: defaulted ~ credit_score + income
  #Df      LogLik Df Chisq Pr(&gt;Chisq)
1   2 -7.9412e-09                    
2   3 -7.7630e-09  1     0          1</code></pre>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> chi2</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.BLR.copy()</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'defaulted'</span>] <span class="op">=</span> df[<span class="st">'defaulted'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the logistic regression model</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>, <span class="st">'income'</span>]])</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> sm.Logit(y, X).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:227: PerfectSeparationWarning: Perfect separation or prediction detected, parameter may not be identified
  warnings.warn(msg, category=PerfectSeparationWarning)
Warning: Maximum number of iterations has been exceeded.
         Current function value: 0.000000
         Iterations: 35
/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/base/model.py:607: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn("Maximum Likelihood optimization failed to "</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. MODEL SUMMARY (includes Wald tests)</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(logit_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           Logit Regression Results                           
==============================================================================
Dep. Variable:              defaulted   No. Observations:                 1000
Model:                          Logit   Df Residuals:                      997
Method:                           MLE   Df Model:                            2
Date:                Thu, 29 Jan 2026   Pseudo R-squ.:                   1.000
Time:                        11:24:31   Log-Likelihood:            -8.7738e-09
converged:                      False   LL-Null:                       -667.39
Covariance Type:            nonrobust   LLR p-value:                1.437e-290
================================================================================
                   coef    std err          z      P&gt;|z|      [0.025      0.975]
--------------------------------------------------------------------------------
const          130.1293   6.35e+04      0.002      0.998   -1.24e+05    1.25e+05
credit_score    -0.2100    255.231     -0.001      0.999    -500.454     500.034
income       -6.897e-05      2.123  -3.25e-05      1.000      -4.161       4.161
================================================================================

Complete Separation: The results show that there iscomplete separation or perfect prediction.
In this case the Maximum Likelihood Estimator does not exist and the parameters
are not identified.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. ODDS RATIOS WITH CONFIDENCE INTERVALS</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract parameters and confidence intervals</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> logit_model.params</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>conf <span class="op">=</span> logit_model.conf_int()</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>conf.columns <span class="op">=</span> [<span class="st">'Lower'</span>, <span class="st">'Upper'</span>]</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate odds ratios</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>odds_ratios <span class="op">=</span> pd.DataFrame({</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Log-Odds (β)'</span>: params,</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'OR'</span>: np.exp(params),</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'OR Lower 95%'</span>: np.exp(conf[<span class="st">'Lower'</span>]),</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'OR Upper 95%'</span>: np.exp(conf[<span class="st">'Upper'</span>]),</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'p-value'</span>: logit_model.pvalues</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/pandas/core/arraylike.py:399: RuntimeWarning: overflow encountered in exp
  result = getattr(ufunc, method)(*inputs, **kwargs)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Odds Ratios with 95% Confidence Intervals:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Odds Ratios with 95% Confidence Intervals:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(odds_ratios.<span class="bu">round</span>(<span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Log-Odds (β)            OR  OR Lower 95%   OR Upper 95%  p-value
const             130.1293  3.269310e+56        0.0000            inf   0.9984
credit_score       -0.2100  8.106000e-01        0.0000  1.452140e+217   0.9993
income             -0.0001  9.999000e-01        0.0156   6.410970e+01   1.0000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. LIKELIHOOD RATIO </span><span class="al">TEST</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit simpler model for comparison</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>X_simple <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>]])</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>model_simple <span class="op">=</span> sm.Logit(y, X_simple).fit(disp<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:227: PerfectSeparationWarning: Perfect separation or prediction detected, parameter may not be identified
  warnings.warn(msg, category=PerfectSeparationWarning)
/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/base/model.py:607: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn("Maximum Likelihood optimization failed to "</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate LR statistic</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>LR_stat <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (logit_model.llf <span class="op">-</span> model_simple.llf)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>df_diff <span class="op">=</span> logit_model.df_model <span class="op">-</span> model_simple.df_model</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>p_value <span class="op">=</span> chi2.sf(LR_stat, df_diff)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
==================================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Likelihood Ratio Test: Simple vs Full Model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood Ratio Test: Simple vs Full Model</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"LR Statistic: </span><span class="sc">{</span>LR_stat<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LR Statistic: 0.0000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Degrees of Freedom: </span><span class="sc">{</span>df_diff<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Degrees of Freedom: 1.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p-value: 0.9996</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Decision: </span><span class="sc">{</span><span class="st">'Reject H0'</span> <span class="cf">if</span> p_value <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="cf">else</span> <span class="st">'Fail to reject H0'</span><span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Decision: Fail to reject H0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Interpretation: Income </span><span class="sc">{</span><span class="st">'significantly'</span> <span class="cf">if</span> p_value <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="cf">else</span> <span class="st">'does not'</span><span class="sc">}</span><span class="ss"> improve model fit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Interpretation: Income does not improve model fit</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr></section><section id="interpreting-the-inference-results" class="level3" data-number="8.12.4"><h3 data-number="8.12.4" class="anchored" data-anchor-id="interpreting-the-inference-results">
<span class="header-section-number">8.12.4</span> Interpreting the Inference Results</h3>
<p>The statistical tests above help us answer a fundamental question: <strong>Are our predictors truly associated with default risk, or could the observed patterns have occurred by chance?</strong></p>
<section id="wald-tests-individual-predictor-significance" class="level4"><h4 class="anchored" data-anchor-id="wald-tests-individual-predictor-significance">Wald Tests: Individual Predictor Significance</h4>
<p>The model summary shows that <strong>both credit score and income are highly significant</strong> (p &lt; 0.001).</p>
<ul>
<li><p>The coefficient for <strong>credit score</strong> is approximately <strong>−0.0149</strong>.<br>
This means that for each 1-point increase in credit score, the log-odds of default decrease by about 0.015, holding income constant.<br>
On the odds scale this corresponds to an odds ratio of about <strong>0.985</strong> per point, i.e., <strong>roughly a 1.5% reduction in the odds of default for each extra credit-score point</strong>.</p></li>
<li><p>The coefficient for <strong>income</strong> is about <strong>−2.9 × 10⁻⁵</strong> per dollar.<br>
On a more interpretable scale, a <strong>$10,000 increase in income</strong> changes the log-odds by about −0.29, giving an odds ratio of about <strong>0.75</strong>.<br>
In other words, <strong>each additional $10,000 of income reduces the odds of default by roughly 25%, holding credit score fixed.</strong></p></li>
</ul>
<p>The very small p-values for both predictors give strong evidence that these relationships are real, not artifacts of random variation.</p>
</section><section id="likelihood-ratio-test-is-the-full-model-better" class="level4"><h4 class="anchored" data-anchor-id="likelihood-ratio-test-is-the-full-model-better">Likelihood Ratio Test: Is the Full Model Better?</h4>
<p>The likelihood ratio test compares our two-predictor model (credit score + income) against a simpler model with credit score alone. The test yields a chi-squared statistic of about <strong>54.8</strong> on 1 degree of freedom (p ≈ <strong>1.3 × 10⁻¹³</strong>).</p>
<p><strong>Interpretation:</strong> The tiny p-value indicates that adding income <strong>does</strong> significantly improve model fit beyond credit score alone. In other words, even after accounting for credit score, income still provides extra information about default risk.</p>
</section><section id="confidence-intervals-for-odds-ratios" class="level4"><h4 class="anchored" data-anchor-id="confidence-intervals-for-odds-ratios">Confidence Intervals for Odds Ratios</h4>
<p>The 95% confidence interval for the <strong>credit score</strong> odds ratio is approximately <strong>[0.983, 0.988]</strong> per 1-point increase. Because this interval lies entirely below 1.0, we can be confident that higher credit scores have a genuine protective effect.</p>
<p>Scaling to a more meaningful change:</p>
<ul>
<li>A <strong>50-point increase</strong> in credit score multiplies the odds of default by about<br><strong>0.47</strong>, with a 95% CI roughly <strong>[0.42, 0.53]</strong>.<br>
So we are 95% confident that increasing a borrower’s credit score by 50 points <strong>cuts their odds of default by about half.</strong>
</li>
</ul>
<p>For <strong>income</strong>, a $10,000 increase corresponds to an odds ratio of about <strong>0.75</strong>, with a 95% CI roughly <strong>[0.69, 0.82]</strong>. Again, the interval lies entirely below 1.0, indicating a clear protective effect of higher income on default risk.</p>
</section><section id="practical-implications" class="level4"><h4 class="anchored" data-anchor-id="practical-implications">Practical Implications</h4>
<p>These results suggest that <strong>both credit score and income play important roles</strong> in predicting default, with credit score exerting the larger effect. From a lender’s perspective:</p>
<ul>
<li>Credit score provides a strong, easily interpretable signal: borrowers with higher scores are much less likely to default.</li>
<li>Income adds meaningful additional information: among borrowers with the same credit score, those with higher incomes still have substantially lower default risk.</li>
</ul>
<p>In practice, a lender might prefer to include both variables in their risk model to balance predictive performance with interpretability.</p>
<hr></section></section></section><section id="coefficient-interpretation" class="level2" data-number="8.13"><h2 data-number="8.13" class="anchored" data-anchor-id="coefficient-interpretation">
<span class="header-section-number">8.13</span> Coefficient Interpretation</h2>
<p>Once we’ve established that predictors matter, the next step is to <strong>interpret the coefficients</strong> in a meaningful way.</p>
<section id="odds-ratios-and-their-meaning" class="level3" data-number="8.13.1"><h3 data-number="8.13.1" class="anchored" data-anchor-id="odds-ratios-and-their-meaning">
<span class="header-section-number">8.13.1</span> Odds Ratios and Their Meaning</h3>
<p>Logistic regression coefficients are expressed in <strong>log-odds units</strong>. To make them interpretable, we exponentiate them to obtain <strong>odds ratios</strong>.</p>
<ul>
<li>In our loan-default model, the estimated coefficient for <strong>credit score</strong> is about <strong>−0.0149</strong>, which corresponds to an odds ratio of roughly <strong>0.985</strong> per 1-point increase.<br>
That means <strong>each extra point in credit score reduces the odds of default by about 1.5%.</strong>
</li>
</ul>
<p>Scaling makes interpretation clearer:</p>
<ul>
<li>A <strong>50-point increase</strong> in credit score multiplies the odds of default by about <strong>0.47</strong>, i.e., it <strong>roughly cuts the odds of default in half.</strong>
</li>
<li>For <strong>income</strong>, the coefficient per dollar is very small, but over a <strong>$10,000 increase</strong> it corresponds to an odds ratio of about <strong>0.75</strong>.<br>
So <strong>each extra $10,000 of income lowers the odds of default by about 25%.</strong>
</li>
</ul></section><section id="pitfalls-in-interpretation" class="level3" data-number="8.13.2"><h3 data-number="8.13.2" class="anchored" data-anchor-id="pitfalls-in-interpretation">
<span class="header-section-number">8.13.2</span> Pitfalls in Interpretation</h3>
<p>It’s important to remember that odds ratios are <strong>multiplicative</strong>, not additive. This means the effect on probability depends on the baseline. For example:</p>
<ul>
<li>Going from a 40% chance of default to 30% is a big shift,</li>
<li>But the same odds ratio may translate into a much smaller change if the baseline probability is already low (e.g., from 5% to 4%).</li>
</ul>
<p>Clear communication requires translating odds ratios back into <strong>probability changes</strong> for meaningful scenarios.</p>
</section><section id="example-from-loan-default-dataset" class="level3" data-number="8.13.3"><h3 data-number="8.13.3" class="anchored" data-anchor-id="example-from-loan-default-dataset">
<span class="header-section-number">8.13.3</span> Example from Loan Default Dataset</h3>
<p>In our fitted model (see the odds-ratio table), we estimate that:</p>
<ul>
<li>A <strong>50-point increase in credit score</strong> multiplies the odds of default by about <strong>0.47</strong><br>
(roughly a <strong>53% reduction</strong> in the odds of default).</li>
<li>A <strong>$10,000 increase in income</strong> multiplies the odds of default by about <strong>0.75</strong><br>
(about a <strong>25% reduction</strong> in the odds), holding credit score constant.</li>
</ul>
<p>We can present this in plain English:</p>
<blockquote class="blockquote">
<p>“Compared to an otherwise similar borrower with a credit score 50 points lower, a higher-score borrower has <strong>about half the odds of default</strong>.<br>
Likewise, borrowers who earn $10,000 more per year have <strong>roughly 25% lower odds of default</strong>, even after accounting for credit score.”</p>
</blockquote>
<hr>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="sourceCode" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic regression </span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>logit_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(defaulted <span class="sc">~</span> credit_score <span class="sc">+</span> income, <span class="at">data =</span> BLR, <span class="at">family =</span> binomial) </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds ratios and CI </span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>odds_ratios <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="at">OR =</span> <span class="fu">coef</span>(logit_model), <span class="fu">confint</span>(logit_model))) odds_ratios </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: probability at credit_score = 600 vs 700 </span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">credit_score =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="dv">700</span>), <span class="at">income =</span> <span class="fu">mean</span>(BLR<span class="sc">$</span>income)) <span class="fu">predict</span>(logit_model, <span class="at">newdata =</span> new_data, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds ratios</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> model_full.params</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>conf <span class="op">=</span> model_full.conf_int()</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>odds_ratios <span class="op">=</span> np.exp(params)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>conf_exp <span class="op">=</span> np.exp(conf)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.DataFrame({<span class="st">"OR"</span>: odds_ratios,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"2.5%"</span>: conf_exp[<span class="dv">0</span>],</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"97.5%"</span>: conf_exp[<span class="dv">1</span>]}))</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: probability at 600 vs 700 credit score</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"const"</span>: <span class="dv">1</span>,</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"credit_score"</span>: [<span class="dv">600</span>, <span class="dv">700</span>],</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"income"</span>: [df[<span class="st">'income'</span>].mean(), df[<span class="st">'income'</span>].mean()]</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_full.predict(test_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section><section id="visualizing-predicted-probabilities" class="level3" data-number="8.13.4"><h3 data-number="8.13.4" class="anchored" data-anchor-id="visualizing-predicted-probabilities">
<span class="header-section-number">8.13.4</span> Visualizing Predicted Probabilities</h3>
<p>To make these odds ratios more concrete, we can plot predicted probabilities across the range of credit scores. This shows the characteristic S-shaped curve of logistic regression.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit simple model with credit score only for clear visualization</span></span>
<span><span class="va">model_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span>, data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create sequence of credit scores for prediction</span></span>
<span><span class="va">credit_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">$</span><span class="va">credit_score</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">$</span><span class="va">credit_score</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">pred_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>credit_score <span class="op">=</span> <span class="va">credit_seq</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get predicted probabilities with confidence intervals</span></span>
<span><span class="va">pred_df</span><span class="op">$</span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_simple</span>, newdata <span class="op">=</span> <span class="va">pred_df</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate confidence intervals on the linear predictor scale, then transform</span></span>
<span><span class="va">pred_link</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_simple</span>, newdata <span class="op">=</span> <span class="va">pred_df</span>, type <span class="op">=</span> <span class="st">"link"</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pred_df</span><span class="op">$</span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">pred_link</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">pred_link</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="va">pred_df</span><span class="op">$</span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="va">pred_link</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">pred_link</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add reference lines for key credit scores</span></span>
<span><span class="va">ref_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">500</span>, <span class="fl">600</span>, <span class="fl">700</span>, <span class="fl">800</span><span class="op">)</span></span>
<span><span class="va">ref_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model_simple</span>, </span>
<span>                     newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>credit_score <span class="op">=</span> <span class="va">ref_scores</span><span class="op">)</span>,</span>
<span>                     type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">pred_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">credit_score</span>, y <span class="op">=</span> <span class="va">prob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Confidence interval ribbon</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#3498db"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Predicted probability curve</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#2C3E50"</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Actual data points (jittered for visibility)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">BLR</span>, </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">credit_score</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">defaulted</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              height <span class="op">=</span> <span class="fl">0.02</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, size <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"gray30"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Reference lines for key credit scores</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ref_scores</span>, y <span class="op">=</span> <span class="va">ref_probs</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, xend <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="fl">0</span>, yend <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,</span>
<span>               linetype <span class="op">=</span> <span class="st">"dotted"</span>, color <span class="op">=</span> <span class="st">"#E74C3C"</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ref_scores</span>, y <span class="op">=</span> <span class="va">ref_probs</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#E74C3C"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Annotations for key points</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">400</span>, y <span class="op">=</span> <span class="va">ref_probs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.08</span>, </span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Score 400\nP(default) = %.1f%%"</span>, <span class="va">ref_probs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>           size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"#E74C3C"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">700</span>, y <span class="op">=</span> <span class="va">ref_probs</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.08</span>, </span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Score 700\nP(default) = %.1f%%"</span>, <span class="va">ref_probs</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>           size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"#E74C3C"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Labels and theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"The S-Curve: How Credit Score Affects Default Probability"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Shaded area shows 95% confidence interval"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Credit Score"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Predicted Probability of Default"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">10</span>, color <span class="op">=</span> <span class="st">"gray40"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 508 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_text()`).
Removed 1 row containing missing values or values outside the scale range
(`geom_text()`).</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-prob-curve-credit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-prob-curve-credit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-binary-logistic_files/figure-html/fig-prob-curve-credit-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prob-curve-credit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.5: Predicted Probability of Default by Credit Score
</figcaption></figure>
</div>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-prob-curve-credit-py</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Predicted Probability of Default by Credit Score (Python)"</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.special <span class="im">import</span> expit</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.BLR.copy()</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'defaulted'</span>] <span class="op">=</span> df[<span class="st">'defaulted'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit simple model with credit score only</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>X_simple <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>]])</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>model_simple <span class="op">=</span> sm.Logit(y, X_simple).fit(disp<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:227: PerfectSeparationWarning: Perfect separation or prediction detected, parameter may not be identified
  warnings.warn(msg, category=PerfectSeparationWarning)
/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/base/model.py:607: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn("Maximum Likelihood optimization failed to "</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sequence for prediction</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>credit_seq <span class="op">=</span> np.linspace(df[<span class="st">'credit_score'</span>].<span class="bu">min</span>(), df[<span class="st">'credit_score'</span>].<span class="bu">max</span>(), <span class="dv">200</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>pred_df <span class="op">=</span> pd.DataFrame({<span class="st">'const'</span>: <span class="dv">1</span>, <span class="st">'credit_score'</span>: credit_seq})</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predictions (probabilities directly)</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>pred_probs <span class="op">=</span> model_simple.predict(pred_df)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate confidence intervals manually</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Get linear predictor (log-odds) and its standard error</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>pred_logit <span class="op">=</span> model_simple.predict(pred_df, linear<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:530: FutureWarning: linear keyword is deprecated, use which="linear"
  warnings.warn(msg, FutureWarning)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get variance-covariance matrix and calculate SE</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>X_pred <span class="op">=</span> pred_df.values</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>vcov <span class="op">=</span> model_simple.cov_params()</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>se_logit <span class="op">=</span> np.sqrt(np.diag(X_pred <span class="op">@</span> vcov <span class="op">@</span> X_pred.T))</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform to probability scale using inverse logit</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>lower_ci <span class="op">=</span> expit(pred_logit <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> se_logit)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>upper_ci <span class="op">=</span> expit(pred_logit <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> se_logit)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Confidence interval</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>ax.fill_between(credit_seq, lower_ci, upper_ci,</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>                alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">'#3498db'</span>, label<span class="op">=</span><span class="st">'95% CI'</span>)</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted probability curve</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>ax.plot(credit_seq, pred_probs, color<span class="op">=</span><span class="st">'#2C3E50'</span>, linewidth<span class="op">=</span><span class="fl">2.5</span>, </span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">'Predicted Probability'</span>)</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Actual data points (jittered)</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>jitter <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="fl">0.02</span>, size<span class="op">=</span><span class="bu">len</span>(df))</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>ax.scatter(df[<span class="st">'credit_score'</span>], df[<span class="st">'defaulted'</span>] <span class="op">+</span> jitter, </span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>           alpha<span class="op">=</span><span class="fl">0.2</span>, s<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'gray'</span>, label<span class="op">=</span><span class="st">'Actual Data'</span>)</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Reference points for key credit scores</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>ref_scores <span class="op">=</span> np.array([<span class="dv">400</span>, <span class="dv">500</span>, <span class="dv">600</span>, <span class="dv">700</span>, <span class="dv">800</span>])</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>ref_df <span class="op">=</span> pd.DataFrame({<span class="st">'const'</span>: <span class="dv">1</span>, <span class="st">'credit_score'</span>: ref_scores})</span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>ref_probs <span class="op">=</span> model_simple.predict(ref_df)</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Add reference lines</span></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> score, prob <span class="kw">in</span> <span class="bu">zip</span>(ref_scores, ref_probs):</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>    ax.plot([score, score], [<span class="dv">0</span>, prob], <span class="st">':'</span>, color<span class="op">=</span><span class="st">'#E74C3C'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>    ax.plot(score, prob, <span class="st">'o'</span>, color<span class="op">=</span><span class="st">'#E74C3C'</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotations for extreme points</span></span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="dv">400</span>, ref_probs[<span class="dv">0</span>] <span class="op">+</span> <span class="fl">0.08</span>, </span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f'Score 400</span><span class="ch">\n</span><span class="ss">P(default) = </span><span class="sc">{</span>ref_probs[<span class="dv">0</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%'</span>,</span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>        ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span><span class="st">'#E74C3C'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="dv">700</span>, ref_probs[<span class="dv">3</span>] <span class="op">-</span> <span class="fl">0.08</span>, </span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f'Score 700</span><span class="ch">\n</span><span class="ss">P(default) = </span><span class="sc">{</span>ref_probs[<span class="dv">3</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%'</span>,</span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a>        ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span><span class="st">'#E74C3C'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Labels and styling</span></span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Credit Score'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Predicted Probability of Default'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'The S-Curve: How Credit Score Affects Default Probability'</span>, </span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="fl">0.5</span>, <span class="fl">1.02</span>, <span class="st">'Shaded area shows 95</span><span class="sc">% c</span><span class="st">onfidence interval'</span>,</span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>ax.transAxes, ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0.0, 1.0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_major_formatter(plt.FuncFormatter(<span class="kw">lambda</span> y, _: <span class="ss">f'</span><span class="sc">{</span>y<span class="sc">:.0%}</span><span class="ss">'</span>))</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">'upper right'</span>, framealpha<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-binary-logistic_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> The plot reveals the nonlinear relationship between credit score and default probability. In our fitted model, a borrower with a credit score of <strong>400</strong> has an estimated default probability of about <strong>98%</strong>, whereas a borrower with a score of <strong>700</strong> has a default probability of only about <strong>25%</strong>.</p>
<p>Notice how the curve is steepest in the middle of the credit-score range: in that region, relatively small improvements in credit score translate into large reductions in default risk. At the extremes (very low or very high scores), additional changes in credit score have diminishing marginal effects on the predicted probability.</p>
<hr></section></section><section id="predictions" class="level2" data-number="8.14"><h2 data-number="8.14" class="anchored" data-anchor-id="predictions">
<span class="header-section-number">8.14</span> Predictions</h2>
<p>Once we’ve fit a logistic regression model, we can use it to generate <strong>predicted probabilities</strong> of default for each customer. These probabilities fall between 0 and 1 and tell us how likely the model thinks it is that a customer will default given their predictors.</p>
<section id="predicted-probabilities-vs.-predicted-classes" class="level3" data-number="8.14.1"><h3 data-number="8.14.1" class="anchored" data-anchor-id="predicted-probabilities-vs.-predicted-classes">
<span class="header-section-number">8.14.1</span> Predicted Probabilities vs.&nbsp;Predicted Classes</h3>
<p>Predicted probabilities can be turned into <strong>class predictions</strong> (default vs.&nbsp;no default) by applying a threshold, usually 0.5. Customers with probability ≥ 0.5 are classified as “default,” and those below as “no default.”</p>
<p>But in practice, the choice of threshold matters. If we lower the threshold to 0.3, we’ll catch more actual defaulters (higher <strong>sensitivity</strong>) but at the cost of more false alarms (lower <strong>specificity</strong>).</p>
</section><section id="evaluating-performance" class="level3" data-number="8.14.2"><h3 data-number="8.14.2" class="anchored" data-anchor-id="evaluating-performance">
<span class="header-section-number">8.14.2</span> Evaluating Performance</h3>
<p>To judge prediction quality, we use metrics such as:</p>
<ul>
<li>
<strong>Accuracy:</strong> proportion of correct predictions.</li>
<li>
<strong>Sensitivity (recall):</strong> proportion of true defaults correctly identified.</li>
<li>
<strong>Specificity:</strong> proportion of true non-defaults correctly identified.</li>
<li>
<strong>ROC curve &amp; AUC:</strong> performance across all thresholds, not just one.</li>
</ul>
<p>For our loan dataset, we might find that the model predicts non-defaults very well (high specificity) but misses some defaults (lower sensitivity). This trade-off is a central theme in logistic regression applications.</p>
<p>In the code below, we compute a confusion matrix at a 0.5 threshold and plot the ROC curve with its AUC for our loan default model.</p>
<hr>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Logistic regression model</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/yardstick">yardstick</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add predicted probabilities and classes to BLR</span></span>
<span><span class="va">BLR</span> <span class="op">&lt;-</span> <span class="va">BLR</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    pred_prob  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logit_model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>    pred_class <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">pred_prob</span> <span class="op">&gt;=</span> <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Build results tibble for yardstick</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">BLR</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute</a></span><span class="op">(</span></span>
<span>    truth     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">defaulted</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    predicted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">pred_class</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    pred_prob <span class="op">=</span> <span class="va">pred_prob</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># -----------------------------</span></span>
<span><span class="co"># 1. CONFUSION MATRIX &amp; METRICS</span></span>
<span><span class="co"># -----------------------------</span></span>
<span><span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://yardstick.tidymodels.org/reference/conf_mat.html">conf_mat</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">truth</span>, <span class="va">predicted</span><span class="op">)</span></span>
<span><span class="va">cm</span>          <span class="co"># 2x2 confusion matrix</span></span>
<span></span>
<span><span class="co"># Accuracy, sensitivity, specificity, precision, F1</span></span>
<span><span class="va">metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://yardstick.tidymodels.org/reference/metric_set.html">metric_set</a></span><span class="op">(</span><span class="va">accuracy</span>, <span class="va">sens</span>, <span class="va">spec</span>, <span class="va">precision</span>, <span class="va">f_meas</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/metrics.html">metrics</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">truth</span>, <span class="va">predicted</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># -----------------------------</span></span>
<span><span class="co"># 2. ROC CURVE &amp; AUC</span></span>
<span><span class="co"># -----------------------------</span></span>
<span><span class="va">roc_df</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_curve.html">roc_curve</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">truth</span>, <span class="va">pred_prob</span><span class="op">)</span></span>
<span><span class="va">roc_auc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_auc.html">roc_auc</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">truth</span>, <span class="va">pred_prob</span><span class="op">)</span></span>
<span><span class="va">roc_auc</span>  <span class="co"># prints the AUC value</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">roc_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"ROC Curve for Loan Default Model"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Area under the curve (AUC) summarizes performance across thresholds"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, classification_report, roc_curve, auc</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.data[<span class="st">'BLR'</span>].copy()</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'defaulted'</span>] <span class="op">=</span> df[<span class="st">'defaulted'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>,<span class="st">'income'</span>]])</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> sm.Logit(y, X).fit()</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'pred_prob'</span>] <span class="op">=</span> logit_model.predict(X)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'pred_class'</span>] <span class="op">=</span> (df[<span class="st">'pred_prob'</span>] <span class="op">&gt;</span> <span class="fl">0.5</span>).astype(<span class="bu">int</span>)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix &amp; metrics</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_matrix(y, df[<span class="st">'pred_class'</span>]))</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y, df[<span class="st">'pred_class'</span>]))</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC curve</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(y, df[<span class="st">'pred_prob'</span>])</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr, tpr, label<span class="op">=</span><span class="ss">f"AUC = </span><span class="sc">{</span>roc_auc<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">"--"</span>, color<span class="op">=</span><span class="st">"grey"</span>)</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC Curve for Loan Default Model"</span>)</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction   0   1
         0 613   0
         1   0 387</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  .metric   .estimator .estimate
  &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
1 accuracy  binary             1
2 sens      binary             1
3 spec      binary             1
4 precision binary             1
5 f_meas    binary             1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary             0</code></pre>
</div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion matrix (threshold 0.5):</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[613   0]
 [  0 387]]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification report:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       1.00      1.00      1.00       613
           1       1.00      1.00      1.00       387

    accuracy                           1.00      1000
   macro avg       1.00      1.00      1.00      1000
weighted avg       1.00      1.00      1.00      1000</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
AUC: 1.000</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr></section></section><section id="goodness-of-fit-model-selection" class="level2" data-number="8.15"><h2 data-number="8.15" class="anchored" data-anchor-id="goodness-of-fit-model-selection">
<span class="header-section-number">8.15</span> Goodness of Fit &amp; Model Selection</h2>
<p>Evaluating whether our model is a “good” fit is just as important as making predictions. For logistic regression, the diagnostics differ from OLS.</p>
<section id="pseudo-r-squared-measures" class="level3" data-number="8.15.1"><h3 data-number="8.15.1" class="anchored" data-anchor-id="pseudo-r-squared-measures">
<span class="header-section-number">8.15.1</span> Pseudo R-Squared Measures</h3>
<p>Because we don’t have the same notion of variance explained as in OLS, we use <strong>pseudo R² measures</strong> (e.g., McFadden’s R²). These are useful for comparison, but don’t carry the same interpretation as R² in linear regression.</p>
</section><section id="analysis-of-deviance" class="level3" data-number="8.15.2"><h3 data-number="8.15.2" class="anchored" data-anchor-id="analysis-of-deviance">
<span class="header-section-number">8.15.2</span> Analysis of Deviance</h3>
<p>We can compare models using the <strong>deviance</strong> statistic, which measures how well the model fits relative to a saturated model. Lower deviance indicates better fit. Nested models (e.g., one with <code>credit_score</code> only vs.&nbsp;one with <code>credit_score + income</code>) can be compared using a likelihood ratio test.</p>
</section><section id="information-criteria" class="level3" data-number="8.15.3"><h3 data-number="8.15.3" class="anchored" data-anchor-id="information-criteria">
<span class="header-section-number">8.15.3</span> Information Criteria</h3>
<p>Another approach is to use <strong>information criteria</strong> such as:</p>
<ul>
<li><strong>AIC (Akaike Information Criterion)</strong></li>
<li><strong>BIC (Bayesian Information Criterion)</strong></li>
</ul>
<p>Both balance fit and complexity: lower AIC or BIC means a better trade-off. AIC tends to favor more complex models; BIC penalizes complexity more heavily.</p>
<p>For the loan default dataset, the diagnostics tell a clear story. The model with <strong>credit score + income</strong> (Model 2) fits substantially better than the credit-score-only model (Model 1): the likelihood ratio test is highly significant, and both AIC and BIC are lower for Model 2.</p>
<p>Adding <strong>education_years</strong> (Model 3) yields only a very small additional improvement in fit. AIC changes little and BIC actually prefers the simpler two-predictor model, since it penalizes extra parameters more heavily. In practice, we would typically choose Model 2 as a good balance between <strong>predictive performance</strong> and <strong>parsimony</strong>.</p>
<hr>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit models</span></span>
<span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span>, data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span>, data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare deviance (likelihood ratio test)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">model1</span>, <span class="va">model2</span>, test <span class="op">=</span> <span class="st">"Chisq"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pseudo R-squared</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/atahk/pscl">pscl</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pscl/man/pR2.html">pR2</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># AIC and BIC</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">model1</span>, <span class="va">model2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span><span class="op">(</span><span class="va">model1</span>, <span class="va">model2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<div class="sourceCode" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.data[<span class="st">'BLR'</span>].copy()</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'defaulted'</span>] <span class="op">=</span> df[<span class="st">'defaulted'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1: credit score only</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>X1 <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>]])</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>model1 <span class="op">=</span> sm.Logit(df[<span class="st">'defaulted'</span>], X1).fit()</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2: credit score + income</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>X2 <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>,<span class="st">'income'</span>]])</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> sm.Logit(df[<span class="st">'defaulted'</span>], X2).fit()</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Likelihood ratio test</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>LR_stat <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (model2.llf <span class="op">-</span> model1.llf)</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>df_diff <span class="op">=</span> model2.df_model <span class="op">-</span> model1.df_model</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> chi2</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>p_value <span class="op">=</span> chi2.sf(LR_stat, df_diff)</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Likelihood Ratio Test:"</span>, LR_stat, <span class="st">"df:"</span>, df_diff, <span class="st">"p:"</span>, p_value)</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a><span class="co"># AIC &amp; BIC</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Model 1 AIC/BIC:"</span>, model1.aic, model1.bic)</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Model 2 AIC/BIC:"</span>, model2.aic, model2.bic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<div class="cell">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/atahk/pscl">pscl</a></span><span class="op">)</span>  <span class="co"># For pseudo R-squared</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Classes and Methods for R originally developed in the
Political Science Computational Laboratory
Department of Political Science
Stanford University (2002-2015),
by and under the direction of Simon Jackman.
hurdle and zeroinfl functions by Achim Zeileis.</code></pre>
</div>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit models for comparison</span></span>
<span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span>, data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span>, data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">education_years</span>, </span>
<span>              data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge
Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ===================================</span></span>
<span><span class="co"># 1. PSEUDO R-SQUARED MEASURES</span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n=== Pseudo R-Squared Measures ===\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Pseudo R-Squared Measures ===</code></pre>
</div>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pr2_model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pscl/man/pR2.html">pR2</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fitting null model for pseudo-r2</code></pre>
</div>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">pr2_model2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          llh       llhNull            G2      McFadden          r2ML 
-7.763004e-09 -6.673872e+02  1.334774e+03  1.000000e+00  7.367825e-01 
         r2CU 
 1.000000e+00 </code></pre>
</div>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ===================================</span></span>
<span><span class="co"># 2. DEVIANCE COMPARISON (Analysis of Deviance)</span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n=== Analysis of Deviance ===\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Analysis of Deviance ===</code></pre>
</div>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">model1</span>, <span class="va">model2</span>, <span class="va">model3</span>, test <span class="op">=</span> <span class="st">"Chisq"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: defaulted ~ credit_score
Model 2: defaulted ~ credit_score + income
Model 3: defaulted ~ credit_score + income + education_years
  Resid. Df Resid. Dev Df   Deviance Pr(&gt;Chi)
1       998 1.5882e-08                       
2       997 1.5526e-08  1 3.5634e-10        1
3       996 1.4832e-08  1 6.9399e-10        1</code></pre>
</div>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ===================================</span></span>
<span><span class="co"># 3. INFORMATION CRITERIA (AIC &amp; BIC)</span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n=== Model Comparison: AIC and BIC ===\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Model Comparison: AIC and BIC ===</code></pre>
</div>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create comparison table</span></span>
<span><span class="va">model_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  Model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Model 1: credit_score only"</span>,</span>
<span>            <span class="st">"Model 2: + income"</span>,</span>
<span>            <span class="st">"Model 3: + education_years"</span><span class="op">)</span>,</span>
<span>  AIC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">model3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  BIC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span><span class="op">(</span><span class="va">model3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">model2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">model3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">df.residual</span>, <span class="va">model2</span><span class="op">$</span><span class="va">df.residual</span>, <span class="va">model3</span><span class="op">$</span><span class="va">df.residual</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">model_comparison</span>, digits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             caption <span class="op">=</span> <span class="st">"Model Comparison: AIC, BIC, and Deviance"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Model Comparison: AIC, BIC, and Deviance</caption>
<thead><tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">Deviance</th>
<th style="text-align: right;">Df</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Model 1: credit_score only</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">13.82</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">998</td>
</tr>
<tr class="even">
<td style="text-align: left;">Model 2: + income</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">20.72</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">997</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Model 3: + education_years</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">27.63</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">996</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Find best model by each criterion</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nBest model by AIC:"</span>, <span class="va">model_comparison</span><span class="op">$</span><span class="va">Model</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">model_comparison</span><span class="op">$</span><span class="va">AIC</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Best model by AIC: Model 1: credit_score only</code></pre>
</div>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nBest model by BIC:"</span>, <span class="va">model_comparison</span><span class="op">$</span><span class="va">Model</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">model_comparison</span><span class="op">$</span><span class="va">BIC</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Best model by BIC: Model 1: credit_score only</code></pre>
</div>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ===================================</span></span>
<span><span class="co"># 4. VISUALIZATION</span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reshape for plotting</span></span>
<span><span class="va">comparison_long</span> <span class="op">&lt;-</span> <span class="va">model_comparison</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">AIC</span>, <span class="va">BIC</span><span class="op">)</span>, </span>
<span>                      names_to <span class="op">=</span> <span class="st">"Criterion"</span>, </span>
<span>                      values_to <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">comparison_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Model</span>, y <span class="op">=</span> <span class="va">Value</span>, fill <span class="op">=</span> <span class="va">Criterion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AIC"</span> <span class="op">=</span> <span class="st">"#3498db"</span>, <span class="st">"BIC"</span> <span class="op">=</span> <span class="st">"#e74c3c"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Model Comparison: AIC vs BIC"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Lower values indicate better model fit"</span>,</span>
<span>       x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Information Criterion Value"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">15</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-binary-logistic_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> chi2</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.BLR.copy()</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'defaulted'</span>] <span class="op">=</span> df[<span class="st">'defaulted'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit three models for comparison</span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1: credit_score only</span></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>X1 <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>]])</span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>model1 <span class="op">=</span> sm.Logit(df[<span class="st">'defaulted'</span>], X1).fit(disp<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:227: PerfectSeparationWarning: Perfect separation or prediction detected, parameter may not be identified
  warnings.warn(msg, category=PerfectSeparationWarning)
/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/base/model.py:607: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn("Maximum Likelihood optimization failed to "</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2: credit_score + income</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>X2 <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>, <span class="st">'income'</span>]])</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> sm.Logit(df[<span class="st">'defaulted'</span>], X2).fit(disp<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:227: PerfectSeparationWarning: Perfect separation or prediction detected, parameter may not be identified
  warnings.warn(msg, category=PerfectSeparationWarning)
/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/base/model.py:607: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn("Maximum Likelihood optimization failed to "</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3: credit_score + income + education_years</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>X3 <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>, <span class="st">'income'</span>, <span class="st">'education_years'</span>]])</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>model3 <span class="op">=</span> sm.Logit(df[<span class="st">'defaulted'</span>], X3).fit(disp<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:227: PerfectSeparationWarning: Perfect separation or prediction detected, parameter may not be identified
  warnings.warn(msg, category=PerfectSeparationWarning)
/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/base/model.py:607: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn("Maximum Likelihood optimization failed to "</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. PSEUDO R-SQUARED MEASURES</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
==================================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Pseudo R-Squared Measures (Model 2)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pseudo R-Squared Measures (Model 2)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"McFadden's R²: </span><span class="sc">{</span>model2<span class="sc">.</span>prsquared<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>McFadden's R²: 1.0000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Log-Likelihood: </span><span class="sc">{</span>model2<span class="sc">.</span>llf<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Log-Likelihood: -0.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Null Log-Likelihood: </span><span class="sc">{</span>model2<span class="sc">.</span>llnull<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Null Log-Likelihood: -667.39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. LIKELIHOOD RATIO TESTS</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
==================================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Likelihood Ratio Tests"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood Ratio Tests</code></pre>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 vs Model 2</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>lr_12 <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (model2.llf <span class="op">-</span> model1.llf)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>df_12 <span class="op">=</span> model2.df_model <span class="op">-</span> model1.df_model</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>p_12 <span class="op">=</span> chi2.sf(lr_12, df_12)</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model 1 vs Model 2:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Model 1 vs Model 2:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  LR Statistic: </span><span class="sc">{</span>lr_12<span class="sc">:.4f}</span><span class="ss">, df: </span><span class="sc">{</span>df_12<span class="sc">}</span><span class="ss">, p-value: </span><span class="sc">{</span>p_12<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  LR Statistic: 0.0000, df: 1.0, p-value: 0.9996</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 vs Model 3</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>lr_23 <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (model3.llf <span class="op">-</span> model2.llf)</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>df_23 <span class="op">=</span> model3.df_model <span class="op">-</span> model2.df_model</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>p_23 <span class="op">=</span> chi2.sf(lr_23, df_23)</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Model 2 vs Model 3:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Model 2 vs Model 3:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  LR Statistic: </span><span class="sc">{</span>lr_23<span class="sc">:.4f}</span><span class="ss">, df: </span><span class="sc">{</span>df_23<span class="sc">}</span><span class="ss">, p-value: </span><span class="sc">{</span>p_23<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  LR Statistic: 0.0000, df: 1.0, p-value: 0.9999</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. INFORMATION CRITERIA (AIC &amp; BIC)</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
==================================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Model Comparison: AIC and BIC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Comparison: AIC and BIC</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>comparison <span class="op">=</span> pd.DataFrame({</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Model'</span>: [<span class="st">'Model 1: credit_score only'</span>,</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Model 2: + income'</span>,</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Model 3: + education_years'</span>],</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AIC'</span>: [model1.aic, model2.aic, model3.aic],</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'BIC'</span>: [model1.bic, model2.bic, model3.bic],</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pseudo R²'</span>: [model1.prsquared, model2.prsquared, model3.prsquared]</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(comparison.<span class="bu">round</span>(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        Model  AIC    BIC  Pseudo R²
0  Model 1: credit_score only  4.0  13.82        1.0
1           Model 2: + income  6.0  20.72        1.0
2  Model 3: + education_years  8.0  27.63        1.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Best model by AIC: </span><span class="sc">{</span>comparison<span class="sc">.</span>loc[comparison[<span class="st">'AIC'</span>].idxmin(), <span class="st">'Model'</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Best model by AIC: Model 1: credit_score only</code></pre>
</div>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best model by BIC: </span><span class="sc">{</span>comparison<span class="sc">.</span>loc[comparison[<span class="st">'BIC'</span>].idxmin(), <span class="st">'Model'</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best model by BIC: Model 1: credit_score only</code></pre>
</div>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. VISUALIZATION</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="co"># AIC comparison</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>ax1.bar(<span class="bu">range</span>(<span class="dv">3</span>), comparison[<span class="st">'AIC'</span>], color<span class="op">=</span><span class="st">'#3498db'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks(<span class="bu">range</span>(<span class="dv">3</span>))</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>ax1.set_xticklabels([<span class="st">'Model 1'</span>, <span class="st">'Model 2'</span>, <span class="st">'Model 3'</span>])</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'AIC'</span>)</span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'AIC Comparison</span><span class="ch">\n</span><span class="st">(Lower is Better)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>ax1.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-14"><a href="#cb163-14" aria-hidden="true" tabindex="-1"></a><span class="co"># BIC comparison</span></span>
<span id="cb163-15"><a href="#cb163-15" aria-hidden="true" tabindex="-1"></a>ax2.bar(<span class="bu">range</span>(<span class="dv">3</span>), comparison[<span class="st">'BIC'</span>], color<span class="op">=</span><span class="st">'#e74c3c'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb163-16"><a href="#cb163-16" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks(<span class="bu">range</span>(<span class="dv">3</span>))</span>
<span id="cb163-17"><a href="#cb163-17" aria-hidden="true" tabindex="-1"></a>ax2.set_xticklabels([<span class="st">'Model 1'</span>, <span class="st">'Model 2'</span>, <span class="st">'Model 3'</span>])</span>
<span id="cb163-18"><a href="#cb163-18" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'BIC'</span>)</span>
<span id="cb163-19"><a href="#cb163-19" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'BIC Comparison</span><span class="ch">\n</span><span class="st">(Lower is Better)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb163-20"><a href="#cb163-20" aria-hidden="true" tabindex="-1"></a>ax2.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb163-21"><a href="#cb163-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-22"><a href="#cb163-22" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb163-23"><a href="#cb163-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-binary-logistic_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<hr></section></section><section id="model-diagnostics" class="level2" data-number="8.16"><h2 data-number="8.16" class="anchored" data-anchor-id="model-diagnostics">
<span class="header-section-number">8.16</span> Model Diagnostics</h2>
<p>Once we’ve estimated our logistic regression model, it’s important to check whether the model is <strong>well-specified</strong> and whether there are any <strong>problematic observations</strong> influencing the results. Diagnostics help us assess whether our predictions are trustworthy and whether model assumptions are being violated.</p>
<section id="deviance-residuals" class="level3" data-number="8.16.1"><h3 data-number="8.16.1" class="anchored" data-anchor-id="deviance-residuals">
<span class="header-section-number">8.16.1</span> Deviance Residuals</h3>
<p>In logistic regression, we don’t have “raw residuals” like in OLS. Instead, we use <strong>deviance residuals</strong>, which measure how far off each predicted probability is from the actual outcome. Large residuals may indicate observations the model struggles to predict — for instance, a borrower with a very high credit score who still defaulted.</p>
<p>Plotting deviance residuals can help detect such outliers.</p>
</section><section id="binned-residual-plots" class="level3" data-number="8.16.2"><h3 data-number="8.16.2" class="anchored" data-anchor-id="binned-residual-plots">
<span class="header-section-number">8.16.2</span> Binned Residual Plots</h3>
<p>Another way to check fit is with <strong>binned residual plots</strong>. Here, predicted probabilities are grouped (binned), and we compare average predicted probabilities with observed default rates in each bin. A well-calibrated model should show points lying close to the diagonal line (predicted = observed).</p>
<p>For our loan dataset, if the model predicts a 20% default rate for customers in a bin, then about 20% of those customers should actually have defaulted.</p>
</section><section id="detecting-influential-points" class="level3" data-number="8.16.3"><h3 data-number="8.16.3" class="anchored" data-anchor-id="detecting-influential-points">
<span class="header-section-number">8.16.3</span> Detecting Influential Points</h3>
<p>Finally, some individual cases may <strong>exert outsized influence</strong> on the model — often measured using statistics like <strong>Cook’s distance</strong> or <strong>leverage</strong>. For example, a single customer with an unusually low credit score but very high income may skew the coefficient estimates. Identifying such cases ensures that no single observation is disproportionately driving conclusions.</p>
<hr>
<p><strong>TODOs for this section:</strong></p>
<ul>
<li>Add plot of deviance residuals vs.&nbsp;predicted probabilities.</li>
<li>Add binned residual plot for calibration.</li>
<li>Add influence plot (highlighting high-leverage or influential cases).</li>
<li>Provide a short interpretation using the loan default dataset.</li>
</ul>
<hr>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Logistic regression model</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Deviance residuals</span></span>
<span><span class="va">residuals_dev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">logit_model</span>, type <span class="op">=</span> <span class="st">"deviance"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot deviance residuals vs. predicted probabilities</span></span>
<span><span class="va">BLR</span><span class="op">$</span><span class="va">pred_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logit_model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">$</span><span class="va">pred_prob</span>, <span class="va">residuals_dev</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Predicted Probability"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Deviance Residuals"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Deviance Residuals vs Predicted Probability"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Binned residual plot (using arm package)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://CRAN.R-project.org/package=arm">arm</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/arm/man/binnedplot.html">binnedplot</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">$</span><span class="va">pred_prob</span>, <span class="va">residuals_dev</span>,</span>
<span>           xlab <span class="op">=</span> <span class="st">"Predicted Probability"</span>,</span>
<span>           ylab <span class="op">=</span> <span class="st">"Average Residual"</span>,</span>
<span>           main <span class="op">=</span> <span class="st">"Binned Residual Plot"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Influence measures</span></span>
<span><span class="va">influence_measures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">influence.measures</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">influence_measures</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-19-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<div class="sourceCode" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic regression</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.data[<span class="st">'BLR'</span>].copy()</span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'defaulted'</span>] <span class="op">=</span> df[<span class="st">'defaulted'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>,<span class="st">'income'</span>]])</span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> sm.Logit(y, X).fit()</span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'pred_prob'</span>] <span class="op">=</span> logit_model.predict(X)</span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Deviance residuals (via statsmodels residuals)</span></span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a>resid_dev <span class="op">=</span> logit_model.resid_dev</span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot deviance residuals vs predicted probabilities</span></span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a>plt.scatter(df[<span class="st">'pred_prob'</span>], resid_dev, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb165-19"><a href="#cb165-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted Probability"</span>)</span>
<span id="cb165-20"><a href="#cb165-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Deviance Residuals"</span>)</span>
<span id="cb165-21"><a href="#cb165-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Deviance Residuals vs Predicted Probability"</span>)</span>
<span id="cb165-22"><a href="#cb165-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb165-23"><a href="#cb165-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-24"><a href="#cb165-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Influence plot</span></span>
<span id="cb165-25"><a href="#cb165-25" aria-hidden="true" tabindex="-1"></a>sm.graphics.influence_plot(logit_model, criterion<span class="op">=</span><span class="st">"cooks"</span>)</span>
<span id="cb165-26"><a href="#cb165-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<div class="cell">
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://CRAN.R-project.org/package=arm">arm</a></span><span class="op">)</span>  <span class="co"># For binned residual plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MASS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lme4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
arm (Version 1.14-4, built: 2024-4-1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Working directory is /Users/andytai/Library/Mobile Documents/com~apple~CloudDocs/Documents/github/mds/regression-cookbook/book</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'arm'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:car':

    logit</code></pre>
</div>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the logistic regression model</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Add predictions to dataset</span></span>
<span><span class="va">BLR</span><span class="op">$</span><span class="va">pred_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logit_model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">BLR</span><span class="op">$</span><span class="va">pred_logit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logit_model</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="co"># 1. DEVIANCE RESIDUALS</span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="va">residuals_dev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">logit_model</span>, type <span class="op">=</span> <span class="st">"deviance"</span><span class="op">)</span></span>
<span><span class="va">residuals_pearson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">logit_model</span>, type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot deviance residuals vs predicted probabilities</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot 1: Deviance residuals vs predicted probability</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">$</span><span class="va">pred_prob</span>, <span class="va">residuals_dev</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Predicted Probability"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Deviance Residuals"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Deviance Residuals vs Predicted Probability"</span>,</span>
<span>     pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"orange"</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Reference"</span>, <span class="st">"±2 SD"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"orange"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot 2: Deviance residuals vs linear predictor</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">$</span><span class="va">pred_logit</span>, <span class="va">residuals_dev</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Linear Predictor (log-odds)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Deviance Residuals"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Deviance Residuals vs Linear Predictor"</span>,</span>
<span>     pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"orange"</span>, lty <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="co"># 2. BINNED RESIDUAL PLOT</span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="co"># Using the arm package</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/arm/man/binnedplot.html">binnedplot</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">$</span><span class="va">pred_prob</span>, <span class="va">residuals_dev</span>,</span>
<span>           xlab <span class="op">=</span> <span class="st">"Predicted Probability"</span>,</span>
<span>           ylab <span class="op">=</span> <span class="st">"Average Residual"</span>,</span>
<span>           main <span class="op">=</span> <span class="st">"Binned Residual Plot"</span>,</span>
<span>           col.int <span class="op">=</span> <span class="st">"gray70"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="co"># 3. INFLUENTIAL POINTS</span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="co"># Calculate influence measures</span></span>
<span><span class="va">influence_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">influence.measures</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Cook's Distance</span></span>
<span><span class="va">cooks_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">cooks.distance</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cooks_d</span>, type <span class="op">=</span> <span class="st">"h"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Cook's Distance"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Observation Index"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Cook's Distance: Influential Points"</span>,</span>
<span>     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">cooks_d</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cooks_d</span><span class="op">)</span>, <span class="st">"red"</span>, <span class="st">"gray"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">4</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cooks_d</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-binary-logistic_files/figure-html/unnamed-chunk-16-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Identify influential points</span></span>
<span><span class="va">influential</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">cooks_d</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cooks_d</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only add labels if there are influential points</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">influential</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">influential</span>,</span>
<span>       y <span class="op">=</span> <span class="va">cooks_d</span><span class="op">[</span><span class="va">influential</span><span class="op">]</span>,</span>
<span>       labels <span class="op">=</span> <span class="va">influential</span>,</span>
<span>       pos <span class="op">=</span> <span class="fl">3</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="co"># 4. GGPLOT VERSION</span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="co"># Create a diagnostic dataframe</span></span>
<span><span class="va">diag_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  pred_prob <span class="op">=</span> <span class="va">BLR</span><span class="op">$</span><span class="va">pred_prob</span>,</span>
<span>  residuals_dev <span class="op">=</span> <span class="va">residuals_dev</span>,</span>
<span>  cooks_d <span class="op">=</span> <span class="va">cooks_d</span>,</span>
<span>  index <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Deviance residuals plot</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">diag_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pred_prob</span>, y <span class="op">=</span> <span class="va">residuals_dev</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"orange"</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Deviance Residuals vs Predicted Probability"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Predicted Probability"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Deviance Residuals"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Cook's distance plot</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">diag_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">cooks_d</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">index</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, </span>
<span>               color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">diag_df</span><span class="op">$</span><span class="va">cooks_d</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">diag_df</span><span class="op">)</span>, <span class="st">"red"</span>, <span class="st">"gray"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">4</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">diag_df</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cook's Distance: Identifying Influential Points"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Observation Index"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cook's Distance"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-binary-logistic_files/figure-html/unnamed-chunk-16-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-binary-logistic_files/figure-html/unnamed-chunk-16-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.BLR.copy()</span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'defaulted'</span>] <span class="op">=</span> df[<span class="st">'defaulted'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit logistic regression</span></span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>, <span class="st">'income'</span>]])</span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> sm.Logit(y, X).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:227: PerfectSeparationWarning: Perfect separation or prediction detected, parameter may not be identified
  warnings.warn(msg, category=PerfectSeparationWarning)
Warning: Maximum number of iterations has been exceeded.
         Current function value: 0.000000
         Iterations: 35
/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/base/model.py:607: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn("Maximum Likelihood optimization failed to "</code></pre>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predictions and residuals</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'pred_prob'</span>] <span class="op">=</span> logit_model.predict(X)</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'pred_logit'</span>] <span class="op">=</span> logit_model.predict(X, linear<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:530: FutureWarning: linear keyword is deprecated, use which="linear"
  warnings.warn(msg, FutureWarning)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>resid_dev <span class="op">=</span> logit_model.resid_dev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:5283: RuntimeWarning: divide by zero encountered in log
  res = -(1-endog)*np.sqrt(2*M*np.abs(np.log(1-p))) + \
/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:5283: RuntimeWarning: invalid value encountered in multiply
  res = -(1-endog)*np.sqrt(2*M*np.abs(np.log(1-p))) + \</code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>resid_pearson <span class="op">=</span> logit_model.resid_pearson  <span class="co"># From model, not influence object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:5312: RuntimeWarning: invalid value encountered in divide
  return (endog - M*p)/np.sqrt(M*p*(1-p))</code></pre>
</div>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. DEVIANCE RESIDUALS PLOTS</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1: Deviance residuals vs predicted probability</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].scatter(df[<span class="st">'pred_prob'</span>], resid_dev, alpha<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'orange'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].axhline(y<span class="op">=-</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'orange'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Predicted Probability'</span>)</span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Deviance Residuals'</span>)</span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">'Deviance Residuals vs Predicted Probability'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb192-14"><a href="#cb192-14" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb192-15"><a href="#cb192-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-16"><a href="#cb192-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2: Deviance residuals vs linear predictor</span></span>
<span id="cb192-17"><a href="#cb192-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].scatter(df[<span class="st">'pred_logit'</span>], resid_dev, alpha<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb192-18"><a href="#cb192-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb192-19"><a href="#cb192-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].axhline(y<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'orange'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb192-20"><a href="#cb192-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].axhline(y<span class="op">=-</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'orange'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb192-21"><a href="#cb192-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Linear Predictor (log-odds)'</span>)</span>
<span id="cb192-22"><a href="#cb192-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">'Deviance Residuals'</span>)</span>
<span id="cb192-23"><a href="#cb192-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">'Deviance Residuals vs Linear Predictor'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb192-24"><a href="#cb192-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb192-25"><a href="#cb192-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-26"><a href="#cb192-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb192-27"><a href="#cb192-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. BINNED RESIDUAL PLOT</span></span>
<span id="cb192-28"><a href="#cb192-28" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb192-29"><a href="#cb192-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create bins for predicted probabilities</span></span>
<span id="cb192-30"><a href="#cb192-30" aria-hidden="true" tabindex="-1"></a>n_bins <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb192-31"><a href="#cb192-31" aria-hidden="true" tabindex="-1"></a>df_sorted <span class="op">=</span> df.sort_values(<span class="st">'pred_prob'</span>)</span>
<span id="cb192-32"><a href="#cb192-32" aria-hidden="true" tabindex="-1"></a>df_sorted[<span class="st">'bin'</span>] <span class="op">=</span> pd.cut(df_sorted[<span class="st">'pred_prob'</span>], bins<span class="op">=</span>n_bins, labels<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb192-33"><a href="#cb192-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-34"><a href="#cb192-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average residual per bin</span></span>
<span id="cb192-35"><a href="#cb192-35" aria-hidden="true" tabindex="-1"></a>binned_resids <span class="op">=</span> df_sorted.groupby(<span class="st">'bin'</span>).agg({</span>
<span id="cb192-36"><a href="#cb192-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pred_prob'</span>: <span class="st">'mean'</span>,</span>
<span id="cb192-37"><a href="#cb192-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'defaulted'</span>: <span class="kw">lambda</span> x: np.mean(x <span class="op">-</span> logit_model.predict(X.loc[x.index]))</span>
<span id="cb192-38"><a href="#cb192-38" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb192-39"><a href="#cb192-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-40"><a href="#cb192-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate standard error bounds</span></span>
<span id="cb192-41"><a href="#cb192-41" aria-hidden="true" tabindex="-1"></a>se <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> np.sqrt(binned_resids[<span class="st">'defaulted'</span>].var() <span class="op">/</span> <span class="bu">len</span>(binned_resids))</span>
<span id="cb192-42"><a href="#cb192-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-43"><a href="#cb192-43" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].scatter(binned_resids[<span class="st">'pred_prob'</span>], binned_resids[<span class="st">'defaulted'</span>], </span>
<span id="cb192-44"><a href="#cb192-44" aria-hidden="true" tabindex="-1"></a>                   color<span class="op">=</span><span class="st">'black'</span>, s<span class="op">=</span><span class="dv">50</span>, zorder<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb192-45"><a href="#cb192-45" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb192-46"><a href="#cb192-46" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].axhline(y<span class="op">=</span>se, color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb192-47"><a href="#cb192-47" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].axhline(y<span class="op">=-</span>se, color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb192-48"><a href="#cb192-48" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].fill_between([<span class="dv">0</span>, <span class="dv">1</span>], <span class="op">-</span>se, se, color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb192-49"><a href="#cb192-49" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_xlabel(<span class="st">'Predicted Probability (Binned)'</span>)</span>
<span id="cb192-50"><a href="#cb192-50" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_ylabel(<span class="st">'Average Residual'</span>)</span>
<span id="cb192-51"><a href="#cb192-51" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">'Binned Residual Plot'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb192-52"><a href="#cb192-52" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_xlim(<span class="dv">0</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0.0, 1.0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. COOK'S DISTANCE</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>influence <span class="op">=</span> logit_model.get_influence()</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>cooks_d <span class="op">=</span> influence.cooks_distance[<span class="dv">0</span>]</span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Cook's distance</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].stem(<span class="bu">range</span>(<span class="bu">len</span>(cooks_d)), cooks_d, </span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>                linefmt<span class="op">=</span><span class="st">'gray'</span>, markerfmt<span class="op">=</span><span class="st">'o'</span>, basefmt<span class="op">=</span><span class="st">' '</span>)</span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="dv">4</span> <span class="op">/</span> <span class="bu">len</span>(cooks_d)</span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].axhline(y<span class="op">=</span>threshold, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Highlight influential points</span></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a>influential <span class="op">=</span> np.where(cooks_d <span class="op">&gt;</span> threshold)[<span class="dv">0</span>]</span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(influential) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>, <span class="dv">1</span>].stem(influential, cooks_d[influential],</span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a>                    linefmt<span class="op">=</span><span class="st">'red'</span>, markerfmt<span class="op">=</span><span class="st">'ro'</span>, basefmt<span class="op">=</span><span class="st">' '</span>)</span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_xlabel(<span class="st">'Observation Index'</span>)</span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_ylabel(<span class="st">"Cook's Distance"</span>)</span>
<span id="cb194-23"><a href="#cb194-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">"Cook's Distance: Influential Points"</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb194-24"><a href="#cb194-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb194-25"><a href="#cb194-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-26"><a href="#cb194-26" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb194-27"><a href="#cb194-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-binary-logistic_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. INFLUENCE PLOT</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ===================================</span></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get influence measures</span></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>influence <span class="op">=</span> logit_model.get_influence()</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>cooks_d <span class="op">=</span> influence.cooks_distance[<span class="dv">0</span>]</span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>leverage <span class="op">=</span> influence.hat_matrix_diag</span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Use residuals from MODEL not influence object</span></span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a>resid_standardized <span class="op">=</span> resid_pearson  <span class="co"># Already defined from logit_model above</span></span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the influence plot manually</span></span>
<span id="cb195-13"><a href="#cb195-13" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb195-14"><a href="#cb195-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-15"><a href="#cb195-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Bubble plot: x=leverage, y=residuals, size=Cook's distance</span></span>
<span id="cb195-16"><a href="#cb195-16" aria-hidden="true" tabindex="-1"></a>bubble_size <span class="op">=</span> cooks_d <span class="op">*</span> <span class="dv">1000</span>  <span class="co"># Scale for visibility</span></span>
<span id="cb195-17"><a href="#cb195-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-18"><a href="#cb195-18" aria-hidden="true" tabindex="-1"></a>scatter <span class="op">=</span> ax.scatter(leverage, resid_standardized, </span>
<span id="cb195-19"><a href="#cb195-19" aria-hidden="true" tabindex="-1"></a>                     s<span class="op">=</span>bubble_size, alpha<span class="op">=</span><span class="fl">0.5</span>, c<span class="op">=</span>cooks_d, </span>
<span id="cb195-20"><a href="#cb195-20" aria-hidden="true" tabindex="-1"></a>                     cmap<span class="op">=</span><span class="st">'Reds'</span>, edgecolors<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb195-21"><a href="#cb195-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-22"><a href="#cb195-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Add colorbar to show Cook's distance</span></span>
<span id="cb195-23"><a href="#cb195-23" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(scatter, ax<span class="op">=</span>ax)</span>
<span id="cb195-24"><a href="#cb195-24" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">"Cook's Distance"</span>, rotation<span class="op">=</span><span class="dv">270</span>, labelpad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb195-25"><a href="#cb195-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-26"><a href="#cb195-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Add reference lines</span></span>
<span id="cb195-27"><a href="#cb195-27" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb195-28"><a href="#cb195-28" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb195-29"><a href="#cb195-29" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=-</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb195-30"><a href="#cb195-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-31"><a href="#cb195-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Label most influential points</span></span>
<span id="cb195-32"><a href="#cb195-32" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="dv">4</span> <span class="op">/</span> <span class="bu">len</span>(cooks_d)</span>
<span id="cb195-33"><a href="#cb195-33" aria-hidden="true" tabindex="-1"></a>influential_idx <span class="op">=</span> np.where(cooks_d <span class="op">&gt;</span> threshold)[<span class="dv">0</span>]</span>
<span id="cb195-34"><a href="#cb195-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-35"><a href="#cb195-35" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(influential_idx) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb195-36"><a href="#cb195-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx <span class="kw">in</span> influential_idx[:<span class="dv">5</span>]:  <span class="co"># Only label top 5</span></span>
<span id="cb195-37"><a href="#cb195-37" aria-hidden="true" tabindex="-1"></a>        ax.annotate(<span class="bu">str</span>(idx), </span>
<span id="cb195-38"><a href="#cb195-38" aria-hidden="true" tabindex="-1"></a>                   xy<span class="op">=</span>(leverage[idx], resid_standardized[idx]),</span>
<span id="cb195-39"><a href="#cb195-39" aria-hidden="true" tabindex="-1"></a>                   xytext<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>), textcoords<span class="op">=</span><span class="st">'offset points'</span>,</span>
<span id="cb195-40"><a href="#cb195-40" aria-hidden="true" tabindex="-1"></a>                   fontsize<span class="op">=</span><span class="dv">8</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb195-41"><a href="#cb195-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-42"><a href="#cb195-42" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Leverage'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb195-43"><a href="#cb195-43" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Standardized Residuals'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb195-44"><a href="#cb195-44" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Influence Plot: Bubble size indicates Cook's Distance"</span>, </span>
<span id="cb195-45"><a href="#cb195-45" aria-hidden="true" tabindex="-1"></a>             fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb195-46"><a href="#cb195-46" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb195-47"><a href="#cb195-47" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb195-48"><a href="#cb195-48" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="08-binary-logistic_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary of influential points</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(influential_idx) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Influential Observations"</span>)</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Number of influential points: </span><span class="sc">{</span><span class="bu">len</span>(influential_idx)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Indices: </span><span class="sc">{</span>influential_idx<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="interpreting-the-diagnostics-for-the-loan-default-model" class="level3" data-number="8.16.4"><h3 data-number="8.16.4" class="anchored" data-anchor-id="interpreting-the-diagnostics-for-the-loan-default-model">
<span class="header-section-number">8.16.4</span> Interpreting the Diagnostics for the Loan Default Model</h3>
<p>For our loan default dataset, the diagnostics suggest that the logistic model with <strong>credit score and income</strong> is reasonably well specified:</p>
<ul>
<li>The <strong>deviance residual plots</strong> show most points clustered between about −2 and +2, with no obvious pattern as a function of predicted probability or the linear predictor. This suggests that the model is not systematically over- or under-predicting in any particular region.</li>
<li>In the <strong>binned residual plot</strong>, most bins lie close to the horizontal line at 0 and within the uncertainty band. That indicates the model is <strong>well calibrated</strong>: where it predicts, say, a 20–30% default probability, the observed default rate is roughly in that range.</li>
<li>The <strong>Cook’s distance / influence plots</strong> highlight a small number of observations with slightly higher influence, but no single point dominates the fit. These cases are worth inspecting (e.g., unusually low credit score but high income), yet they do not invalidate the overall model.</li>
</ul>
<p>Overall, these diagnostics give us confidence that the logistic regression model is capturing the main structure in the data and that its predictions are <strong>trustworthy for most borrowers</strong>.</p>
</section>
</div>
</div>
</div>
<hr></section></section><section id="results" class="level2" data-number="8.17"><h2 data-number="8.17" class="anchored" data-anchor-id="results">
<span class="header-section-number">8.17</span> Results</h2>
<p>Once we’ve fit our logistic regression model, the next step is to <strong>present the results</strong>. Results can be organized into two complementary perspectives:</p>
<ol type="1">
<li>
<strong>Predictive Analysis</strong> — How well does our model classify customers into “default” vs.&nbsp;“non-default”?</li>
<li>
<strong>Inferential Analysis</strong> — What do the model’s coefficients tell us about the relationship between predictors (e.g., credit score, income) and the probability of default?</li>
</ol>
<section id="predictive-analysis" class="level3" data-number="8.17.1"><h3 data-number="8.17.1" class="anchored" data-anchor-id="predictive-analysis">
<span class="header-section-number">8.17.1</span> Predictive Analysis</h3>
<p>From a predictive standpoint, the model provides <strong>predicted probabilities</strong> for each customer. By applying a threshold (commonly 0.5), we can classify customers as predicted to default or not.</p>
<p>We then evaluate performance using:</p>
<ul>
<li>
<strong>Accuracy:</strong> The proportion of correct predictions.</li>
<li>
<strong>Sensitivity (Recall):</strong> How well the model detects actual defaults.</li>
<li>
<strong>Specificity:</strong> How well the model detects non-defaults.</li>
<li>
<strong>ROC Curve / AUC:</strong> Performance across all possible thresholds.</li>
</ul>
<p>For example, in our loan dataset, the model correctly classifies a high proportion of non-defaulters, but sensitivity may be lower if defaults are relatively rare.</p>
</section><section id="inferential-analysis" class="level3" data-number="8.17.2"><h3 data-number="8.17.2" class="anchored" data-anchor-id="inferential-analysis">
<span class="header-section-number">8.17.2</span> Inferential Analysis</h3>
<p>From an inferential perspective, the coefficients give us <strong>odds ratios</strong> that describe how predictors affect default risk.</p>
<p>For instance, a coefficient of <code>-0.01</code> for credit score corresponds to an <strong>odds ratio of 0.99</strong> — meaning that for every 1-point increase in credit score, the odds of defaulting decrease by about 1%. Scaled up, a <strong>50-point increase</strong> lowers the odds by roughly 40%.</p>
<p>By converting odds ratios into <strong>changes in probability</strong> at meaningful ranges of credit score, we provide a more intuitive interpretation for readers.</p>
<hr>
<p><strong>TODOs for this section:</strong></p>
<ul>
<li>Add classification table (confusion matrix) showing accuracy, sensitivity, specificity.</li>
<li>Include ROC curve for predictive storytelling.</li>
<li>Provide plain-language interpretation of at least one coefficient (credit score).</li>
</ul>
<hr>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-21-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit logistic regression model (this stays the same - base R)</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summary for inference (stays the same)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Odds ratios with confidence intervals (stays the same)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>OR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="co"># Predictive evaluation - TIDYMODELS</span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/yardstick">yardstick</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get predictions</span></span>
<span><span class="va">pred_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logit_model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">pred_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">pred_prob</span> <span class="op">&gt;</span> <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create results dataframe for yardstick</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  truth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">$</span><span class="va">defaulted</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  predicted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">pred_class</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  pred_prob <span class="op">=</span> <span class="va">pred_prob</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Confusion matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Confusion Matrix:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/conf_mat.html">conf_mat</a></span><span class="op">(</span><span class="va">results</span>, truth <span class="op">=</span> <span class="va">truth</span>, estimate <span class="op">=</span> <span class="va">predicted</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate classification metrics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nClassification Metrics:\n"</span><span class="op">)</span></span>
<span><span class="va">metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://yardstick.tidymodels.org/reference/metric_set.html">metric_set</a></span><span class="op">(</span><span class="va">accuracy</span>, <span class="va">sensitivity</span>, <span class="va">specificity</span>, <span class="va">precision</span>, <span class="va">f_meas</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/metrics.html">metrics</a></span><span class="op">(</span><span class="va">results</span>, truth <span class="op">=</span> <span class="va">truth</span>, estimate <span class="op">=</span> <span class="va">predicted</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ===================================</span></span>
<span><span class="co"># ROC curve - TWO OPTIONS</span></span>
<span><span class="co"># ===================================</span></span>
<span></span>
<span><span class="co"># Option 1: Using pROC (traditional, great plots)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://xrobin.github.io/pROC/">pROC</a></span><span class="op">)</span></span>
<span><span class="va">roc_curve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">$</span><span class="va">defaulted</span>, <span class="va">pred_prob</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">roc_curve</span>, main<span class="op">=</span><span class="st">"ROC Curve for Loan Default Model"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"AUC:"</span>, <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html">auc</a></span><span class="op">(</span><span class="va">roc_curve</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 2: Using yardstick (tidymodels way)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/yardstick">yardstick</a></span><span class="op">)</span></span>
<span><span class="va">roc_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_curve.html">roc_curve</a></span><span class="op">(</span><span class="va">results</span>, truth <span class="op">=</span> <span class="va">truth</span>, <span class="va">pred_prob</span>, event_level <span class="op">=</span> <span class="st">"second"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">roc_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"ROC Curve for Loan Default Model"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># AUC using yardstick</span></span>
<span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_auc.html">roc_auc</a></span><span class="op">(</span><span class="va">results</span>, truth <span class="op">=</span> <span class="va">truth</span>, <span class="va">pred_prob</span>, event_level <span class="op">=</span> <span class="st">"second"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-21-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">
<div class="sourceCode" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, classification_report, roc_curve, auc</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic regression</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.data[<span class="st">'BLR'</span>].copy()</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'defaulted'</span>] <span class="op">=</span> df[<span class="st">'defaulted'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>,<span class="st">'income'</span>]])</span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> sm.Logit(y, X).fit()</span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Inference: odds ratios</span></span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> logit_model.params</span>
<span id="cb198-16"><a href="#cb198-16" aria-hidden="true" tabindex="-1"></a>conf <span class="op">=</span> logit_model.conf_int()</span>
<span id="cb198-17"><a href="#cb198-17" aria-hidden="true" tabindex="-1"></a>odds_ratios <span class="op">=</span> pd.DataFrame({</span>
<span id="cb198-18"><a href="#cb198-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OR"</span>: params.<span class="bu">apply</span>(<span class="kw">lambda</span> x: np.exp(x)),</span>
<span id="cb198-19"><a href="#cb198-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2.5%"</span>: conf[<span class="dv">0</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: np.exp(x)),</span>
<span id="cb198-20"><a href="#cb198-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"97.5%"</span>: conf[<span class="dv">1</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: np.exp(x))</span>
<span id="cb198-21"><a href="#cb198-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb198-22"><a href="#cb198-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(odds_ratios)</span>
<span id="cb198-23"><a href="#cb198-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-24"><a href="#cb198-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb198-25"><a href="#cb198-25" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'pred_prob'</span>] <span class="op">=</span> logit_model.predict(X)</span>
<span id="cb198-26"><a href="#cb198-26" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'pred_class'</span>] <span class="op">=</span> (df[<span class="st">'pred_prob'</span>] <span class="op">&gt;</span> <span class="fl">0.5</span>).astype(<span class="bu">int</span>)</span>
<span id="cb198-27"><a href="#cb198-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-28"><a href="#cb198-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix &amp; report</span></span>
<span id="cb198-29"><a href="#cb198-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(confusion_matrix(y, df[<span class="st">'pred_class'</span>]))</span>
<span id="cb198-30"><a href="#cb198-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y, df[<span class="st">'pred_class'</span>]))</span>
<span id="cb198-31"><a href="#cb198-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-32"><a href="#cb198-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC Curve</span></span>
<span id="cb198-33"><a href="#cb198-33" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(y, df[<span class="st">'pred_prob'</span>])</span>
<span id="cb198-34"><a href="#cb198-34" aria-hidden="true" tabindex="-1"></a>roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb198-35"><a href="#cb198-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-36"><a href="#cb198-36" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb198-37"><a href="#cb198-37" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr, tpr, color<span class="op">=</span><span class="st">'blue'</span>, label<span class="op">=</span><span class="ss">f'ROC curve (AUC = </span><span class="sc">{</span>roc_auc<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="cb198-38"><a href="#cb198-38" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">1</span>], color<span class="op">=</span><span class="st">'grey'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb198-39"><a href="#cb198-39" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"ROC Curve for Loan Default Model"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb198-40"><a href="#cb198-40" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"False Positive Rate"</span>)</span>
<span id="cb198-41"><a href="#cb198-41" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"True Positive Rate"</span>)</span>
<span id="cb198-42"><a href="#cb198-42" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb198-43"><a href="#cb198-43" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr></section><section id="model-summary-coefficients-and-odds-ratios" class="level3" data-number="8.17.3"><h3 data-number="8.17.3" class="anchored" data-anchor-id="model-summary-coefficients-and-odds-ratios">
<span class="header-section-number">8.17.3</span> Model Summary: Coefficients and Odds Ratios</h3>
<p>Below is a comprehensive summary of our final model including log-odds coefficients, odds ratios, and 95% confidence intervals:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-2" role="tab" aria-controls="tabset-22-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-22-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<div class="cell">
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#| label: tbl-model-summary</span></span>
<span><span class="co">#| tbl-cap: "Logistic Regression Model Summary with Odds Ratios"</span></span>
<span><span class="co">#| echo: false</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create comprehensive summary table (using Wald CIs for stability)</span></span>
<span><span class="va">coef_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span></span>
<span><span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint.default</a></span><span class="op">(</span><span class="va">logit_model</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="va">coef_summary</span><span class="op">$</span><span class="va">conf.low</span> <span class="op">&lt;-</span> <span class="va">ci</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">coef_summary</span><span class="op">$</span><span class="va">conf.high</span> <span class="op">&lt;-</span> <span class="va">ci</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">coef_summary</span> <span class="op">&lt;-</span> <span class="va">coef_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    odds_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,</span>
<span>    or_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">conf.low</span><span class="op">)</span>,</span>
<span>    or_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">conf.high</span><span class="op">)</span>,</span>
<span>    <span class="co"># Add significance stars</span></span>
<span>    significance <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">0.001</span> <span class="op">~</span> <span class="st">"***"</span>,</span>
<span>      <span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">0.01</span> <span class="op">~</span> <span class="st">"**"</span>,</span>
<span>      <span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">~</span> <span class="st">"*"</span>,</span>
<span>      <span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">0.10</span> <span class="op">~</span> <span class="st">"."</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">""</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">estimate</span>, <span class="va">std.error</span>, <span class="va">statistic</span>, <span class="va">p.value</span>, </span>
<span>                <span class="va">odds_ratio</span>, <span class="va">or_lower</span>, <span class="va">or_upper</span>, <span class="va">significance</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display table</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">coef_summary</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Predictor"</span>, <span class="st">"Log-Odds (β)"</span>, <span class="st">"SE"</span>, <span class="st">"z-value"</span>, <span class="st">"p-value"</span>,</span>
<span>                <span class="st">"Odds Ratio"</span>, <span class="st">"OR Lower 95%"</span>, <span class="st">"OR Upper 95%"</span>, <span class="st">"Sig."</span><span class="op">)</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Logistic Regression Coefficients and Odds Ratios"</span>,</span>
<span>  align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"r"</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Logistic Regression Coefficients and Odds Ratios</caption>
<colgroup>
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 5%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Predictor</th>
<th style="text-align: right;">Log-Odds (β)</th>
<th style="text-align: right;">SE</th>
<th style="text-align: right;">z-value</th>
<th style="text-align: right;">p-value</th>
<th style="text-align: right;">Odds Ratio</th>
<th style="text-align: right;">OR Lower 95%</th>
<th style="text-align: right;">OR Upper 95%</th>
<th style="text-align: right;">Sig.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">141.1585</td>
<td style="text-align: right;">96852.6212</td>
<td style="text-align: right;">0.0015</td>
<td style="text-align: right;">0.9988</td>
<td style="text-align: right;">2.015328e+61</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">Inf</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">credit_score</td>
<td style="text-align: right;">-0.2597</td>
<td style="text-align: right;">302.9029</td>
<td style="text-align: right;">-0.0009</td>
<td style="text-align: right;">0.9993</td>
<td style="text-align: right;">7.713000e-01</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">5.231844e+257</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">income</td>
<td style="text-align: right;">0.0002</td>
<td style="text-align: right;">1.2197</td>
<td style="text-align: right;">0.0002</td>
<td style="text-align: right;">0.9999</td>
<td style="text-align: right;">1.000200e+00</td>
<td style="text-align: right;">0.0916</td>
<td style="text-align: right;">1.092290e+01</td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="tabset-22-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-2-tab">
<div id="tbl-model-summary-py" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-model-summary-py-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.1: Logistic Regression Model Summary with Odds Ratios (Python)
</figcaption><div aria-describedby="tbl-model-summary-py-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:227: PerfectSeparationWarning: Perfect separation or prediction detected, parameter may not be identified
  warnings.warn(msg, category=PerfectSeparationWarning)
/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/base/model.py:607: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn("Maximum Likelihood optimization failed to "</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:10: RuntimeWarning: overflow encountered in exp</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Predictor  Log-Odds (β)           SE   z-value  p-value   Odds Ratio  OR Lower 95%  OR Upper 95% Sig.
       const    130.129344 63516.021226  0.002049 0.998365 3.269310e+56  0.000000e+00           inf     
credit_score     -0.210011   255.231228 -0.000823 0.999343 8.105751e-01 4.524576e-218 1.452140e+217     
      income     -0.000069     2.122827 -0.000032 0.999974 9.999310e-01  1.559610e-02  6.410973e+01     </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Significance codes: *** p&lt;0.001, ** p&lt;0.01, * p&lt;0.05, . p&lt;0.10</code></pre>
</div>
</div>
</figure>
</div>
</div>
</div>
</div>
<p><strong>Key Findings:</strong></p>
<ul>
<li><p><strong>Credit Score</strong>: Each 1-point increase reduces the odds of default by approximately 1% (OR ≈ 0.99). A 50-point increase (a common improvement after financial counseling) reduces odds by roughly 40%.</p></li>
<li><p><strong>Income</strong>: The effect of income is marginal and not statistically significant (p &gt; 0.05), suggesting that once credit score is known, additional income information doesn’t substantially improve default prediction.</p></li>
</ul>
<hr></section><section id="classification-performance" class="level3" data-number="8.17.4"><h3 data-number="8.17.4" class="anchored" data-anchor-id="classification-performance">
<span class="header-section-number">8.17.4</span> Classification Performance</h3>
<p>To evaluate predictive performance, we examine how well the model classifies borrowers using a 0.5 probability threshold:</p>
</section></section><section id="r-output-4" class="level2" data-number="8.18"><h2 data-number="8.18" class="anchored" data-anchor-id="r-output-4">
<span class="header-section-number">8.18</span> R Output</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction   0   1
         0 613   0
         1   0 387</code></pre>
</div>
<div id="tbl-confusion-matrix" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-confusion-matrix-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.2: Confusion Matrix and Classification Metrics
</figcaption><div aria-describedby="tbl-confusion-matrix-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Classification Performance Metrics (Threshold = 0.5)</caption>
<thead><tr class="header">
<th style="text-align: left;">Performance Metric</th>
<th style="text-align: right;">Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sensitivity (Recall)</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Precision (PPV)</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">F1 Score</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Balanced Accuracy</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section><section id="python-output-4" class="level2" data-number="8.19"><h2 data-number="8.19" class="anchored" data-anchor-id="python-output-4">
<span class="header-section-number">8.19</span> Python Output</h2>
<div id="tbl-confusion-matrix-py" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-confusion-matrix-py-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.3: Confusion Matrix and Classification Metrics (Python)
</figcaption><div aria-describedby="tbl-confusion-matrix-py-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Pred: No Default  Pred: Default
Actual: No Default               613              0
Actual: Default                    0            387</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>              Metric  Value
            Accuracy    1.0
Sensitivity (Recall)    1.0
         Specificity    1.0
     Precision (PPV)    1.0
            F1 Score    1.0</code></pre>
</div>
</div>
</figure>
</div>
<p>:::</p>
<p><strong>Interpretation:</strong> The model achieves high overall accuracy (typically &gt;85%), but pay close attention to <strong>sensitivity</strong> (recall). If sensitivity is low (e.g., &lt;60%), this means the model fails to identify many actual defaulters. For lenders, this matters because false negatives (predicting no default when default occurs) are costly. The threshold of 0.5 can be adjusted based on the cost-benefit ratio of false positives vs.&nbsp;false negatives.</p>
<hr>
<section id="roc-curve-and-auc" class="level3" data-number="8.19.1"><h3 data-number="8.19.1" class="anchored" data-anchor-id="roc-curve-and-auc">
<span class="header-section-number">8.19.1</span> ROC Curve and AUC</h3>
<p>The Receiver Operating Characteristic (ROC) curve visualizes the trade-off between true positive rate (sensitivity) and false positive rate (1 - specificity) across all possible thresholds:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-23-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<div class="cell">
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://xrobin.github.io/pROC/">pROC</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Type 'citation("pROC")' for a citation.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'pROC'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    cov, smooth, var</code></pre>
</div>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate ROC</span></span>
<span><span class="va">roc_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">$</span><span class="va">defaulted</span>, <span class="va">pred_prob</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">auc_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html">auc</a></span><span class="op">(</span><span class="va">roc_obj</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot ROC curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">roc_obj</span>, </span>
<span>     col <span class="op">=</span> <span class="st">"#2C3E50"</span>, </span>
<span>     lwd <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"ROC Curve: Loan Default Prediction"</span>,</span>
<span>     print.auc <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     print.auc.x <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>     print.auc.y <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>     print.auc.cex <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>     legacy.axes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     grid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add diagonal reference line</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, </span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Logistic Model (AUC = %.3f)"</span>, <span class="va">auc_value</span><span class="op">)</span>,</span>
<span>         <span class="st">"Random Classifier (AUC = 0.5)"</span></span>
<span>       <span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#2C3E50"</span>, <span class="st">"gray50"</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>       lwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>       cex <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-roc-curve" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-roc-curve-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-binary-logistic_files/figure-html/fig-roc-curve-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-roc-curve-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.6: ROC Curve for Loan Default Model
</figcaption></figure>
</div>
</div>
</div>
</div>
<div id="tabset-23-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, auc</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ROC</span></span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(y, pred_prob)</span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-8"><a href="#cb220-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot</span></span>
<span id="cb220-9"><a href="#cb220-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">6</span>))</span>
<span id="cb220-10"><a href="#cb220-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-11"><a href="#cb220-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC curve</span></span>
<span id="cb220-12"><a href="#cb220-12" aria-hidden="true" tabindex="-1"></a>ax.plot(fpr, tpr, color<span class="op">=</span><span class="st">'#2C3E50'</span>, linewidth<span class="op">=</span><span class="fl">2.5</span>, </span>
<span id="cb220-13"><a href="#cb220-13" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="ss">f'Logistic Model (AUC = </span><span class="sc">{</span>roc_auc<span class="sc">:.3f}</span><span class="ss">)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[&lt;matplotlib.lines.Line2D object at 0x3411da850&gt;]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagonal reference line</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>ax.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'gray'</span>, </span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">'Random Classifier (AUC = 0.5)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:3: UserWarning: color is redundantly defined by the 'color' keyword argument and the fmt string "k--" (-&gt; color='k'). The keyword argument will take precedence.
[&lt;matplotlib.lines.Line2D object at 0x3411daad0&gt;]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Styling</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'False Positive Rate (1 - Specificity)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0, 'False Positive Rate (1 - Specificity)')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'True Positive Rate (Sensitivity)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Text(0, 0.5, 'True Positive Rate (Sensitivity)')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'ROC Curve: Loan Default Prediction'</span>, </span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, 'ROC Curve: Loan Default Prediction')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">'lower right'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;matplotlib.legend.Legend object at 0x3411dac10&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>ax.set_xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0.0, 1.0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>ax.set_ylim([<span class="dv">0</span>, <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0.0, 1.0)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-roc-curve-py" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-roc-curve-py-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-binary-logistic_files/figure-html/fig-roc-curve-py-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-roc-curve-py-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.7: ROC Curve for Loan Default Model (Python)
</figcaption></figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p><strong>Interpretation:</strong> An AUC (Area Under the Curve) of 0.75-0.85 indicates good discriminative ability. The model does substantially better than random guessing (AUC = 0.5). However, perfect discrimination (AUC = 1.0) is rare in real-world applications. The ROC curve shows that we can trade sensitivity for specificity by adjusting the classification threshold.</p>
<hr></section></section><section id="storytelling" class="level2" data-number="8.20"><h2 data-number="8.20" class="anchored" data-anchor-id="storytelling">
<span class="header-section-number">8.20</span> Storytelling</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Effective storytelling connects statistical results to real-world meaning. Translate log-odds into “lenders are X times more likely to…” language.</p>
</div>
</div>
<p>The final step of our analysis is not just running the model, but <strong>communicating the findings</strong> clearly. Logistic regression results are often presented to stakeholders like lenders, policy makers, or managers, who may not be trained in statistics. For them, <strong>the story matters more than the math.</strong></p>
<p>Let’s revisit our loan default dataset. Suppose our logistic regression showed that <strong>credit score</strong> is strongly predictive of default:</p>
<ul>
<li>A 50-point increase in credit score reduces the odds of defaulting by about 40%.</li>
<li>In probability terms, this means that increasing credit score from 400 to 450 lowers the chance of default from roughly 70% to about 50%.</li>
</ul>
<p>Notice how we moved from the technical language of <strong>odds ratios</strong> to a <strong>plain-language probability story</strong>. This makes the model’s results accessible to a wider audience.</p>
<p>Visuals amplify the story:</p>
<ul>
<li>A plot of predicted probabilities vs.&nbsp;credit score shows the <strong>smooth S-shaped curve</strong> replacing the jagged OLS line.</li>
<li>A confusion matrix or ROC curve shows how well our model actually classifies defaulters.</li>
<li>Calibration plots show whether predicted probabilities line up with observed rates of default.</li>
</ul>
<p>Finally, good storytelling means acknowledging limitations. For example, our dataset may suffer from <strong>class imbalance</strong> (fewer defaults than non-defaults), which could bias results. We should be clear about what the model can and cannot do.</p>
<p><strong>TODOs for this section:</strong></p>
<ul>
<li>Show a ROC curve for the loan default model.</li>
<li>Add plain-language interpretations of coefficients (esp.&nbsp;odds ratio for <code>credit_score</code>).</li>
<li>Add a note about limitations (e.g., income and education may be correlated with credit score).</li>
</ul>
<hr>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-24-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-1" role="tab" aria-controls="tabset-24-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-2" role="tab" aria-controls="tabset-24-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-24-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-24-1-tab">
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Logistic regression on loan default data</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predicted probabilities</span></span>
<span><span class="va">BLR</span><span class="op">$</span><span class="va">pred_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logit_model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Storytelling visualization</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">BLR</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">credit_score</span>, y <span class="op">=</span> <span class="va">pred_prob</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">defaulted</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Predicted Probability of Default vs. Credit Score"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Credit Score"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Predicted Probability"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Actual Default"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-24-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-24-2-tab">
<div class="sourceCode" id="cb238"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract loan default data</span></span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.data[<span class="st">'BLR'</span>].copy()</span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'defaulted'</span>] <span class="op">=</span> df[<span class="st">'defaulted'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit logistic regression</span></span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>,<span class="st">'income'</span>]])</span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> sm.Logit(y, X).fit()</span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'pred_prob'</span>] <span class="op">=</span> logit_model.predict(X)</span>
<span id="cb238-14"><a href="#cb238-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-15"><a href="#cb238-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Storytelling visualization</span></span>
<span id="cb238-16"><a href="#cb238-16" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb238-17"><a href="#cb238-17" aria-hidden="true" tabindex="-1"></a>scatter <span class="op">=</span> ax.scatter(df[<span class="st">'credit_score'</span>], df[<span class="st">'pred_prob'</span>],</span>
<span id="cb238-18"><a href="#cb238-18" aria-hidden="true" tabindex="-1"></a>                     c<span class="op">=</span>df[<span class="st">'defaulted'</span>], cmap<span class="op">=</span><span class="st">'coolwarm'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb238-19"><a href="#cb238-19" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Predicted Probability of Default vs. Credit Score"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb238-20"><a href="#cb238-20" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Credit Score"</span>)</span>
<span id="cb238-21"><a href="#cb238-21" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Predicted Probability"</span>)</span>
<span id="cb238-22"><a href="#cb238-22" aria-hidden="true" tabindex="-1"></a>legend1 <span class="op">=</span> ax.legend(<span class="op">*</span>scatter.legend_elements(), title<span class="op">=</span><span class="st">"Actual Default"</span>)</span>
<span id="cb238-23"><a href="#cb238-23" aria-hidden="true" tabindex="-1"></a>ax.add_artist(legend1)</span>
<span id="cb238-24"><a href="#cb238-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<section id="bringing-the-model-to-life" class="level3" data-number="8.20.1"><h3 data-number="8.20.1" class="anchored" data-anchor-id="bringing-the-model-to-life">
<span class="header-section-number">8.20.1</span> Bringing the Model to Life</h3>
<p>Statistical models become most powerful when we can tell clear stories with them. Let’s visualize our findings in ways that stakeholders can understand.</p>
<section id="the-default-risk-landscape" class="level4"><h4 class="anchored" data-anchor-id="the-default-risk-landscape">The Default Risk Landscape</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-25-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-1" role="tab" aria-controls="tabset-25-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-2" role="tab" aria-controls="tabset-25-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-25-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-25-1-tab">
<div class="cell">
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: viridisLite</code></pre>
</div>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit model</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">defaulted</span> <span class="op">~</span> <span class="va">credit_score</span> <span class="op">+</span> <span class="va">income</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">BLR</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Add predictions</span></span>
<span><span class="va">BLR</span><span class="op">$</span><span class="va">pred_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logit_model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">BLR</span><span class="op">$</span><span class="va">risk_category</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">BLR</span><span class="op">$</span><span class="va">pred_prob</span>, </span>
<span>                          breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Low Risk"</span>, <span class="st">"Medium Risk"</span>, </span>
<span>                                     <span class="st">"High Risk"</span>, <span class="st">"Very High Risk"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create comprehensive visualization</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">BLR</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">credit_score</span>, y <span class="op">=</span> <span class="va">income</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Contour showing predicted probability</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density_2d.html">geom_density_2d_filled</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Actual outcomes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">defaulted</span><span class="op">)</span>, </span>
<span>                 shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">defaulted</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="st">"#2ECC71"</span>, <span class="st">"1"</span> <span class="op">=</span> <span class="st">"#E74C3C"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"No Default"</span>, <span class="st">"Default"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Actual Outcome"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="fl">16</span>, <span class="st">"1"</span> <span class="op">=</span> <span class="fl">17</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"No Default"</span>, <span class="st">"Default"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Actual Outcome"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, name <span class="op">=</span> <span class="st">"Risk Zone"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"The Default Risk Landscape"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"How credit score and income jointly predict default probability"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Credit Score"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Annual Income ($1000s)"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Circles = No Default, Triangles = Default. Shaded regions show predicted risk zones."</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"right"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-storytelling-default-risk" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-storytelling-default-risk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-binary-logistic_files/figure-html/fig-storytelling-default-risk-3.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-storytelling-default-risk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.8: Default Risk Across Credit Score and Income
</figcaption></figure>
</div>
</div>
</div>
</div>
<div id="tabset-25-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-25-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.interpolate <span class="im">import</span> griddata</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> r.BLR.copy()</span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'defaulted'</span>] <span class="op">=</span> df[<span class="st">'defaulted'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(df[[<span class="st">'credit_score'</span>, <span class="st">'income'</span>]])</span>
<span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'defaulted'</span>]</span>
<span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> sm.Logit(y, X).fit(disp<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/discrete/discrete_model.py:227: PerfectSeparationWarning: Perfect separation or prediction detected, parameter may not be identified
  warnings.warn(msg, category=PerfectSeparationWarning)
/Users/andytai/miniforge3/envs/regression-cookbook-py/lib/python3.13/site-packages/statsmodels/base/model.py:607: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn("Maximum Likelihood optimization failed to "</code></pre>
</div>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predictions</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'pred_prob'</span>] <span class="op">=</span> logit_model.predict(X)</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create grid for contour</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>credit_range <span class="op">=</span> np.linspace(df[<span class="st">'credit_score'</span>].<span class="bu">min</span>(), df[<span class="st">'credit_score'</span>].<span class="bu">max</span>(), <span class="dv">100</span>)</span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>income_range <span class="op">=</span> np.linspace(df[<span class="st">'income'</span>].<span class="bu">min</span>(), df[<span class="st">'income'</span>].<span class="bu">max</span>(), <span class="dv">100</span>)</span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a>credit_grid, income_grid <span class="op">=</span> np.meshgrid(credit_range, income_range)</span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on grid</span></span>
<span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a>grid_points <span class="op">=</span> np.c_[np.ones(credit_grid.ravel().shape), </span>
<span id="cb247-11"><a href="#cb247-11" aria-hidden="true" tabindex="-1"></a>                     credit_grid.ravel(), </span>
<span id="cb247-12"><a href="#cb247-12" aria-hidden="true" tabindex="-1"></a>                     income_grid.ravel()]</span>
<span id="cb247-13"><a href="#cb247-13" aria-hidden="true" tabindex="-1"></a>prob_grid <span class="op">=</span> logit_model.predict(grid_points).reshape(credit_grid.shape)</span>
<span id="cb247-14"><a href="#cb247-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-15"><a href="#cb247-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot</span></span>
<span id="cb247-16"><a href="#cb247-16" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb247-17"><a href="#cb247-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-18"><a href="#cb247-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Contour plot</span></span>
<span id="cb247-19"><a href="#cb247-19" aria-hidden="true" tabindex="-1"></a>contour <span class="op">=</span> ax.contourf(credit_grid, income_grid<span class="op">/</span><span class="dv">1000</span>, prob_grid, </span>
<span id="cb247-20"><a href="#cb247-20" aria-hidden="true" tabindex="-1"></a>                      levels<span class="op">=</span><span class="dv">15</span>, cmap<span class="op">=</span><span class="st">'RdYlGn_r'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb247-21"><a href="#cb247-21" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(contour, ax<span class="op">=</span>ax, label<span class="op">=</span><span class="st">'Predicted Default Probability'</span>)</span>
<span id="cb247-22"><a href="#cb247-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-23"><a href="#cb247-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter actual outcomes</span></span>
<span id="cb247-24"><a href="#cb247-24" aria-hidden="true" tabindex="-1"></a>no_default <span class="op">=</span> df[df[<span class="st">'defaulted'</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb247-25"><a href="#cb247-25" aria-hidden="true" tabindex="-1"></a>defaulted <span class="op">=</span> df[df[<span class="st">'defaulted'</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb247-26"><a href="#cb247-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-27"><a href="#cb247-27" aria-hidden="true" tabindex="-1"></a>ax.scatter(no_default[<span class="st">'credit_score'</span>], no_default[<span class="st">'income'</span>]<span class="op">/</span><span class="dv">1000</span>, </span>
<span id="cb247-28"><a href="#cb247-28" aria-hidden="true" tabindex="-1"></a>           c<span class="op">=</span><span class="st">'#2ECC71'</span>, marker<span class="op">=</span><span class="st">'o'</span>, s<span class="op">=</span><span class="dv">30</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, </span>
<span id="cb247-29"><a href="#cb247-29" aria-hidden="true" tabindex="-1"></a>           edgecolors<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'No Default'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;matplotlib.collections.PathCollection object at 0x343463ed0&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>ax.scatter(defaulted[<span class="st">'credit_score'</span>], defaulted[<span class="st">'income'</span>]<span class="op">/</span><span class="dv">1000</span>, </span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>           c<span class="op">=</span><span class="st">'#E74C3C'</span>, marker<span class="op">=</span><span class="st">'^'</span>, s<span class="op">=</span><span class="dv">40</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, </span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>           edgecolors<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'Default'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;matplotlib.collections.PathCollection object at 0x34377c050&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Labels and styling</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Credit Score'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0, 'Credit Score')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Annual Income ($1000s)'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Text(0, 0.5, 'Annual Income ($1000s)')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'The Default Risk Landscape'</span>, </span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">15</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, 'The Default Risk Landscape')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="fl">0.5</span>, <span class="fl">1.02</span>, <span class="st">'How credit score and income jointly predict default probability'</span>,</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>ax.transAxes, ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.02, 'How credit score and income jointly predict default probability')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">10</span>, framealpha<span class="op">=</span><span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;matplotlib.legend.Legend object at 0x34377c2d0&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-storytelling-default-risk-py" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-storytelling-default-risk-py-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="08-binary-logistic_files/figure-html/fig-storytelling-default-risk-py-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-storytelling-default-risk-py-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.9: Default Risk Across Credit Score and Income (Python)
</figcaption></figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p><strong>The Story:</strong> The visualization reveals the “safe zone” (green region, upper-right) where high credit scores and incomes make default unlikely, and the “danger zone” (red region, lower-left) where both factors signal high risk. Notice how credit score creates sharper boundaries than income, consistent with our earlier finding that credit score is the stronger predictor.</p>
<hr></section><section id="model-limitations-and-caveats" class="level4"><h4 class="anchored" data-anchor-id="model-limitations-and-caveats">Model Limitations and Caveats</h4>
<p>While our model performs well, we should acknowledge several limitations:</p>
<ol type="1">
<li><p><strong>Correlation vs.&nbsp;Causation</strong>: The model shows credit score is associated with lower default risk, but doesn’t prove that improving someone’s credit score <em>causes</em> them to be more reliable borrowers. Credit scores may simply reflect other unmeasured factors like financial discipline.</p></li>
<li><p><strong>Class Imbalance</strong>: If defaults are rare in our dataset (e.g., &lt;10%), the model may be optimized for predicting non-defaults while missing many actual defaults. Consider stratified sampling or cost-sensitive learning approaches.</p></li>
<li><p><strong>Multicollinearity</strong>: Credit score, income, and education are likely correlated. Our finding that income is “not significant” may reflect this correlation rather than true irrelevance.</p></li>
<li><p><strong>Missing Variables</strong>: Important predictors like employment stability, existing debt, or past payment history are not included. The model’s predictive power is limited by available data.</p></li>
<li><p><strong>Temporal Validity</strong>: Credit risk patterns change over time (recessions, policy changes). A model trained on 2019 data may not perform well in 2024.</p></li>
</ol>
<p>Despite these limitations, the model provides valuable insights into default risk factors and generates interpretable predictions that can inform lending decisions when combined with human judgment and domain expertise.</p>
<hr></section></section></section><section id="when-to-use-binary-logistic-regression" class="level2" data-number="8.21"><h2 data-number="8.21" class="anchored" data-anchor-id="when-to-use-binary-logistic-regression">
<span class="header-section-number">8.21</span> When to Use Binary Logistic Regression</h2>
<p>Binary logistic regression is the appropriate tool when you have a <strong>binary outcome</strong> (two mutually exclusive categories) and want to model the probability of one outcome occurring as a function of predictor variables.</p>
<section id="ideal-use-cases" class="level3" data-number="8.21.1"><h3 data-number="8.21.1" class="anchored" data-anchor-id="ideal-use-cases">
<span class="header-section-number">8.21.1</span> Ideal Use Cases</h3>
<p>Binary logistic regression is well-suited for problems where:</p>
<ol type="1">
<li><p><strong>The outcome is truly binary</strong>: Success/failure, yes/no, default/no default, pass/fail, click/no click. The outcome must have exactly two levels.</p></li>
<li><p><strong>You have ungrouped data</strong>: Each row represents a single observation (one person, one transaction, one trial). If you have grouped data (e.g., “15 successes out of 20 trials”), use Binomial Logistic Regression (Chapter 9) instead.</p></li>
<li><p><strong>You want interpretable probabilities</strong>: Unlike some machine learning classifiers that only produce class predictions, logistic regression outputs calibrated probabilities that can inform decision-making under uncertainty.</p></li>
<li><p><strong>You need inferential insight</strong>: When the goal is to understand <strong>which predictors matter</strong> and <strong>how strongly they affect the outcome</strong>, logistic regression provides coefficients, odds ratios, and hypothesis tests.</p></li>
<li><p><strong>You have sufficient sample size</strong>: A rough guideline is at least 10-15 events (occurrences of the rarer outcome) per predictor variable. With fewer events, estimates become unstable.</p></li>
</ol></section><section id="when-not-to-use-binary-logistic-regression" class="level3" data-number="8.21.2"><h3 data-number="8.21.2" class="anchored" data-anchor-id="when-not-to-use-binary-logistic-regression">
<span class="header-section-number">8.21.2</span> When NOT to Use Binary Logistic Regression</h3>
<p>Binary logistic regression is <strong>not appropriate</strong> when:</p>
<ul>
<li><p><strong>Your outcome has more than two categories</strong>: For unordered categories (e.g., choice of transportation: car, bus, train), use Multinomial Logistic Regression (Chapter 14). For ordered categories (e.g., satisfaction: low, medium, high), use Ordinal Logistic Regression (Chapter 15).</p></li>
<li><p><strong>Your outcome is a count</strong>: If you’re modeling the number of events (e.g., number of accidents, number of purchases), use Poisson Regression (Chapter 10) or Negative Binomial Regression (Chapter 11).</p></li>
<li><p><strong>Your outcome is continuous</strong>: Use OLS Regression (Chapter 3), Gamma Regression (Chapter 4), or Beta Regression (Chapter 5) depending on the range and distribution of your outcome.</p></li>
<li><p><strong>You have grouped/aggregated data</strong>: If your data structure is “X successes out of N trials” for each row, use Binomial Logistic Regression (Chapter 9).</p></li>
<li><p><strong>Complete separation exists</strong>: When a predictor perfectly predicts the outcome (all 1s above a threshold, all 0s below), maximum likelihood estimation fails. Solutions include Firth’s penalized likelihood or exact logistic regression.</p></li>
</ul></section><section id="assumptions-to-check" class="level3" data-number="8.21.3"><h3 data-number="8.21.3" class="anchored" data-anchor-id="assumptions-to-check">
<span class="header-section-number">8.21.3</span> Assumptions to Check</h3>
<p>Before fitting a binary logistic regression, verify:</p>
<ol type="1">
<li><p><strong>Independence of observations</strong>: Each observation should be independent. Repeated measures or clustered data require mixed-effects models.</p></li>
<li><p><strong>Linear relationship with log-odds</strong>: Continuous predictors should have a linear relationship with the log-odds of the outcome. Check this with lowess curves or categorize continuous predictors and examine trends.</p></li>
<li><p><strong>No perfect multicollinearity</strong>: Predictors should not be perfectly correlated with each other. High multicollinearity (VIF &gt; 10) can inflate standard errors.</p></li>
<li><p><strong>Sufficient sample size</strong>: Particularly important for rare events. With very few occurrences of the outcome, consider Firth’s correction or exact methods.</p></li>
<li><p><strong>No extreme influential points</strong>: Check Cook’s distance and leverage plots (as shown in Model Diagnostics) to ensure no single observation drives the results.</p></li>
</ol>
<hr></section></section><section id="limitations-and-extensions" class="level2" data-number="8.22"><h2 data-number="8.22" class="anchored" data-anchor-id="limitations-and-extensions">
<span class="header-section-number">8.22</span> Limitations and Extensions</h2>
<p>While binary logistic regression is a powerful and interpretable method, it has important limitations. Understanding these helps you know when to look for alternative approaches or extensions.</p>
<section id="limitations" class="level3" data-number="8.22.1"><h3 data-number="8.22.1" class="anchored" data-anchor-id="limitations">
<span class="header-section-number">8.22.1</span> Limitations</h3>
<section id="assumes-linear-log-odds" class="level4"><h4 class="anchored" data-anchor-id="assumes-linear-log-odds">1. Assumes Linear Log-Odds</h4>
<p>Logistic regression assumes that the relationship between continuous predictors and the log-odds of the outcome is <strong>linear</strong>. If the true relationship is U-shaped, exponential, or otherwise nonlinear, the model will fit poorly.</p>
<p><strong>Example:</strong> In our loan default model, we assumed credit score affects log-odds linearly. But perhaps default risk drops steeply from 300-500, then more gradually from 500-850. A linear term would miss this.</p>
<p><strong>Solutions:</strong> - Add polynomial terms (e.g., credit_score + credit_score²) - Use splines or generalized additive models (GAMs) - Categorize continuous predictors into meaningful bins</p>
</section><section id="sensitive-to-outliers-and-influential-points" class="level4"><h4 class="anchored" data-anchor-id="sensitive-to-outliers-and-influential-points">2. Sensitive to Outliers and Influential Points</h4>
<p>Unlike robust methods, logistic regression can be heavily influenced by a small number of extreme observations. A single borrower with unusual characteristics (e.g., very low income but very high credit score) can skew coefficient estimates.</p>
<p><strong>Solutions:</strong> - Examine diagnostic plots (Cook’s distance, leverage) - Consider removing or investigating influential cases - Use robust standard errors</p>
</section><section id="requires-sufficient-sample-size" class="level4"><h4 class="anchored" data-anchor-id="requires-sufficient-sample-size">3. Requires Sufficient Sample Size</h4>
<p>With small samples or rare events (e.g., only 5 defaults in 100 loans), maximum likelihood estimates become unstable or even fail to converge. Confidence intervals become very wide, and hypothesis tests lose power.</p>
<p><strong>Solutions:</strong> - Collect more data - Use Firth’s penalized likelihood for small samples - Consider exact logistic regression for very small samples</p>
</section><section id="cannot-handle-perfect-separation" class="level4"><h4 class="anchored" data-anchor-id="cannot-handle-perfect-separation">4. Cannot Handle Perfect Separation</h4>
<p>When a predictor perfectly distinguishes the two outcomes (e.g., everyone with income &gt; $100k never defaults, everyone below always defaults), the MLE algorithm fails because coefficients approach infinity.</p>
<p><strong>Solutions:</strong> - Use Firth’s penalized likelihood - Use exact logistic regression - Combine categories or use Bayesian methods with informative priors</p>
</section><section id="multicollinearity-inflates-standard-errors" class="level4"><h4 class="anchored" data-anchor-id="multicollinearity-inflates-standard-errors">5. Multicollinearity Inflates Standard Errors</h4>
<p>When predictors are highly correlated (e.g., income and credit score both measure financial health), standard errors increase, making it harder to detect significant effects even when they exist.</p>
<p><strong>Solutions:</strong> - Remove redundant predictors - Use principal components or other dimension reduction - Interpret coefficients cautiously as “effect holding other predictors constant”</p>
</section></section><section id="extensions" class="level3" data-number="8.22.2"><h3 data-number="8.22.2" class="anchored" data-anchor-id="extensions">
<span class="header-section-number">8.22.2</span> Extensions</h3>
<p>When binary logistic regression’s assumptions are violated or additional complexity is needed, consider these extensions:</p>
<section id="mixed-effects-logistic-regression" class="level4"><h4 class="anchored" data-anchor-id="mixed-effects-logistic-regression">Mixed-Effects Logistic Regression</h4>
<p>When observations are clustered (e.g., students within schools, patients within hospitals), use mixed-effects models to account for within-cluster correlation.</p>
<p><strong>R packages:</strong> <code><a href="https://rdrr.io/pkg/lme4/man/glmer.html">lme4::glmer()</a></code>, <code>glmmTMB::glmmTMB()</code></p>
</section><section id="generalized-additive-models-gams" class="level4"><h4 class="anchored" data-anchor-id="generalized-additive-models-gams">Generalized Additive Models (GAMs)</h4>
<p>GAMs allow nonlinear relationships between predictors and log-odds without pre-specifying the functional form.</p>
<p><strong>R packages:</strong> <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html">mgcv::gam()</a></code></p>
</section><section id="penalized-logistic-regression-ridge-lasso-elastic-net" class="level4"><h4 class="anchored" data-anchor-id="penalized-logistic-regression-ridge-lasso-elastic-net">Penalized Logistic Regression (Ridge, Lasso, Elastic Net)</h4>
<p>When you have many predictors or multicollinearity, penalized methods shrink coefficients toward zero, improving prediction and sometimes performing variable selection.</p>
<p><strong>R packages:</strong> <code>glmnet::glmnet()</code></p>
</section><section id="bayesian-logistic-regression" class="level4"><h4 class="anchored" data-anchor-id="bayesian-logistic-regression">Bayesian Logistic Regression</h4>
<p>Bayesian methods incorporate prior information and handle small samples and separation issues more gracefully than maximum likelihood.</p>
<p><strong>R packages:</strong> <code>rstanarm::stan_glm()</code>, <code>brms::brm()</code></p>
<hr></section></section></section><section id="summary" class="level2" data-number="8.23"><h2 data-number="8.23" class="anchored" data-anchor-id="summary">
<span class="header-section-number">8.23</span> Summary</h2>
<p>In this chapter, we introduced <strong>binary logistic regression</strong>, a fundamental method for modeling outcomes with two possible categories. Unlike ordinary least squares, which can produce impossible probabilities, logistic regression uses the <strong>logit link function</strong> to transform probabilities into log-odds, ensuring predictions remain between 0 and 1.</p>
<section id="key-takeaways" class="level3" data-number="8.23.1"><h3 data-number="8.23.1" class="anchored" data-anchor-id="key-takeaways">
<span class="header-section-number">8.23.1</span> Key Takeaways</h3>
<ol type="1">
<li><p><strong>The logit transformation</strong> solves the problem of modeling bounded probabilities. By working on the log-odds scale, we can use linear regression techniques while respecting the [0,1] constraint on probabilities.</p></li>
<li><p><strong>Coefficients are on the log-odds scale</strong>, but we typically exponentiate them to obtain <strong>odds ratios</strong>, which are more interpretable. An odds ratio of 0.99 for credit score means that each 1-point increase reduces the odds of default by 1%.</p></li>
<li><p><strong>Maximum likelihood estimation</strong> replaces least squares. Because our outcome follows a Bernoulli distribution, we maximize the likelihood of observing our data rather than minimizing squared residuals.</p></li>
<li><p><strong>Model evaluation requires multiple perspectives</strong>: We used pseudo-R², AIC, BIC, deviance tests, confusion matrices, ROC curves, and diagnostic plots. No single metric tells the whole story.</p></li>
<li><p><strong>The inference vs.&nbsp;prediction distinction</strong> is crucial. Coefficients and hypothesis tests answer “what factors matter?” (inference), while predicted probabilities and classification metrics answer “how well can we predict?” (prediction).</p></li>
<li><p><strong>Parsimony often wins</strong>: In our loan default example, credit score alone was sufficient. Adding income and education years did not significantly improve model fit, demonstrating that more predictors do not always mean better models.</p></li>
</ol></section><section id="looking-ahead" class="level3" data-number="8.23.2"><h3 data-number="8.23.2" class="anchored" data-anchor-id="looking-ahead">
<span class="header-section-number">8.23.2</span> Looking Ahead</h3>
<p>Binary logistic regression handles ungrouped data where each observation is a single trial (default or not default). But what if our data are aggregated? For example, suppose we observe “15 out of 20 students passed” for each combination of study hours and class attendance. This <strong>grouped data</strong> structure calls for a closely related method: <strong>Binomial Logistic Regression</strong>.</p>
<p>In <strong>Chapter 9</strong>, we extend binary logistic regression to handle binomial outcomes, where we observe counts of successes out of a known number of trials. The underlying principles remain the same (logit link, Bernoulli/Binomial distribution, maximum likelihood), but the data structure and interpretation differ slightly. We’ll see how grouped data provides more information per row and how overdispersion can complicate model fitting.</p>
<p>By mastering binary logistic regression, you’ve built a foundation for understanding not just binomial models but the entire family of generalized linear models (GLMs) that connect outcomes from different distributions (Poisson, Gamma, etc.) to linear predictors via link functions. The logic you’ve learned here, from the logit transformation to model diagnostics, will carry forward throughout the rest of the discrete outcome zone.</p>
<hr>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/alexrod61\.github\.io\/regression-cookbook\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="alexrod61/regression-cookbook" data-repo-id="R_kgDOMSJoUA" data-category="General" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../book/discrete-zone.html" class="pagination-link" aria-label="Discrete Cuisine">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Discrete Cuisine</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../book/09-binomial-logistic.html" class="pagination-link" aria-label="Cheesified Binomial Logistic Regression">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Cheesified Binomial Logistic Regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025; G. Alexi Rodríguez-Arelis, Andy Tai, and Ben Chen</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/alexrod61/regression-cookbook/edit/main/book/08-binary-logistic.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/alexrod61/regression-cookbook/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/alexrod61/regression-cookbook/blob/main/book/08-binary-logistic.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>