<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>10&nbsp; Classical Poisson Regression – The Regression Cookbook (in development)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../book/11-negative-binomial.html" rel="next">
<link href="../book/09-binomial-logistic.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script><script src="../site_libs/quarto-diagram/mermaid-init.js"></script><link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../custom.css">
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">The Regression Cookbook (in development)</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
    <a href="https://github.com/alexrod61/regression-cookbook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../book/discrete-zone.html">Discrete Cuisine</a></li><li class="breadcrumb-item"><a href="../book/10-classical-poisson.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Classical Poisson Regression</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../img/cookbook.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/meet-the-team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Meet the Team</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/privacy-policy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Website Privacy Policy</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/audience-scope.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Audience and Scope</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Ready for Regression Cooking!</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/02-stats-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Basic Cuisine: A Review on Probability and Frequentist Statistical Inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../book/continuous-zone.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Continuous Cuisine</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/03-ols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Ordinary Least-squares Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/04-gamma.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Gamma Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/05-beta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Beta Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/06-parametric-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Parametric Survival Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/07-semiparametric-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Semiparametric Survival Regression</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../book/discrete-zone.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Discrete Cuisine</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/08-binary-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Binary Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/09-binomial-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Binomial Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/10-classical-poisson.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Classical Poisson Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/11-negative-binomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Negative Binomial Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/12-zero-inflated-poisson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Zero-Inflated Poisson Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/13-generalized-poisson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Generalized Poisson Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/14-multinomial-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Multinomial Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/15-ordinal-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Ordinal Logistic Regression</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/A-dictionary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">ML-Stats Dictionary</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/B-greek-alphabet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Greek Alphabet</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/C-distributional-mind-map.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Distributional Mind Map</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../book/D-regression-mind-map.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Regression Mind Map</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">The recipe</h2>
   
  <ul>
<li>
<a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">10.1</span> Introduction</a>
  <ul>
<li><a href="#poisson-regression-assumptions" id="toc-poisson-regression-assumptions" class="nav-link" data-scroll-target="#poisson-regression-assumptions"><span class="header-section-number">10.1.1</span> Poisson Regression Assumptions</a></li>
  <li><a href="#a-graphical-look" id="toc-a-graphical-look" class="nav-link" data-scroll-target="#a-graphical-look"><span class="header-section-number">10.1.2</span> A Graphical Look</a></li>
  </ul>
</li>
  <li><a href="#case-study-horseshoe-crab-satellites" id="toc-case-study-horseshoe-crab-satellites" class="nav-link" data-scroll-target="#case-study-horseshoe-crab-satellites"><span class="header-section-number">10.2</span> Case Study: Horseshoe Crab Satellites</a></li>
  <li><a href="#data-collection-and-wrangling" id="toc-data-collection-and-wrangling" class="nav-link" data-scroll-target="#data-collection-and-wrangling"><span class="header-section-number">10.3</span> Data Collection and Wrangling</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis"><span class="header-section-number">10.4</span> Exploratory Data Analysis</a></li>
  <li><a href="#data-modelling" id="toc-data-modelling" class="nav-link" data-scroll-target="#data-modelling"><span class="header-section-number">10.5</span> Data Modelling</a></li>
  <li><a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation"><span class="header-section-number">10.6</span> Estimation</a></li>
  <li><a href="#goodness" id="toc-goodness" class="nav-link" data-scroll-target="#goodness"><span class="header-section-number">10.7</span> Goodness of Fit</a></li>
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference"><span class="header-section-number">10.8</span> Inference</a></li>
  <li>
<a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">10.9</span> Results</a>
  <ul>
<li><a href="#interpreting-the-results-of-a-continuous-variable" id="toc-interpreting-the-results-of-a-continuous-variable" class="nav-link" data-scroll-target="#interpreting-the-results-of-a-continuous-variable"><span class="header-section-number">10.9.1</span> Interpreting the results of a continuous variable</a></li>
  <li><a href="#interpreting-the-results-of-a-categorical-variable" id="toc-interpreting-the-results-of-a-categorical-variable" class="nav-link" data-scroll-target="#interpreting-the-results-of-a-categorical-variable"><span class="header-section-number">10.9.2</span> Interpreting the results of a categorical variable</a></li>
  <li><a href="#prediction-using-test-data" id="toc-prediction-using-test-data" class="nav-link" data-scroll-target="#prediction-using-test-data"><span class="header-section-number">10.9.3</span> Prediction using test data</a></li>
  </ul>
</li>
  <li><a href="#storytelling" id="toc-storytelling" class="nav-link" data-scroll-target="#storytelling"><span class="header-section-number">10.10</span> Storytelling</a></li>
  <li><a href="#practice-problems" id="toc-practice-problems" class="nav-link" data-scroll-target="#practice-problems"><span class="header-section-number">10.11</span> Practice Problems</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/alexrod61/regression-cookbook/edit/main/book/10-classical-poisson.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/alexrod61/regression-cookbook/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/alexrod61/regression-cookbook/blob/main/book/10-classical-poisson.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../book/discrete-zone.html">Discrete Cuisine</a></li><li class="breadcrumb-item"><a href="../book/10-classical-poisson.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Classical Poisson Regression</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-classical-poisson" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Classical Poisson Regression</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><!-- Google tag (gtag.js) --><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-7PRVEBE1EF"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7PRVEBE1EF');
</script><!-- MathJax configuration --><script>
  MathJax = {
    tex: {
      tags: 'ams',  // enable numbering
      useLabelIds: true
    }
  };
</script><div class="Warning">
<div class="Warning-header">
<p>When to Use and Not Use Classical Poisson Regression</p>
</div>
<div class="Warning-container">
<p>Classical Poisson regression is a type of generalized linear model that is appropriately used under the following conditions:</p>
<ul>
<li>The outcome variable is <strong>discrete</strong> and <strong>count-type</strong> as shown in <a href="#fig-classical-poisson-regression" class="quarto-xref">Figure&nbsp;<span>10.1</span></a>. Examples include number of doctor visits, number of web clicks, number of accidents, etc.</li>
<li>Outcomes are statistically independent from one to the next.</li>
<li>The <strong>mean</strong> and <strong>variance</strong> of the counts is approximately equal (i.e., there is <strong>equidispersion</strong>).</li>
<li>Counts occur over fixed and known exposures (such as time intervals or geographic areas).</li>
<li>We intend to use the <strong>logarithm of the mean</strong> of the outcome as a <strong>link function</strong>, which ensures that our predictions are always positive.</li>
</ul>
<p>However, Classical Poisson regression should not be used in the following scenarios:</p>
<ul>
<li>The outcome is not a count (e.g., binary outcomes, proportions, or continuous variables).</li>
<li>The data shows <strong>overdispersion</strong> (i.e., the variance exceeds the mean). In this case, check <a href="https://alexrod61.github.io/regression-cookbook/book/11-negative-binomial.html">Negative Binomial</a> or <a href="https://alexrod61.github.io/regression-cookbook/book/13-generalized-poisson.html">Generalized Poisson</a> regressions.</li>
<li>The data shows <strong>underdispersion</strong> (i.e., the variance is less than the mean), which Poisson regression cannot accommodate. Alternatively, check <a href="https://alexrod61.github.io/regression-cookbook/book/13-generalized-poisson.html">Generalized Poisson</a> regression.</li>
<li>The outcome variable includes a large number of zeros. Instead, check <a href="https://alexrod61.github.io/regression-cookbook/book/12-zero-inflated-poisson.html">Zero-Inflated Poisson</a> regression.</li>
</ul>
</div>
</div>
<div id="fig-classical-poisson-regression" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-classical-poisson-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"></figure><p></p>
<div>
<pre class="mermaid mermaid-js">mindmap
  root((Regression 
  Analysis)
    Continuous &lt;br/&gt;Outcome Y
      {{Unbounded &lt;br/&gt;Outcome Y}}
        )Chapter 3: &lt;br/&gt;Ordinary &lt;br/&gt;Least Squares &lt;br/&gt;Regression(
          (Normal &lt;br/&gt;Outcome Y)
      {{Nonnegative &lt;br/&gt;Outcome Y}}
        )Chapter 4: &lt;br/&gt;Gamma Regression(
          (Gamma &lt;br/&gt;Outcome Y)
      {{Bounded &lt;br/&gt;Outcome Y &lt;br/&gt; between 0 and 1}}
        )Chapter 5: Beta &lt;br/&gt;Regression(
          (Beta &lt;br/&gt;Outcome Y)
      {{Nonnegative &lt;br/&gt;Survival &lt;br/&gt;Time Y}}
        )Chapter 6: &lt;br/&gt;Parametric &lt;br/&gt; Survival &lt;br/&gt;Regression(
          (Exponential &lt;br/&gt;Outcome Y)
          (Weibull &lt;br/&gt;Outcome Y)
          (Lognormal &lt;br/&gt;Outcome Y)
        )Chapter 7: &lt;br/&gt;Semiparametric &lt;br/&gt;Survival &lt;br/&gt;Regression(
          (Cox Proportional &lt;br/&gt;Hazards Model)
            (Hazard Function &lt;br/&gt;Outcome Y)
    Discrete &lt;br/&gt;Outcome Y
      {{Binary &lt;br/&gt;Outcome Y}}
        {{Ungrouped &lt;br/&gt;Data}}
          )Chapter 8: &lt;br/&gt;Binary Logistic &lt;br/&gt;Regression(
            (Bernoulli &lt;br/&gt;Outcome Y)
        {{Grouped &lt;br/&gt;Data}}
          )Chapter 9: &lt;br/&gt;Binomial Logistic &lt;br/&gt;Regression(
            (Binomial &lt;br/&gt;Outcome Y)
      {{Count &lt;br/&gt;Outcome Y}}
        {{Equidispersed &lt;br/&gt;Data}}
          )Chapter 10: &lt;br/&gt;Classical Poisson &lt;br/&gt;Regression(
            (Poisson &lt;br/&gt;Outcome Y)
</pre>
</div>
<p></p>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-classical-poisson-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.1: Regression analysis mind map depicting all modelling techniques explored so far in this book. Depending on the type of outcome <span class="math inline">\(Y\)</span>, these techniques are split into two large zones: <em>discrete</em> and <em>continuous</em>.
</figcaption></figure>
</div>
<div class="LO">
<div class="LO-header">
<p>Learning Objectives</p>
</div>
<div class="LO-container">
<p>By the end of this chapter, you will be able to:</p>
<ul>
<li>Describe the reason that ordinary linear models is inappropriate to use.</li>
<li>Determine when Poisson regression is an appropriate modeling choice.</li>
<li>Write down the likelihood function of a Poisson regression models.</li>
<li>Understand the computation procedure of the Poisson regression coefficient estimation.</li>
<li>Interpret the Poisson regression coefficients in the real scenarios.</li>
<li>Evaluate model performance and construct confidence intervals.</li>
</ul>
</div>
</div>
<section id="introduction" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="introduction">
<span class="header-section-number">10.1</span> Introduction</h2>
<p>This chapter introduces a generalized linear regression model that can be applied on Poisson-distributed count data. Compared to ordinary regression, which assume normality and constant variance—homoskedasticity, Poisson regression models count data that is skewed and heteroskedastic.</p>
<p>Some research questions you might explore using Poisson regression:</p>
<ul>
<li>How is the number of insurance claims filed by policyholders in a year associated with ages, vehicle types, and regions?</li>
<li>How can the number of complaints received by a telecom company from customers be explained by service types and contract lengths?</li>
<li>How does the distribution of counts of satellite male horseshoe crabs residing around a female horseshoe crab nest vary by the phenotypic characteristics of the female horseshoe crabs?</li>
</ul>
<section id="poisson-regression-assumptions" class="level3" data-number="10.1.1"><h3 data-number="10.1.1" class="anchored" data-anchor-id="poisson-regression-assumptions">
<span class="header-section-number">10.1.1</span> Poisson Regression Assumptions</h3>
<ul>
<li><p><strong>Independence</strong>: Poisson regression assumes the responses to be counts–(nonnegative integers: 0, 1, 2,…). Each response is mutually independent to each other with mean parameter <span class="math inline">\(\lambda_i,i=1,\dots,n\)</span>.</p></li>
<li><p><strong>Log-linearity</strong>: Poisson regression models the log-link function of the response as a linear combination of the explanatory variables, i.e., <span class="math inline">\(\log(\lambda_i) = \beta_0 + \beta_1 X_{i1}+\dots+\beta_p X_{ip}\)</span> with <span class="math inline">\(\lambda_i&gt; 0\)</span> for all <span class="math inline">\(i=1,\dots,n\)</span>.</p></li>
<li><p><strong>Heteroskedasticity</strong>: Poisson regression assumes heteoroskedastic response, i.e., the variance of the response increases along with the mean increasing; in contrast to the ordinary regression with Gaussian noise, whose the variance is constant and independent to the mean. Poisson regression assumes <strong>equidispersion</strong>, i.e., the variance is the same as the expectation of the response; compared to overdispersion in negative binomial distribution where the variance is greater than the mean.</p></li>
</ul></section><section id="a-graphical-look" class="level3" data-number="10.1.2"><h3 data-number="10.1.2" class="anchored" data-anchor-id="a-graphical-look">
<span class="header-section-number">10.1.2</span> A Graphical Look</h3>
<p>Below is a graphical demonstration of the comparison between the ordinary linear regression with Gaussian distributed response and Poisson regression with Poisson distributed response. The left panel illustrates the price of smartphones (in 100 USD) increase with the number of days listed on an online marketplace. The right panel illustrates the number of bacteria colonies on a petri dish versus the hours of incubation.</p>
<p>The ordinary linear regression has a linear fitted blue line (in the left panel), while the Poisson regression, due to the use of log-link function, has a fitted blue curve (in the right panel). Segment the explanatory variable (in the x axis) in each scenario into five sections using the gray dashed vertical lines. The red horizontal segments represent the frequencies of binned response in each section, which represents the rotated histogram of the response. In ordinary linear regression, the response in each section is symmetrically distributed with similar variation across five sections (i.e., homoskedasticity); while in Poisson regression, the response is skewed with heteroskedasticity (specifically, increasing variances as the responses increase) across sections.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="case-study-horseshoe-crab-satellites" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="case-study-horseshoe-crab-satellites">
<span class="header-section-number">10.2</span> Case Study: Horseshoe Crab Satellites</h2>
<p>Let’s take a closer look at the example in the third question mentioned in the Introduction—exploring the differential distribution of the number of satellite male horseshoe crabs residing around a female horseshoe crab nest across various phenotypic characteristics. Using the dataset <code>crabs</code> provided by <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1439-0310.1996.tb01099.x">Brockmann, 1996</a>, let’s load the dataset and do some data wrangling.</p>
</section><section id="data-collection-and-wrangling" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="data-collection-and-wrangling">
<span class="header-section-number">10.3</span> Data Collection and Wrangling</h2>
<p>There are 173 records of the female horseshoe crab nests and their male satellites with 5 features: <code>satell</code>: satellite size of each nest (i.e., the number of male horseshoe crabs around each female horseshoe crab nest), <code>width</code>: shell width in cm, <code>color</code>: 1 = medium light, 2 = medium, 3 = medium dark, 4 = dark, <code>spine</code>: spine condition: 1 = both good, 2 = one broken, 3 = both broken, and <code>weight</code>: weight in kg (referring to Section 3.3.3 in <a href="https://www.wiley.com/en-us/An+Introduction+to+Categorical+Data+Analysis%2C+3rd+Edition-p-9781119405283">Agresti, 2018</a>).</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">asbio</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">crabs</span><span class="op">)</span></span>
<span><span class="va">crabs</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">crabs</span><span class="op">)</span></span>
<span><span class="co"># reorder the columns</span></span>
<span><span class="va">crabs</span> <span class="op">&lt;-</span> <span class="va">crabs</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">satell</span>, <span class="va">width</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># display the dataset with dimension and column types</span></span>
<span><span class="va">crabs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(crabs.dtypes)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>crabs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 173 × 5
   satell width color spine weight
    &lt;int&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;  &lt;dbl&gt;
 1      8  28.3 2     3       3.05
 2      0  22.5 3     3       1.55
 3      9  26   1     1       2.3 
 4      0  24.8 3     3       2.1 
 5      4  26   3     3       2.6 
 6      0  23.8 2     3       2.1 
 7      0  26.5 1     1       2.35
 8      0  24.7 3     2       1.9 
 9      0  23.7 2     1       1.95
10      0  25.6 3     3       2.15
# ℹ 163 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>satell       int64
width      float64
color     category
spine     category
weight     float64
dtype: object</code></pre>
</div>
<div class="cell-output-display">
<div>

<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead><tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">satell</th>
<th data-quarto-table-cell-role="th">width</th>
<th data-quarto-table-cell-role="th">color</th>
<th data-quarto-table-cell-role="th">spine</th>
<th data-quarto-table-cell-role="th">weight</th>
</tr></thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8</td>
<td>28.3</td>
<td>2</td>
<td>3</td>
<td>3.050</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>22.5</td>
<td>3</td>
<td>3</td>
<td>1.550</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>9</td>
<td>26.0</td>
<td>1</td>
<td>1</td>
<td>2.300</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>24.8</td>
<td>3</td>
<td>3</td>
<td>2.100</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>26.0</td>
<td>3</td>
<td>3</td>
<td>2.600</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">168</td>
<td>3</td>
<td>26.1</td>
<td>3</td>
<td>3</td>
<td>2.750</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">169</td>
<td>4</td>
<td>29.0</td>
<td>3</td>
<td>3</td>
<td>3.275</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">170</td>
<td>0</td>
<td>28.0</td>
<td>1</td>
<td>1</td>
<td>2.625</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">171</td>
<td>0</td>
<td>27.0</td>
<td>4</td>
<td>3</td>
<td>2.625</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">172</td>
<td>0</td>
<td>24.5</td>
<td>2</td>
<td>2</td>
<td>2.000</td>
</tr>
</tbody>
</table>
<p>173 rows × 5 columns</p>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Let’s now split the data into training and test sets.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use 70% data for training and 30% for testing</span></span>
<span><span class="va">par</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span>
<span></span>
<span><span class="co"># Set seed for reproducible splitting</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1046</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">crabs</span><span class="op">)</span></span>
<span><span class="va">train_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">par</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create training and test sets</span></span>
<span><span class="va">train_set</span> <span class="op">&lt;-</span> <span class="va">crabs</span><span class="op">[</span><span class="va">train_indices</span>, <span class="op">]</span></span>
<span><span class="va">test_set</span> <span class="op">&lt;-</span> <span class="va">crabs</span><span class="op">[</span><span class="op">-</span><span class="va">train_indices</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Print the number of training and test samples</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Number of training samples:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">train_set</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Number of test samples:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">test_set</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use 70% data for training and 30% for testing</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>par <span class="op">=</span> <span class="fl">0.7</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducible splitting</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1046</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">len</span>(crabs)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>train_indices <span class="op">=</span> np.random.choice(n, size<span class="op">=</span><span class="bu">int</span>(par <span class="op">*</span> n), replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create training and test sets</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>train_set <span class="op">=</span> crabs.iloc[train_indices]</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>test_set <span class="op">=</span> crabs.drop(index<span class="op">=</span>train_indices)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the number of training and test samples</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of training samples: </span><span class="sc">{</span><span class="bu">len</span>(train_set)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of test samples: </span><span class="sc">{</span><span class="bu">len</span>(test_set)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Number of training samples: 122 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of test samples: 51 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Number of training samples: 122</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of test samples: 51</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="exploratory-data-analysis" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="exploratory-data-analysis">
<span class="header-section-number">10.4</span> Exploratory Data Analysis</h2>
<p>Suppose that the relationship between the satellite size per nest (<code>satell</code>) and width of the female horseshoe crab (<code>width</code> in cm) is our main research interest. Let’s explore their relationship in the following scatterplot with the distribution of <code>satell</code> on the margin.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># draw the scatterplot of satellite size versus width </span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">crabs</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">satell</span>, x <span class="op">=</span> <span class="va">width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Width (cm)"</span>, y <span class="op">=</span> <span class="st">"Satellite Size"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">crabs</span><span class="op">$</span><span class="va">width</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">crabs</span><span class="op">$</span><span class="va">width</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># add a marginal histogram with binwidth of 1, i.e., bins for integers; equivalent to the barplot</span></span>
<span><span class="fu">ggMarginal</span><span class="op">(</span><span class="va">p</span>, type <span class="op">=</span> <span class="st">"histogram"</span>, margins <span class="op">=</span> <span class="st">"y"</span>, binwidth <span class="op">=</span> <span class="fl">1</span>, boundary <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span> <span class="co"># start with `satell=-0.5` to avoid the first bins (0s and 1s) being combined in one bin</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style <span class="op">=</span> <span class="st">"whitegrid"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create bins of width 1 for the marginal histogram</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>bin_edges <span class="op">=</span> np.arange(crabs[<span class="st">'satell'</span>].<span class="bu">min</span>(), crabs[<span class="st">'satell'</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">2</span>, <span class="dv">1</span>)  <span class="co"># bins of width 1</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># draw the scatterplot of satellite size versus width with marginal distributions</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.jointplot(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> crabs, </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"width"</span>, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"satell"</span>, </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    kind <span class="op">=</span> <span class="st">"scatter"</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    marginal_ticks <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    marginal_kws <span class="op">=</span> <span class="bu">dict</span>(bins <span class="op">=</span> bin_edges, fill <span class="op">=</span> <span class="va">True</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>g.ax_marg_x.remove() <span class="co"># remove the marginal histogram on x axis</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># add labels</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>g.ax_joint.set_xlabel(<span class="st">"Width (cm)"</span>) </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>g.ax_joint.set_ylabel(<span class="st">"Satellite Size"</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># add axes' limits</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>ymin, ymax <span class="op">=</span> crabs[<span class="st">'satell'</span>].<span class="bu">min</span>(), crabs[<span class="st">'satell'</span>].<span class="bu">max</span>()</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> crabs[<span class="st">'width'</span>].<span class="bu">min</span>(), crabs[<span class="st">'width'</span>].<span class="bu">max</span>()</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>g.ax_joint.set_xlim(xmin <span class="op">-</span> <span class="dv">1</span>, xmax <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>g.ax_joint.set_ylim(ymin <span class="op">-</span> <span class="fl">0.5</span>, ymax <span class="op">+</span> <span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>g.ax_marg_y.set_ylim(ymin <span class="op">-</span> <span class="fl">0.5</span>, ymax <span class="op">+</span> <span class="fl">0.5</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>The distribution of satellite sizes is highly right skewed, which violates the normality assumption of the ordinary linear regression.</p>
<p>In the scatter plot above, we can tell that the satellite size gets more spread out as the width increases. The averaged satellite sizes turn to increase along the width increasing. Let’s now split the width into a few intervals and compute the representative point for each interval to have a clear look at the trend.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># set up the number of intervals</span></span>
<span><span class="va">n_intervals</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># compute the average points for each interval of `width`</span></span>
<span><span class="va">crabs_binned</span> <span class="op">&lt;-</span> <span class="va">crabs</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>width_inl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">width</span>, breaks <span class="op">=</span> <span class="va">n_intervals</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">width_inl</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span></span>
<span>    mean_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>    mean_satell <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">satell</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">crabs_binned</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up the number of intervals</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>n_intervals <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the average points for each interval of `width`</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>crabs[<span class="st">'width_inl'</span>] <span class="op">=</span> pd.cut(crabs[<span class="st">'width'</span>], bins<span class="op">=</span>n_intervals)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>crabs_binned <span class="op">=</span> (</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    crabs</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'width_inl'</span>, observed<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    .agg(mean_width<span class="op">=</span>(<span class="st">'width'</span>, <span class="st">'mean'</span>), mean_satell<span class="op">=</span>(<span class="st">'satell'</span>, <span class="st">'mean'</span>))</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>crabs_binned</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   width_inl   mean_width mean_satell
   &lt;fct&gt;            &lt;dbl&gt;       &lt;dbl&gt;
 1 (21,22.2]         21.5        0   
 2 (22.2,23.5]       23.0        1   
 3 (23.5,24.8]       24.2        1.77
 4 (24.8,26]         25.5        2.98
 5 (26,27.2]         26.6        2.53
 6 (27.2,28.5]       27.9        4.15
 7 (28.5,29.8]       29.1        4   
 8 (29.8,31]         30.1        4.86
 9 (31,32.2]         31.8        3   
10 (32.2,33.5]       33.5        7   </code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="cell-output-display">
<div>

<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead><tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">width_inl</th>
<th data-quarto-table-cell-role="th">mean_width</th>
<th data-quarto-table-cell-role="th">mean_satell</th>
</tr></thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>(20.988, 22.25]</td>
<td>21.50</td>
<td>0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>(22.25, 23.5]</td>
<td>22.97</td>
<td>1.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>(23.5, 24.75]</td>
<td>24.25</td>
<td>1.77</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>(24.75, 26.0]</td>
<td>25.49</td>
<td>2.98</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>(26.0, 27.25]</td>
<td>26.60</td>
<td>2.53</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>(27.25, 28.5]</td>
<td>27.92</td>
<td>4.15</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>(28.5, 29.75]</td>
<td>29.08</td>
<td>4.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>(29.75, 31.0]</td>
<td>30.11</td>
<td>4.86</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>(31.0, 32.25]</td>
<td>31.80</td>
<td>3.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>(32.25, 33.5]</td>
<td>33.50</td>
<td>7.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>We’ve prepared the summarized dataset for the average points—each entry includes an interval of <code>width</code>, an averaged width, and an averaged satellite size per interval. Now, let’s visualize the representative points on the scatter plot to take a closer look at the trend.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># add the average points onto the scatterplot, connect them, and mark intervals</span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">crabs</span><span class="op">$</span><span class="va">width</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">crabs</span><span class="op">$</span><span class="va">width</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">n_intervals</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">breaks</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">crabs_binned</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mean_width</span>, y <span class="op">=</span> <span class="va">mean_satell</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">crabs_binned</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mean_width</span>, y <span class="op">=</span> <span class="va">mean_satell</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># draw the scatterplot of satellite size versus width</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> (</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    ggplot(crabs, aes(x<span class="op">=</span><span class="st">'width'</span>, y<span class="op">=</span><span class="st">'satell'</span>)) <span class="op">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    geom_point(alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'black'</span>) <span class="op">+</span>  <span class="co"># points in gray</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    labs(x<span class="op">=</span><span class="st">"Width (cm)"</span>, y<span class="op">=</span><span class="st">"Satellite Size"</span>) <span class="op">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    scale_x_continuous(breaks<span class="op">=</span><span class="bu">range</span>(<span class="bu">int</span>(np.floor(crabs[<span class="st">'width'</span>].<span class="bu">min</span>())), <span class="bu">int</span>(np.ceil(crabs[<span class="st">'width'</span>].<span class="bu">max</span>())) <span class="op">+</span> <span class="dv">1</span>, <span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    scale_y_continuous(breaks<span class="op">=</span><span class="bu">range</span>(<span class="bu">int</span>(np.floor(crabs[<span class="st">'satell'</span>].<span class="bu">min</span>())), <span class="bu">int</span>(np.ceil(crabs[<span class="st">'satell'</span>].<span class="bu">max</span>())) <span class="op">+</span> <span class="dv">1</span>, <span class="dv">2</span>)) <span class="op">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    theme_bw()</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># add the average points onto the scatterplot, connect them, and mark intervals</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>breaks <span class="op">=</span> np.linspace(crabs[<span class="st">'width'</span>].<span class="bu">min</span>(), crabs[<span class="st">'width'</span>].<span class="bu">max</span>(), n_intervals <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>p_final <span class="op">=</span> (</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    p <span class="op">+</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    geom_vline(xintercept<span class="op">=</span>breaks, linetype<span class="op">=</span><span class="st">'dashed'</span>, color<span class="op">=</span><span class="st">'gray'</span>) <span class="op">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    geom_point(data<span class="op">=</span>crabs_binned, mapping<span class="op">=</span>aes(x<span class="op">=</span><span class="st">'mean_width'</span>, y<span class="op">=</span><span class="st">'mean_satell'</span>), color<span class="op">=</span><span class="st">'red'</span>, size<span class="op">=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    geom_line(data<span class="op">=</span>crabs_binned, mapping<span class="op">=</span>aes(x<span class="op">=</span><span class="st">'mean_width'</span>, y<span class="op">=</span><span class="st">'mean_satell'</span>), color<span class="op">=</span><span class="st">'red'</span>, size<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>p_final.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>We can see a general increasing trend of the satellite size as the nest width grows.</p>
</section><section id="data-modelling" class="level2" data-number="10.5"><h2 data-number="10.5" class="anchored" data-anchor-id="data-modelling">
<span class="header-section-number">10.5</span> Data Modelling</h2>
<p>The Poisson regression model assumes a random sample of <span class="math inline">\(n\)</span> count observations <span class="math inline">\(Y_i\)</span>s, hence independent (but not identically distributed!), which have the following distribution: <span class="math display">\[Y_i \sim \mathrm{Poisson}(\lambda_i).\]</span> Each <span class="math inline">\(i\)</span>th observation has its own <span class="math inline">\(\mathbb{E}(Y_i)=\lambda_i&gt;0\)</span>, which also implicates <span class="math inline">\(Var(Y_i)=\lambda_i&gt;0\)</span>.</p>
<p>Parameter <span class="math inline">\(\lambda_i\)</span> is the risk of an event occurrence, coming from the definition of the Poisson random variable, in a given timeframe or even a space. It is a <strong>continuous</strong> distributional parameter! For the <code>crabs</code> dataset, the events are the number of satellite male horseshoe crabs around a space: the female breeding nest.</p>
<p>Since the Poisson Regression model is also a GLM, we need to set up a link function for the mean. Let <span class="math inline">\(X_{i,\text{width}}\)</span> be the <span class="math inline">\(i\)</span>th value for the regressor <code>width</code> in our dataset. An easy modelling solution would be an <strong>identity</strong> link function as in <span class="math display">\[
h(\lambda_i)=\lambda_i=\beta_0+\beta_1 X_{i,\text{width}}. \label{eq:pois-uni-iden}
\]</span></p>
<p>However, <strong>we have a response range issue!</strong></p>
<p>The model <span class="citation" data-cites="eq:pois-uni-iden">(<a href="references.html#ref-eq:pois-uni-iden" role="doc-biblioref"><strong>eq:pois-uni-iden?</strong></a>)</span> for has a significant <strong>drawback</strong>: the right-hand side is allowed to take on even negative values, which does not align with the nature of the parameter <span class="math inline">\(\lambda_i\)</span> (that always has to be <strong>non-negative</strong>).</p>
<p>Recall the essential characteristic of a GLM that should come into play for a link function. In this class of models, the direct relationship between the original response and the regressors may be <strong>non-linear</strong> as in <span class="math inline">\(h(\lambda_i)\)</span>. Hence, instead of using the identity link function, we will use the natural logarithm of the mean: <span class="math inline">\(\log(\lambda_i)\)</span>.</p>
<p>Before continuing with the crabs dataset, let us generalize the Poisson regression model with <span class="math inline">\(k\)</span> regressors as: <span class="math display">\[
  h(\lambda_i) = \log(\lambda_i)=\beta_0+\beta_1 X_{i,1}+\dots+\beta_k X_{i,k}. \label{eq:pois-k}
\]</span> We could make more sense in the interpretation by exponentiating <span class="citation" data-cites="eq:pois-k">(<a href="references.html#ref-eq:pois-k" role="doc-biblioref"><strong>eq:pois-k?</strong></a>)</span>: <span class="math display">\[
  \lambda_i = \exp(\beta_0+\beta_1 X_{i,1}+\dots+\beta_k X_{i,k}), \label{eq:pois-k-exp}
\]</span> where an increase in one unit in any of the <span class="math inline">\(k\)</span> regressors (while keeping the rest of them constant) multiplies the mean <span class="math inline">\(\lambda_i\)</span> by a factor <span class="math inline">\(\exp(\beta_j)\)</span>, for all <span class="math inline">\(j=i,\dots,k\)</span>.</p>
<p>In the <code>crabs</code> dataset with width as a regressor, the Poisson regression model is depicted as: <span class="math display">\[
  \log(\lambda_i)=\lambda_i=\beta_0+\beta_1 X_{i,\text{width}}. \label{eq:pois-uni}
\]</span></p>
</section><section id="estimation" class="level2" data-number="10.6"><h2 data-number="10.6" class="anchored" data-anchor-id="estimation">
<span class="header-section-number">10.6</span> Estimation</h2>
<p>In generalized linear models (GLMs), parameter estimation is typically performed using maximum likelihood estimation (MLE). A widely used algorithm to compute the MLE in GLMs is the iteratively reweighted least squares (IRLS) method, which learns the regression coefficients by solving the weighted least squares problems through iteration. Below we learn the essential elements of the IRLS method and the MLE that it solves. We use Poisson regression as an example, but the procedure applies to other distributions straightforwardly.</p>
<p>The general idea to solve the generalized linear regression is to estimate the parameters by maximizing the likelihood. For Poisson regression in <span class="citation" data-cites="eq:pois-k">(<a href="references.html#ref-eq:pois-k" role="doc-biblioref"><strong>eq:pois-k?</strong></a>)</span> specifically, it is written as: <span class="math display">\[
  \prod_{i=1}^n p_{Y_i}(y_i) = \prod_{i=1}^n \frac{e^{-\lambda_i}{\lambda_i}^{y_i}}{y_i!},
\]</span> where <span class="math inline">\(p_{Y_i}(y_i)\)</span> is the probability mass function of <span class="math inline">\(Y_i\)</span>, for <span class="math inline">\(i=1,\dots,n\)</span>.</p>
<p>Let <span class="math inline">\(\boldsymbol{\beta}:=(\beta_0,\dots,\beta_k)^{\top}\)</span> be the coefficient vector, and then <span class="citation" data-cites="eq:pois-k-exp">(<a href="references.html#ref-eq:pois-k-exp" role="doc-biblioref"><strong>eq:pois-k-exp?</strong></a>)</span> can be rewritten as <span class="math inline">\(\lambda_i=\exp(X_{i}^{\top}\boldsymbol{\beta})\)</span>, where <span class="math inline">\(X_{i}^{\top}\)</span> is the row <span class="math inline">\(i\)</span> in the design matrix <span class="math inline">\(X\)</span>. Maximizing the likelihood is equivalent to minimizing the log-likelihood in terms of solving for the parameters <span class="math inline">\(\beta_j,j=1,\dots,k\)</span>: <span class="math display">\[
  {\arg\min}_{\boldsymbol{\lambda}} - \prod_{i=1}^n\frac{e^{-\lambda_i}{\lambda_i}^{y_i}}{y_i!} = {\arg\min}_{\boldsymbol{\lambda}} \sum_{i=1}^n \lambda_i - y_i \log(\lambda_i).
\]</span> Plugging in <span class="math inline">\(\lambda_i=\exp(X_{i}^{\top}\boldsymbol{\beta})\)</span> gives the minimization problem with respect to the Poisson regression coefficients: <span class="math display">\[
  {\arg\min}_{\boldsymbol{\beta}} \sum_{i=1}^n \exp(X_{i}^{\top}\boldsymbol{\beta}) - y_i X_{i}^{\top}\boldsymbol{\beta}. \label{eq:pois-log}
\]</span></p>
<p>Since the objective in <span class="citation" data-cites="eq:pois-log">(<a href="references.html#ref-eq:pois-log" role="doc-biblioref"><strong>eq:pois-log?</strong></a>)</span> is not quadratic and there is no closed form solution, we could not solve the equation exactly. IRLS solves an approximated solution with a specified accuracy or tolerance. The basic idea is that IRLS uses Fisher scoring (or Newton-Raphson) to solve an approximated problem of the original objective <span class="citation" data-cites="eq:pois-log">(<a href="references.html#ref-eq:pois-log" role="doc-biblioref"><strong>eq:pois-log?</strong></a>)</span> and solve it iteratively with weights updated through iteration until the specified accuracy is achieved, i.e., the objective is converged.</p>
<p>The MLE <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> satisfies the score function <span class="math inline">\(U(\boldsymbol{\beta}) = \nabla_{\boldsymbol{\beta}} \ell(\boldsymbol{\beta}) = 0\)</span>. Applying the Fisher scoring update gives: <span class="math display">\[
  \boldsymbol{\beta}^{t+1} \leftarrow \boldsymbol{\beta}^{t} + {\mathcal{I}(\boldsymbol{\beta}^t)}^{-1} U(\boldsymbol{\beta}^{t}),
\]</span> where <span class="math inline">\(\mathcal{I}(\boldsymbol{\beta}^t) := \mathbb{E}\big[- \nabla^2_{\boldsymbol{\beta}} \ell(\boldsymbol{\beta}^t)\big]\)</span> is the Fisher information, which is the expectation of the negative second-order derivative of the log-likelihood with respect to the parameters.</p>
<p>The Fisher scoring update corresponds to solve the following approximated problem of the original objective at iterate <span class="math inline">\(t+1\)</span>, which is a weighted least squares problem written as: <span class="math display">\[
  \begin{align}
    \boldsymbol{\beta}^{t+1} &amp;= {\arg\min}_{\boldsymbol{\beta}} \sum_{i=1}^n w_i^t (y_i^t - X_i^{\top}\boldsymbol{\beta})^2 \\
    &amp;= {\arg\min}_{\boldsymbol{\beta}} \sum_{i=1}^n w_i^t (y_i^t - \beta_0 - \beta_1 x_{i,\text{width}})^2 \label{eq:irls-approx}
  \end{align}
\]</span> given the estimates at time <span class="math inline">\(t\)</span> for the univariate case using <code>crabs</code> dataset. The approximated problem has a closed-form solution and is much easier to solve than the original objective. The observations <span class="math inline">\(y_i\)</span> and weights <span class="math inline">\(w_i\)</span> should be updated per iterate. The arbitrary observations <span class="math inline">\(y_i^{t+1}\)</span> is a function of the original observations <span class="math inline">\(y_i^0\)</span> and the coefficient estimates. The weights is updated by <span class="math display">\[w_i^{t+1} = \Big(\frac{1}{Var(Y_i)}\Big)\Big(\frac{1}{g'(\lambda_i)}\Big)^2,\]</span> where <span class="math inline">\(\lambda_i\)</span> is the mean of the response <span class="math inline">\(y_i\)</span>, <span class="math inline">\(\eta_i=g(\lambda_i)\)</span> is the link function of the mean. In our case, the weights at iterate <span class="math inline">\(t+1\)</span> can be updated given the coefficient estimates at <span class="math inline">\(t\)</span> using the following formula: <span class="math display">\[
  w_i^{t+1} = \exp(X_i^{\top} \boldsymbol{\beta}^t), \forall i=1,\dots,n.
\]</span></p>
<p>The IRLS iteration procedure is as follows.</p>
<ol type="1">
<li>Choose a set of initial coefficients <span class="math inline">\(\boldsymbol{\lambda}^0 = (\lambda_0^0,\dots,\lambda_k^0)\)</span>, which can be a vector of zeros.</li>
<li>Compute the weights based on the estimates from the previous iterate, or the inital coefficients at the first iterate.</li>
<li>Solve the approximated problem <span class="citation" data-cites="irls-approx">(<a href="references.html#ref-irls-approx" role="doc-biblioref"><strong>irls-approx?</strong></a>)</span>.</li>
<li>Check te convergence condition.</li>
<li>Return estimates if the objective is converged; go back to step 2 if not.</li>
</ol>
<p>Let’s now fit the model on the training data.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit Poisson regression</span></span>
<span><span class="va">poisson_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">satell</span> <span class="op">~</span> <span class="va">width</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">poisson_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Poisson regression</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>poisson_model <span class="op">=</span> glm(formula<span class="op">=</span><span class="st">'satell ~ width'</span>, data<span class="op">=</span>train_data, family<span class="op">=</span>sm.families.Poisson(link<span class="op">=</span>sm.families.links.log())).fit()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View summary</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(poisson_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = satell ~ width, family = poisson(link = "log"), 
    data = train_set)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -3.43023    0.64716  -5.300 1.16e-07 ***
width        0.16973    0.02386   7.112 1.14e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 476.83  on 121  degrees of freedom
Residual deviance: 428.20  on 120  degrees of freedom
AIC: 679.01

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                 Generalized Linear Model Regression Results                  
==============================================================================
Dep. Variable:                 satell   No. Observations:                  122
Model:                            GLM   Df Residuals:                      120
Model Family:                 Poisson   Df Model:                            1
Link Function:                    log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -337.50
Date:                Mon, 09 Feb 2026   Deviance:                       428.20
Time:                        14:27:54   Pearson chi2:                     418.
No. Iterations:                     5   Pseudo R-squ. (CS):             0.3287
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     -3.4302      0.647     -5.300      0.000      -4.699      -2.162
width          0.1697      0.024      7.112      0.000       0.123       0.216
==============================================================================</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="goodness" class="level2" data-number="10.7"><h2 data-number="10.7" class="anchored" data-anchor-id="goodness">
<span class="header-section-number">10.7</span> Goodness of Fit</h2>
<p>In GLMs, we can use residual deviance and Chi-squared test to check the goodness of fit of the model. The residual deviance measures how well the fitted model explains the observed outcomes, compared to a perfect model (the saturated model) that explains the data exactly. A smaller residual deviance means a better fit of the data. It is computed as <span class="math display">\[\text{Residual&nbsp;Deviance } = 2 (\ell_{\mathrm{saturated}} - \ell_{\mathrm{fitted}}),\]</span> where <span class="math inline">\(\ell_A\)</span> is the log-likelihood of model <span class="math inline">\(A\)</span>. For Poisson regression specifically, the residual deviance is <span class="math inline">\(2\sum_{i=1}^n \Big[y_i\log\big(\frac{y_i}{\hat{\lambda}_i}\big) - (y_i-\hat{\lambda}_i)\Big]\)</span>.</p>
<p>When the model is a good fit, the residual deviance is expected to follow a chi-squared distribution with degrees of freedom <span class="math inline">\(df = n - p\)</span>, where <span class="math inline">\(n\)</span> is the number of observations and <span class="math inline">\(p\)</span> is the number of parameters, asymptotically for a large enough sample size. We then can compute the <span class="math inline">\(p\)</span>-value using the chi-squared distribution: <span class="math display">\[
  p\text{-value} = 1-P(\chi^2_{\mathrm{df}} \leq \text{residual deviance}).
\]</span></p>
<p><span class="math inline">\(p\)</span>-value is the probability of observing a residual deviance as large as (or larger than) what we got, if the model is truly correct. A large p-value (e.g., &gt; 0.05) means that the observed deviance is not surprisingly large. Out model is a good fit and could plausibly have generated the data. A small p-value (e.g., &lt; 0.05) means that the deviance is too large to be due to chance. The model is a poor fit and likely missing something important.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Residual deviance and degrees of freedom</span></span>
<span><span class="va">res_dev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">poisson_model</span><span class="op">)</span></span>
<span><span class="va">df_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/df.residual.html">df.residual</a></span><span class="op">(</span><span class="va">poisson_model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Chi-squared goodness-of-fit test</span></span>
<span><span class="va">p_value</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="va">res_dev</span>, <span class="va">df_res</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Residual Deviance:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">res_dev</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Degrees of Freedom:"</span>, <span class="va">df_res</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Goodness-of-fit p-value:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">p_value</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>res_dev <span class="op">=</span> poisson_model.deviance</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df_res <span class="op">=</span> poisson_model.df_resid</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>p_value <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> stats.chi2.cdf(res_dev, df_res)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Residual Deviance: </span><span class="sc">{</span>res_dev<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Degrees of Freedom: </span><span class="sc">{</span>df_res<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Goodness-of-fit p-value: </span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Residual Deviance: 428.2018 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Degrees of Freedom: 120 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Goodness-of-fit p-value: 0 </code></pre>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Residual Deviance: 428.2018</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Degrees of Freedom: 120</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Goodness-of-fit p-value: 0.0000</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The probability of observing a deviance as large as this if the model is truly correct (i.e., the goodness-of-fit <span class="math inline">\(p\)</span>-value) is esentially 0, saying that there is significant evidence of lack-of-fit. There can be several reasons for lack-of-fit. The model is misspecified, e.g., it is missing important covariates or nonlinear effects. The link function might be incorrect, so that the model is systematically overestimate or underestimate the data. There can be outliers or influential points that inflate the deviance. The data might be overdispersed, so that the residual deviance is inflated by the large variance.</p>
</section><section id="inference" class="level2" data-number="10.8"><h2 data-number="10.8" class="anchored" data-anchor-id="inference">
<span class="header-section-number">10.8</span> Inference</h2>
<p>The estimated model can be used for two purposes: inference and prediction. In terms of inference, we use the fitted model to identify the relationship between the response and regressors. Wald’s test is a general method for hypothesis testing in maximum likelihood estimation (MLE), including generalized linear models (GLMs) like Poisson regression. It tests the hypotheses of the form: <span class="math display">\[
  \begin{align}
    H_0 &amp;: \beta_j = 0, \\
    H_a &amp;: \beta_j \neq 0.
  \end{align}
\]</span> using the fact that <span class="math inline">\(\frac{\hat{\beta}_j}{SE(\hat{\beta}_j)} \sim \mathcal{N}(0,1)\)</span> asymptotically under <span class="math inline">\(H_0\)</span>, where <span class="math inline">\(\beta_j\)</span> is the <span class="math inline">\(j\)</span>th estimated regression coefficient and <span class="math inline">\(SE(\hat{\beta}_j)\)</span> is its corresponding variability which is reflected in the standard error of the estimate. This ratio is the Wald’s test statistic <span class="math display">\[z_j = \frac{\hat{\beta}_j}{SE(\hat{\beta}_j)}\]</span> that is used to determine the statistical significance of <span class="math inline">\(\hat{\beta}_j\)</span> using the fact that the squared statistic asymptotically follows a one-degree-of-freedom chi-squared test, i.e., <span class="math display">\[W_j = \Big(\frac{\hat{\beta}_j}{SE(\hat{\beta}_j)}\Big)^2\sim \chi_1^2.\]</span></p>
<p><em>Remark 1: A statistic like <span class="math inline">\(t_j=\frac{\hat{\beta}_j}{SE(\hat{\beta}_j)}\)</span> in t test is referred to as a <span class="math inline">\(t\)</span>-value. It assumes finite-sample normality—a student’s <span class="math inline">\(t\)</span>-distribution under the null hypothesis with <span class="math inline">\(H_0\)</span> with <span class="math inline">\(n-k-1\)</span> degrees of freedom. It can only be used for linear models with normal errors. While the Wald’s test applies to any MLE (e.g., Poisson or logistic) to be used in any GLMs, and assumes asymptotic normality—standard normal or <span class="math inline">\(\chi^2\)</span> distribution under <span class="math inline">\(H_0\)</span>.</em></p>
<p><em>Remark 2: Wald’s test is validate under several conditions: 1-large sample size, so that the test statistic is asymptotically normal, 2-regularity conditions for MLE, including differentiable likelihood, positive definite Fisher information, correctly specified model and parameter space, 3-well-estimated parameters, i.e., parameters are not near the bounaries, 4-stable and finite standard errors, and 5-no outliers or high leverage points.</em></p>
<p>We can obtain the corresponding <span class="math inline">\(p\)</span>-values for each <span class="math inline">\(\beta_j\)</span> associated to the Wald’s test statistic under the null hypothesis <span class="math inline">\(H_0\)</span>. <strong>The smaller the <span class="math inline">\(p\)</span>-value, the stronger the evidence against the null hypothesis <span class="math inline">\(H_0\)</span> in our sample.</strong> Hence, small <span class="math inline">\(p\)</span>-values (less than the significance level <span class="math inline">\(\alpha\)</span>) indicate that the data provides evidence in favour of association (or <strong>causation</strong> if that is the case) between the response variable and the <span class="math inline">\(j\)</span>th regressor.</p>
<p>Similarly, given a specified <span class="math inline">\((1-\alpha)\times 100%\)</span> level of confidence, we can construct <strong>confidence intervals</strong> for the corresponding true value of <span class="math inline">\(\beta_j\)</span>: <span class="math display">\[\hat{\beta}_j \pm t_{\alpha/2,n-k-1} SE(\hat{\beta}_j),\]</span> where <span class="math inline">\(t_{\alpha/2,n-k-1}\)</span> is the upper <span class="math inline">\(\alpha/2\)</span> quantile of the <span class="math inline">\(t\)</span>-distribution with <span class="math inline">\(n-k-1\)</span> degrees of freedom.</p>
<p>Let’s now compute the 95% confidence interval.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tidy</span><span class="op">(</span><span class="va">poisson_model</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate_if</span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">round</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get coefficient table</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>summary_df <span class="op">=</span> poisson_model.summary2().tables[<span class="dv">1</span>]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confidence intervals</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>conf_int <span class="op">=</span> poisson_model.conf_int()</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>conf_int.columns <span class="op">=</span> [<span class="st">'conf_low'</span>, <span class="st">'conf_high'</span>]</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine with coefficient table</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>summary_df <span class="op">=</span> summary_df.join(conf_int)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Round all numeric columns to 3 decimals</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>summary_df <span class="op">=</span> summary_df.<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summary_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term        estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)    -3.43     0.647     -5.3        0   -4.70     -2.16 
2 width           0.17     0.024      7.11       0    0.123     0.216</code></pre>
</div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>           Coef.  Std.Err.      z  P&gt;|z|  [0.025  0.975]  conf_low  conf_high
Intercept  -3.43     0.647 -5.300    0.0  -4.699  -2.162    -4.699     -2.162
width       0.17     0.024  7.112    0.0   0.123   0.216     0.123      0.216</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Our sample gives us evidence to reject <span class="math inline">\(H_0\)</span> (with a nearly-zero <span class="math inline">\(p\)</span> value), which suggests that carapace width is statistically associated to the logarithm of the satellite size. Now, it is time to plot the fitted values coming from poisson_model to check whether it provides a positive relationship between <code>width</code> and the original scale of the response <code>satell</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">train_set</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">width</span>, <span class="va">satell</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"glm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>,</span>
<span>    method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span>, se <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Poisson Regression Fitted Curve"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the fitted values</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>width_range <span class="op">=</span> np.linspace(train_set[<span class="st">'width'</span>].<span class="bu">min</span>(), train_set[<span class="st">'width'</span>].<span class="bu">max</span>(), <span class="dv">100</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>predict_df <span class="op">=</span> pd.DataFrame({<span class="st">'width'</span>: width_range})</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>predict_df[<span class="st">'predicted'</span>] <span class="op">=</span> poisson_model.predict(predict_df)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw the scatterplot</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>train_set, x<span class="op">=</span><span class="st">'width'</span>, y<span class="op">=</span><span class="st">'satell'</span>, label<span class="op">=</span><span class="st">'Observed'</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the Poisson regression line</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>predict_df, x<span class="op">=</span><span class="st">'width'</span>, y<span class="op">=</span><span class="st">'predicted'</span>, color<span class="op">=</span><span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Poisson fit'</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Poisson Regression Fitted Curve'</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Width'</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Satellite size'</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>The blue line in the plot above is the fitted Poisson regression of <code>satell</code> versus <code>width</code>. The positive relationship is now clear with this regression line.</p>
</section><section id="results" class="level2" data-number="10.9"><h2 data-number="10.9" class="anchored" data-anchor-id="results">
<span class="header-section-number">10.9</span> Results</h2>
<p>Let us fit a second model with two regressors: <code>width</code> (<span class="math inline">\(X_{\mathrm{width}_i}\)</span>) and <code>color</code> (<span class="math inline">\(X_{\mathrm{color_2}_i}\)</span>, <span class="math inline">\(X_{\mathrm{color_3}_i}\)</span>, <span class="math inline">\(X_{\mathrm{color_4}_i}\)</span>) for the <span class="math inline">\(i\)</span>th observation: <span class="math display">\[
  h(\lambda_i) = \log(\lambda_i) = \beta_0 + \beta_1 X_{\mathrm{width}_i} + \beta_2 X_{\mathrm{color_2}_i} + \beta_3 X_{\mathrm{color_3}_i} + \beta_4 X_{\mathrm{color_4}_i}.
\]</span> The explanatory variable <code>color</code> is of <strong>factor-type (discrete)</strong> and <strong>nominal</strong> (its levels do not follow any specific order). There are four levels: <code>1 = medium light</code>, <code>2 = medium</code>, <code>3 = medium dark</code>, <code>4 = dark</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Factorize the variable</span></span>
<span><span class="va">train_set</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">train_set</span><span class="op">$</span><span class="va">color</span><span class="op">)</span></span>
<span><span class="co"># Print color categories</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">train_set</span><span class="op">$</span><span class="va">color</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-19-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Factorize the variable</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>train_set[<span class="st">'color'</span>] <span class="op">=</span> train_set[<span class="st">'color'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Print color categories</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>train_set[<span class="st">'color'</span>].cat.categories</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1" "2" "3" "4"</code></pre>
</div>
</div>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Index([1, 2, 3, 4], dtype='int64')</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Using categorical variables such as <code>color</code> involves using <strong>dummy variables</strong> as in Binary Logistic regression. Taking the baseline <code>1 = medium light</code> by default, this Poisson regression model will incorporate three dummy variables: <span class="math inline">\(X_{\mathrm{color_2}_i}\)</span>, <span class="math inline">\(X_{\mathrm{color_3}_i}\)</span>, and <span class="math inline">\(X_{\mathrm{color_4}_i}\)</span>. For different levels of <code>color</code>, these dummy variables take on the following values:</p>
<ul>
<li>When <code>color</code> is <code>1 = medium light</code>, then all three dummy variables <span class="math inline">\(X_{\mathrm{color_2}_i} = X_{\mathrm{color_3}_i} = X_{\mathrm{color_4}_i}=0\)</span>.</li>
<li>When <code>color</code> is <code>2 = medium</code>, then <span class="math inline">\(X_{\mathrm{color_2}_i}=1\)</span> while the other two dummy variables <span class="math inline">\(X_{\mathrm{color_3}_i} = X_{\mathrm{color_4}_i}=0\)</span>.</li>
<li>When <code>color</code> is <code>3 = medium dark</code>, then <span class="math inline">\(X_{\mathrm{color_3}_i}=1\)</span> while the other two dummy variables <span class="math inline">\(X_{\mathrm{color_2}_i} = X_{\mathrm{color_4}_i}=0\)</span>.</li>
<li>When <code>color</code> is <code>4 = dark</code>, then <span class="math inline">\(X_{\mathrm{color_4}_i}=1\)</span> while the other two dummy variables <span class="math inline">\(X_{\mathrm{color_2}_i} = X_{\mathrm{color_3}_i}=0\)</span>.</li>
</ul>
<p>Note that the level <code>1 = medium light</code> is depicted as the baseline here. Hence, the interpretation of the coefficients in the model for each dummy variable will be compared to this baseline.</p>
<p>Now, let us fit this second Poisson regression model and print the model summary including coefficient estimates, standard errors, Wald’s test statistic (<span class="math inline">\(z\)</span>-test), the corresponding <span class="math inline">\(p\)</span>-value, and 95% confidence intervals.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-21-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit the Poisson model</span></span>
<span><span class="va">poisson_model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">satell</span> <span class="op">~</span> <span class="va">width</span> <span class="op">+</span> <span class="va">color</span>, family <span class="op">=</span> <span class="va">poisson</span>, data <span class="op">=</span> <span class="va">train_set</span><span class="op">)</span></span>
<span><span class="co"># Summarise the model output</span></span>
<span><span class="va">summary_df</span> <span class="op">&lt;-</span> <span class="fu">tidy</span><span class="op">(</span><span class="va">poisson_model2</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate_if</span><span class="op">(</span><span class="va">is.numeric</span>, <span class="va">round</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># Display the output in table</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">summary_df</span>, <span class="st">"pipe"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-21-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the Poisson regression model</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>poisson_model2 <span class="op">=</span> glm(formula<span class="op">=</span><span class="st">'satell ~ width + color'</span>, data<span class="op">=</span>train_set, family<span class="op">=</span>sm.families.Poisson()).fit()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the summary table</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>summary_df <span class="op">=</span> poisson_model2.summary2().tables[<span class="dv">1</span>]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the table</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summary_df.<span class="bu">round</span>(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-2" role="tab" aria-controls="tabset-22-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-22-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 14%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">conf.low</th>
<th style="text-align: right;">conf.high</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-2.915</td>
<td style="text-align: right;">0.687</td>
<td style="text-align: right;">-4.244</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">-4.257</td>
<td style="text-align: right;">-1.564</td>
</tr>
<tr class="even">
<td style="text-align: left;">width</td>
<td style="text-align: right;">0.161</td>
<td style="text-align: right;">0.025</td>
<td style="text-align: right;">6.495</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.112</td>
<td style="text-align: right;">0.209</td>
</tr>
<tr class="odd">
<td style="text-align: left;">color2</td>
<td style="text-align: right;">-0.224</td>
<td style="text-align: right;">0.180</td>
<td style="text-align: right;">-1.244</td>
<td style="text-align: right;">0.213</td>
<td style="text-align: right;">-0.562</td>
<td style="text-align: right;">0.145</td>
</tr>
<tr class="even">
<td style="text-align: left;">color3</td>
<td style="text-align: right;">-0.458</td>
<td style="text-align: right;">0.212</td>
<td style="text-align: right;">-2.160</td>
<td style="text-align: right;">0.031</td>
<td style="text-align: right;">-0.867</td>
<td style="text-align: right;">-0.034</td>
</tr>
<tr class="odd">
<td style="text-align: left;">color4</td>
<td style="text-align: right;">-0.410</td>
<td style="text-align: right;">0.231</td>
<td style="text-align: right;">-1.773</td>
<td style="text-align: right;">0.076</td>
<td style="text-align: right;">-0.862</td>
<td style="text-align: right;">0.047</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="tabset-22-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>            Coef.  Std.Err.      z  P&gt;|z|  [0.025  0.975]
Intercept  -2.915     0.687 -4.244  0.000  -4.261  -1.568
color[T.2] -0.224     0.180 -1.244  0.213  -0.576   0.129
color[T.3] -0.458     0.212 -2.160  0.031  -0.873  -0.042
color[T.4] -0.410     0.231 -1.773  0.076  -0.862   0.043
width       0.161     0.025  6.495  0.000   0.112   0.209</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>We can see that <code>width</code> and <code>color3</code> are significant according to the <span class="math inline">\(p\)</span>-value column under the significance level <span class="math inline">\(\alpha=0.05\)</span>.</p>
<section id="interpreting-the-results-of-a-continuous-variable" class="level3" data-number="10.9.1"><h3 data-number="10.9.1" class="anchored" data-anchor-id="interpreting-the-results-of-a-continuous-variable">
<span class="header-section-number">10.9.1</span> Interpreting the results of a continuous variable</h3>
<p>First, let us focus on the coefficient corresponding to <code>width</code>, <strong>while keeping <code>color</code> constant</strong>. Consider an observation with a given shell width <span class="math inline">\(X_{\mathrm{width}}=\texttt{w}\)</span> cm, and another observation with a given <span class="math inline">\(X_{\mathrm{width+1}}=\texttt{w}+1\)</span> cm (i.e., an increase of <span class="math inline">\(1\)</span> cm). Denote the corresponding expected satell sizes as <span class="math inline">\(\lambda_{\mathrm{width}}\)</span> and <span class="math inline">\(\lambda_{\mathrm{width+1}}\)</span> respectively. Then we have their corresponding regression equations:</p>
<p><span class="math display">\[
\begin{align}
  \log \left( \lambda_{\mathrm{width}} \right) &amp;= \beta_0 + \beta_1 \overbrace{\texttt{w}}^{X_{\mathrm{width}}} + \overbrace{\beta_2 X_{\mathrm{color_2}} + \beta_3 X_{\mathrm{color_3}} + \beta_4 X_{\mathrm{color_4}}}^{\mathrm{Constant}} \\
  \log \left( \lambda_{\mathrm{width + 1}} \right) &amp;= \beta_0 + \beta_1 \underbrace{(\texttt{w} + 1)}_{X_{\mathrm{width + 1}}} + \underbrace{\beta_2 X_{\mathrm{color_2}} + \beta_3 X_{\mathrm{color_3}} + \beta_4 X_{\mathrm{color_4}}}_{\mathrm{Constant}}.
\end{align}
\]</span></p>
<p>We take the difference between both equations as: <span class="math display">\[
\begin{align}
\log \left( \lambda_{\mathrm{width + 1}} \right) - \log \left( \lambda_{\mathrm{width}} \right) &amp;= \beta_1 (\texttt{w} + 1) - \beta_1 \texttt{w} \\
&amp;= \beta_1.
\end{align}
\]</span></p>
<p>We apply the logarithm property for a ratio: <span class="math display">\[
\begin{align*}
\log \left( \frac{\lambda_{\mathrm{width + 1}} }{\lambda_{\mathrm{width}}} \right) &amp;= \log \left( \lambda_{\mathrm{width + 1}} \right) - \log \left( \lambda_{\mathrm{width}} \right) \\
&amp;= \beta_1.
\end{align*}
\]</span></p>
<p>Finally, we have to exponentiate the previous equation: <span class="math display">\[\frac{\lambda_{\mathrm{width+1}}}{\lambda_{\mathrm{width}}} = e^{\beta_1},\]</span> which indicates that the satellite size varies in a <strong>multiplicative way</strong> when 1 cm is increased in satellite width.</p>
<p>Therefore, by using the estimate <span class="math inline">\(\hat{\beta_1}\)</span> (note the hat notation) coming from the model <code>poisson_model2</code>, we calculate this multiplicative effect as follows (via <code>exponentiate = TRUE</code> in <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code>):</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-23-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<div class="sourceCode" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>summary_exp_df <span class="ot">&lt;-</span> <span class="fu">tidy</span>(poisson_model2, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">%&gt;%</span> <span class="fu">mutate_if</span>(is.numeric, round, <span class="dv">3</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(summary_exp_df, <span class="st">"pipe"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-23-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>summary_exp_df <span class="op">=</span> summary_df.copy()</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>summary_exp_df[<span class="st">'Coef.'</span>] <span class="op">=</span> np.exp(summary_df[<span class="st">'Coef.'</span>])</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>summary_exp_df[<span class="st">'[0.025'</span>] <span class="op">=</span> np.exp(summary_df[<span class="st">'[0.025'</span>])</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>summary_exp_df[<span class="st">'0.975]'</span>] <span class="op">=</span> np.exp(summary_df[<span class="st">'0.975]'</span>])</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>summary_exp_df <span class="op">=</span> summary_exp_df.<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summary_exp_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-24-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-1" role="tab" aria-controls="tabset-24-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-2" role="tab" aria-controls="tabset-24-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-24-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-24-1-tab">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 14%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">conf.low</th>
<th style="text-align: right;">conf.high</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.054</td>
<td style="text-align: right;">0.687</td>
<td style="text-align: right;">-4.244</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">0.209</td>
</tr>
<tr class="even">
<td style="text-align: left;">width</td>
<td style="text-align: right;">1.174</td>
<td style="text-align: right;">0.025</td>
<td style="text-align: right;">6.495</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">1.118</td>
<td style="text-align: right;">1.232</td>
</tr>
<tr class="odd">
<td style="text-align: left;">color2</td>
<td style="text-align: right;">0.800</td>
<td style="text-align: right;">0.180</td>
<td style="text-align: right;">-1.244</td>
<td style="text-align: right;">0.213</td>
<td style="text-align: right;">0.570</td>
<td style="text-align: right;">1.156</td>
</tr>
<tr class="even">
<td style="text-align: left;">color3</td>
<td style="text-align: right;">0.633</td>
<td style="text-align: right;">0.212</td>
<td style="text-align: right;">-2.160</td>
<td style="text-align: right;">0.031</td>
<td style="text-align: right;">0.420</td>
<td style="text-align: right;">0.967</td>
</tr>
<tr class="odd">
<td style="text-align: left;">color4</td>
<td style="text-align: right;">0.664</td>
<td style="text-align: right;">0.231</td>
<td style="text-align: right;">-1.773</td>
<td style="text-align: right;">0.076</td>
<td style="text-align: right;">0.422</td>
<td style="text-align: right;">1.048</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="tabset-24-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-24-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>            Coef.  Std.Err.      z  P&gt;|z|  [0.025  0.975]
Intercept   0.054     0.687 -4.244  0.000   0.014   0.208
color[T.2]  0.800     0.180 -1.244  0.213   0.562   1.137
color[T.3]  0.633     0.212 -2.160  0.031   0.418   0.958
color[T.4]  0.664     0.231 -1.773  0.076   0.422   1.044
width       1.174     0.025  6.495  0.000   1.119   1.232</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><span class="math inline">\(\frac{\hat{\lambda}_{\mathrm{width + 1}} }{\hat{\lambda}_{\mathrm{width}}} = e^{\hat{\beta}_1} = 1.174\)</span> indicates that <strong>the averaged satellite size (<code>satell</code>) of male horseshoe crabs around a female breeding nest</strong> increases by <span class="math inline">\(17.4\%\)</span> when increasing the crab <code>width</code> by <span class="math inline">\(1\)</span> cm, <strong>while keeping <code>color</code> constant</strong>. The interpretation of the significant coefficients corresponding to difference between the <code>color</code> groups and the baseline level.</p>
</section><section id="interpreting-the-results-of-a-categorical-variable" class="level3" data-number="10.9.2"><h3 data-number="10.9.2" class="anchored" data-anchor-id="interpreting-the-results-of-a-categorical-variable">
<span class="header-section-number">10.9.2</span> Interpreting the results of a categorical variable</h3>
<p>Consider two observations, one with color <code>1 = medium light</code> of the prosoma (the baseline) and another with <code>4 = dark</code>. Their corresponding responses are denoted as <span class="math inline">\(\lambda_{\mathrm{D}}\)</span> (for <code>dark</code>) and <span class="math inline">\(\lambda_{\mathrm{L}}\)</span> (for <code>medium light</code>). While holding <span class="math inline">\(X_{\mathrm{width}}\)</span> constant, their regression equations are: <span class="math display">\[
\begin{gather*}
\log \left( \lambda_{\mathrm{D}} \right) = \beta_0 + \overbrace{\beta_1 X_{\mathrm{width}}}^{\text{Constant}} + \beta_2 X_{\mathrm{color_2}_{\mathrm{D}}} + \beta_3 X_{\mathrm{color_3}_{\mathrm{D}}} + \beta_4 X_{\mathrm{color_4}_{\mathrm{D}}} \\
\log \left( \lambda_{\mathrm{L}} \right) = \beta_0 + \underbrace{\beta_1 X_{\mathrm{width}}}_{\text{Constant}} + \beta_2 X_{\mathrm{color_2}_{\mathrm{L}}} + \beta_3 X_{\mathrm{color_3}_{\mathrm{L}}} + \beta_4 X_{\mathrm{color_4}_{\mathrm{L}}}
\end{gather*}
\]</span></p>
<p>The corresponding <code>color</code> indicator variables for both <span class="math inline">\(\lambda_{\mathrm{D}}\)</span> and <span class="math inline">\(\lambda_{\mathrm{L}}\)</span> take on these values: <span class="math display">\[
\begin{align*}
\log \left( \lambda_{\mathrm{D}} \right) &amp;= \beta_0 + \overbrace{\beta_1 X_{\mathrm{width}}}^{\text{Constant}} + \beta_2 X_{\mathrm{color_2}_{\mathrm{D}}} + \beta_3 X_{\mathrm{color_3}_{\mathrm{D}}} + \beta_4 X_{\mathrm{color_4}_{\mathrm{D}}} \\
&amp;= \beta_0 + \beta_1 X_{\mathrm{width}}+ \beta_2 \times 0 + \beta_3 \times 0 + \beta_4 \times 1 \\
&amp;= \beta_0 + \beta_1 X_{\mathrm{width}} + \beta_4, \\
\log \left( \lambda_{\mathrm{L}} \right) &amp;= \beta_0 + \beta_1 X_{\mathrm{width}} + \beta_2 X_{\mathrm{color_2}_{\mathrm{L}}} + \beta_3 X_{\mathrm{color_3}_{\mathrm{L}}} + \beta_4 X_{\mathrm{color_4}_{\mathrm{L}}} \\
&amp;= \beta_0 + \beta_1 X_{\mathrm{width}}+ \beta_2 \times 0 + \beta_3 \times 0 + \beta_4 \times 0 \\
&amp;= \beta_0 + \underbrace{\beta_1 X_{\mathrm{width}}}_{\text{Constant}}.
\end{align*}
\]</span></p>
<p>Therefore, <strong>what is the association of the level <code>medium light</code> with respect to <code>dark</code>?</strong> Let us take the differences again: <span class="math display">\[
\begin{align*}
\log \left( \frac{\lambda_{\mathrm{D}} }{\lambda_{\mathrm{L}}} \right) &amp;= \log \left( \lambda_{\mathrm{D}} \right) - \log \left( \lambda_{\mathrm{L}} \right) \\
&amp;= \beta_4.
\end{align*}
\]</span></p>
<p>Then, we exponentiate the previous equation:</p>
<p><span class="math display">\[
\frac{\lambda_{\mathrm{D}} }{\lambda_{\mathrm{L}}} = e^{\beta_4}.
\]</span></p>
<p>The expression <span class="math inline">\(\frac{\lambda_{\mathrm{D}} }{\lambda_{\mathrm{L}}} = e^{\beta_4}\)</span> indicates that the response varies in a <strong>multiplicative way</strong> when the <code>color</code> of the prosoma changes from <code>medium light</code> to <code>dark</code>.</p>
<p><span class="math inline">\(\frac{\hat{\lambda}_{\mathrm{D}} }{\hat{\lambda}_{\mathrm{L}}} = e^{\hat{\beta}_4} = 0.66\)</span> indicates that <strong>the mean satellite size (<code>satell</code>) of male horseshoe crabs around a female breeding nest</strong> decreases by <span class="math inline">\(34\%\)</span> when the <code>color</code> of the prosoma changes from <code>medium light</code> to <code>dark</code>, <strong>while keeping the carapace <code>width</code> constant</strong>.</p>
</section><section id="prediction-using-test-data" class="level3" data-number="10.9.3"><h3 data-number="10.9.3" class="anchored" data-anchor-id="prediction-using-test-data">
<span class="header-section-number">10.9.3</span> Prediction using test data</h3>
<p>Let us now predict on the test set. Besides the residual deviance discussed in <a href="#goodness">Goodness of fit</a>, the model performance can also be measured by Kullback-Leibler (KL) divergence, which is defined as <span class="math display">\[
D_{\mathrm{KL}}(\hat{y_i} \Vert \hat{\lambda}_i) = y_i \log\left(\frac{\hat{y_i}}{\hat{\lambda}_i} \right) - y_i + \hat{\lambda}_i.
\]</span> Kullback–Leibler (KL) divergence is a measure of how one probability distribution diverges from a reference distribution. In the context of Poisson regression, KL divergence quantifies how much the predicted Poisson distribution diverges from the true observed data.</p>
<p>Averaging <span class="math inline">\(\overline{D}_{\mathrm{KL}}(\hat{y}\Vert \hat{\lambda}) = \frac{1}{n} \sum_{i=1}^n D_{\mathrm{KL}}(\hat{y_i} \Vert \hat{\lambda}_i)\)</span> across all observations gives a measure of how well the model captures the true data distribution. Smaller averaged KL values indicate better fit.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-25-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-1" role="tab" aria-controls="tabset-25-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-2" role="tab" aria-controls="tabset-25-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-25-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-25-1-tab">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Factorize `color` in test set</span></span>
<span><span class="va">test_set</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">test_set</span><span class="op">$</span><span class="va">color</span><span class="op">)</span></span>
<span><span class="co"># Predict</span></span>
<span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">poisson_model2</span>, newdata <span class="op">=</span> <span class="va">test_set</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">actuals</span> <span class="op">&lt;-</span> <span class="va">test_set</span><span class="op">$</span><span class="va">satell</span></span>
<span><span class="co"># KL divergence</span></span>
<span><span class="va">kf</span> <span class="op">=</span> <span class="fl">1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"KL divergence:"</span>, <span class="va">kf</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-25-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-25-2-tab">
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Factorize `color` in test set</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>test_set[<span class="st">'color'</span>] <span class="op">=</span> test_set[<span class="st">'color'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> poisson_model2.predict(test_set)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>actuals <span class="op">=</span> test_set[<span class="st">'satell'</span>]</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># KL divergence</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"KF divergence: </span><span class="sc">{</span>kf<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-26-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-1" role="tab" aria-controls="tabset-26-1" aria-selected="true">R Output</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-26-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-2" role="tab" aria-controls="tabset-26-2" aria-selected="false">Python Output</a></li>
</ul>
<div class="tab-content">
<div id="tabset-26-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-26-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>KL divergence: 1 </code></pre>
</div>
</div>
</div>
<div id="tabset-26-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-26-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>KL divergence: 1.0000</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Poisson residual deviance equals 2 times the KL divergence of Poisson distribution summed across all points. It measures the difference in log-likelihood between a saturated model (perfect fit) and the fitted model as defined in <a href="#goodness">Goodness of fit</a>. Lower deviance values indicate the model predictions are closer to the observed data.</p>
</section></section><section id="storytelling" class="level2" data-number="10.10"><h2 data-number="10.10" class="anchored" data-anchor-id="storytelling">
<span class="header-section-number">10.10</span> Storytelling</h2>
<p>The data case explores the relationship between satellite size, i.e., the number of male horseshoe crabs around the female horseshoe breeding nests, and several phenotypic characteristis of the female horseshoe crabs. The graphical display suggests that there is a dependence between satellite sizes and female horseshoe crab widths. The Poisson regression modelling suggests that widths is significantely related to satellite size and the dark color is significantly different to the medium light color of the female horseshoe size, given constant confoudning variables at the 5% significance level.</p>
</section><section id="practice-problems" class="level2" data-number="10.11"><h2 data-number="10.11" class="anchored" data-anchor-id="practice-problems">
<span class="header-section-number">10.11</span> Practice Problems</h2>
<p>In this final section, you can test your understanding with the following conceptual interactive exercises, and then proceed to work through an inferential analysis of a simple dataset.</p>
<div class="quiz">
<section id="conceptual-questions" class="level3" data-number="10.11.1"><h3 data-number="10.11.1" class="anchored" data-anchor-id="conceptual-questions">
<span class="header-section-number">10.11.1</span> Conceptual Questions</h3>
<ol type="1">
<li>What makes Poisson regression appropriate for modelling the number of satellites per crab?</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary>
The response variable (number of satellites) is a non-negative integer, shows right skewness, and represents event counts for a fixed unit (one crab), all of which make Poisson regression appropriate.
</details><ol start="2" type="1">
<li>What is the key assumption made about the distribution of the response by a classical Poisson regression model?</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary>
Equidispersion: The conditional distribution of the <em>response given the covariates</em> follows a Poisson distribution with mean equal to variance.
</details><ol start="3" type="1">
<li>Why do we use the log function in Poisson regression?</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary>
The log function (technically the log link) ensures that the predicted mean of the response variable is always positive, which is necessary since counts cannot be negative.
</details><ol start="4" type="1">
<li>In the univariate model, what does a positive coefficient on carapace width mean?</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary>
Larger female crabs are expected to attract more satellite males, <em>holding all other variables constant</em>.
</details><ol start="5" type="1">
<li>What can the incidence rate ratio (IRR) tell us in the context of carapace width for this dataset?</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary>
The IRR indicates the multiplicative change in the expected number of satellites for each one-unit increase in carapace width, <em>holding other variables constant</em>.
</details><ol start="6" type="1">
<li>In this chapter, why did we use binning (with grouped means) before fitting to a Poisson model?</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary>
Binning helps to visualize the relationship between carapace width and satellite size, by highlighting trends in the mean response of the data, to assess whether a log-linear trend is plausible.
</details><ol start="7" type="1">
<li>What does residual deviance measure in a Poisson regression model?</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary>
How far the fitted model is from the saturated model (perfect fit) – lower values indicate a better fit.
</details><ol start="8" type="1">
<li>How do we assess the goodness-of-fit of a Poisson regression model?</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary>
Use the residual deviance, and its associated p-value from a chi-squared test to assess goodness-of-fit: A high p-value indicates a good fit, while a low p-value indicates a lack-of-fit.
</details><ol start="9" type="1">
<li>What does overdispersion mean? Why is it a problem for Poisson regression?</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary>
Overdispersion occurs when the variance of the response variable exceeds its mean. This violates the equidispersion assumption, which can lead to underestimated standard errors and overstated significance of predictors.
</details><ol start="10" type="1">
<li>How can we diagnoze overdispersion in the horseshoe crab dataset?</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary>
We can compare the residual deviance to the degrees of freedom. If the ratio is significantly greater than 1, this indicates overdispersion.
</details><ol start="11" type="1">
<li>Why are categorical predictors, such as color, included as indicator variables in Poisson regression?</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary>
They allow the model to estimate separate effects for each category relative to a baseline category, which allows for the analysis of how different levels of the categorical variable influence the response.
</details><ol start="12" type="1">
<li>Why do we interpret on the response scale (exponentiated coefficients) rather than the log scale in Poisson regression?</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary>
This is simply more intuitive, as it tells us the multiplicative effect on the expected count of the response variable for a one-unit change in the predictor.
</details><ol start="13" type="1">
<li>How do we interpret the coefficient for a categorical variable in Poisson regression?</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary>
The coefficient (exponentiated!) represents the change in the expected count of the response variable when moving from the baseline category to the category represented by the coefficient (holding other variables constant).
</details></section><section id="coding-question" class="level3" data-number="10.11.2"><h3 data-number="10.11.2" class="anchored" data-anchor-id="coding-question">
<span class="header-section-number">10.11.2</span> Coding Question</h3>
</section><section id="problem-1" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="problem-1">Problem 1</h3>
<p>In this problem, you are given a set of 700 individuals with different demographic and socioeconomic characteristics, along with their reported number of annual doctor visits. Your task will be to perform a full poisson regression analysis following a similar structure to this chapter. The variables involved are:</p>
<table class="caption-top table">
<thead><tr class="header">
<th><strong>Variable Name</strong></th>
<th><strong>Description</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>doctor_visits</strong></td>
<td>The number of visits in the past year (0-20+)</td>
</tr>
<tr class="even">
<td><strong>age</strong></td>
<td>Age in years</td>
</tr>
<tr class="odd">
<td><strong>income</strong></td>
<td>Annual income in USD</td>
</tr>
<tr class="even">
<td><strong>education_years</strong></td>
<td>Total years of education</td>
</tr>
<tr class="odd">
<td><strong>married</strong></td>
<td>Married or not (0 or 1)</td>
</tr>
<tr class="even">
<td><strong>urban</strong></td>
<td>Urban residence or not (0 or 1)</td>
</tr>
<tr class="odd">
<td><strong>insurance</strong></td>
<td>Health insurance or not (0 or 1)</td>
</tr>
</tbody>
</table>
<p>By the end of these questions, you will be able to describe how age, insurance and socioeconomic factors affect the number of doctor visits individuals need. You will determine whether the Poisson model is appropriate, and which predictors matter most in answering this problem.</p>
</section><section id="a.-data-wrangling-and-exploratory-data-analysis" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="a.-data-wrangling-and-exploratory-data-analysis">A. Data Wrangling and Exploratory Data Analysis</h3>
<p>Let us check if <code>doctor_visists</code> meets the assumptions for a classical Poisson model:</p>
<ol type="1">
<li><p>Check if it is a non-negative integer.</p></li>
<li><p>Examine its distribution, computing the mean and variance.</p></li>
<li><p>Is equidispersion (Var <span class="math inline">\(\approx\)</span> Mean) plausible here?</p></li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary><div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-27-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-1" role="tab" aria-controls="tabset-27-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-2" role="tab" aria-controls="tabset-27-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-27-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-27-1-tab">
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ forcats   1.0.1     ✔ purrr     1.1.0
✔ lubridate 1.9.4     ✔ stringr   1.5.2
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ broom::bootstrap()   masks asbio::bootstrap()
✖ gridExtra::combine() masks dplyr::combine()
✖ magrittr::extract()  masks tidyr::extract()
✖ dplyr::filter()      masks stats::filter()
✖ dplyr::lag()         masks stats::lag()
✖ lubridate::pm()      masks asbio::pm()
✖ purrr::set_names()   masks magrittr::set_names()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'

The following object is masked _by_ '.GlobalEnv':

    crabs

The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://zoo.R-Forge.R-project.org/">zoo</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'

The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://florianhartig.github.io/DHARMa/">DHARMa</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>This is DHARMa 0.4.7. For overview type '?DHARMa'. For recent changes, type news(package = 'DHARMa')</code></pre>
</div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">select</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span></span>
<span></span>
<span><span class="co">## setwd("/home/michael/coding/stats-textbook/regression-cookbook") </span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"./data/poisson_regression.rda"</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">poisson_regression</span>  </span>
<span></span>
<span><span class="co"># Convert to categorical </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    married   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">married</span><span class="op">)</span>,</span>
<span>    urban     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">urban</span><span class="op">)</span>,</span>
<span>    insurance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">insurance</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">############################################################</span></span>
<span><span class="co"># A. Poisson Regression Assumptions</span></span>
<span><span class="co">############################################################</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">doctor_visits</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    3.00    5.00    5.13    7.00   21.00 </code></pre>
</div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mean_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">doctor_visits</span><span class="op">)</span></span>
<span><span class="va">var_val</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">doctor_visits</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">mean_val</span>, variance <span class="op">=</span> <span class="va">var_val</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mean variance 
5.130000 9.624725 </code></pre>
</div>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">doctor_visits</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  20  21 
 18  59 108 155 140 151  93  84  62  43  28  23  11  10   1   3   5   3   2   1 </code></pre>
</div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Mean ="</span>, <span class="va">mean_val</span>, <span class="st">"Variance ="</span>, <span class="va">var_val</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean = 5.13 Variance = 9.624725 </code></pre>
</div>
</div>
</div>
<div id="tabset-27-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-27-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Imports</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyreadr</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> chi2</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"whitegrid"</span>)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data (RDA)</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> pyreadr.read_r(<span class="st">"./data/poisson_regression.rda"</span>)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> result[<span class="st">"poisson_regression"</span>]</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert categorical variables</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"married"</span>, <span class="st">"urban"</span>, <span class="st">"insurance"</span>]:</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    df[col] <span class="op">=</span> df[col].astype(<span class="st">"category"</span>)</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a><span class="co"># A. Poisson Regression Assumptions</span></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">"doctor_visits"</span>].describe())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>count    1000.000000
mean        5.130000
std         3.102374
min         0.000000
25%         3.000000
50%         5.000000
75%         7.000000
max        21.000000
Name: doctor_visits, dtype: float64</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>mean_val <span class="op">=</span> df[<span class="st">"doctor_visits"</span>].mean()</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>var_val  <span class="op">=</span> df[<span class="st">"doctor_visits"</span>].var()</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>({<span class="st">"mean"</span>: mean_val, <span class="st">"variance"</span>: var_val})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'mean': np.float64(5.13), 'variance': np.float64(9.624724724724727)}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">"doctor_visits"</span>].value_counts().sort_index())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>doctor_visits
0.0      18
1.0      59
2.0     108
3.0     155
4.0     140
5.0     151
6.0      93
7.0      84
8.0      62
9.0      43
10.0     28
11.0     23
12.0     11
13.0     10
14.0      1
15.0      3
16.0      5
17.0      3
20.0      2
21.0      1
Name: count, dtype: int64</code></pre>
</div>
</div>
</div>
</div>
</div>
We see that the distribution is right-skewed, with many small counts and a few larger values; the sample mean and variance are of similar magnitude, suggesting that equidispersion is plausible here.
</details></section><section id="b.-a-graphical-look" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="b.-a-graphical-look">B. A Graphical Look</h3>
<ol type="1">
<li><p>Create a scatterplot of <code>doctor_visits</code> vs <code>age</code>, adding an offset to the points with jitter for visibility.</p></li>
<li><p>Comment on the (1) skewness, (2) heteroskedasticity and (3) whether the variability increases with the mean, relating this to your observation in question A3.</p></li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary><div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-28-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-1" role="tab" aria-controls="tabset-28-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-28-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-2" role="tab" aria-controls="tabset-28-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-28-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-28-1-tab">
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">############################################################</span></span>
<span><span class="co"># B. A Graphical Look</span></span>
<span><span class="co">############################################################</span></span>
<span></span>
<span><span class="co"># Jitter scatter with marginal histograms</span></span>
<span><span class="va">p_scatter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">doctor_visits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, width <span class="op">=</span> <span class="fl">0.2</span>, height <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Doctor Visits vs Age"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_hist_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">p_hist_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">doctor_visits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p_scatter</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p_hist_x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p_hist_y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-31-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-28-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-28-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co"># B. A Graphical Look</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>plt.scatter(df[<span class="st">"age"</span>], df[<span class="st">"doctor_visits"</span>], alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Age"</span>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Doctor Visits"</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Doctor Visits vs Age"</span>)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>plt.hist(df[<span class="st">"age"</span>], bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Age Distribution"</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>plt.hist(df[<span class="st">"doctor_visits"</span>], bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Doctor Visits Distribution"</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-32-3.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>

<p>The distribution of <code>doctor_visits</code> is right-skewed, the spread increases with age, and the variability appears larger at higher mean values. This is consistent with the Poisson mean–variance relationship noted in A3.</p>
</div>
</div>
</div>
</details></section><section id="c.-data-wrangling" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="c.-data-wrangling">C. Data Wrangling</h3>
<p>Now, prepare the data for modelling:</p>
<ol type="1">
<li><p>Convert all appropriate variables to factors. Report the number of levels in each factor to verify this is working.</p></li>
<li><p>Drop any missing observations.</p></li>
<li><p>Produce a summary table of all variables.</p></li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary><div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-29-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-1" role="tab" aria-controls="tabset-29-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-29-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-2" role="tab" aria-controls="tabset-29-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-29-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-29-1-tab">
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">############################################################</span></span>
<span><span class="co"># C. Data Wrangling</span></span>
<span><span class="co">############################################################</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      age            income      education_years urban   married insurance
 Min.   : 2.70   Min.   :-7021   Min.   :10.00   0:293   0:498   0:422    
 1st Qu.:28.18   1st Qu.:40416   1st Qu.:12.00   1:707   1:502   1:578    
 Median :34.60   Median :50727   Median :15.00                            
 Mean   :34.60   Mean   :50126   Mean   :15.07                            
 3rd Qu.:41.70   3rd Qu.:59808   3rd Qu.:18.00                            
 Max.   :70.70   Max.   :92761   Max.   :20.00                            
 doctor_visits  
 Min.   : 0.00  
 1st Qu.: 3.00  
 Median : 5.00  
 Mean   : 5.13  
 3rd Qu.: 7.00  
 Max.   :21.00  </code></pre>
</div>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"married"</span>,<span class="st">"urban"</span>,<span class="st">"insurance"</span><span class="op">)</span><span class="op">]</span>, <span class="va">table</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$married

  0   1 
498 502 

$urban

  0   1 
293 707 

$insurance

  0   1 
422 578 </code></pre>
</div>
</div>
</div>
<div id="tabset-29-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-29-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co"># C. Data Wrangling</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.describe(include<span class="op">=</span><span class="st">"all"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                age        income  ...  insurance  doctor_visits
count   1000.000000   1000.000000  ...     1000.0    1000.000000
unique          NaN           NaN  ...        2.0            NaN
top             NaN           NaN  ...        1.0            NaN
freq            NaN           NaN  ...      578.0            NaN
mean      34.604300  50125.837370  ...        NaN       5.130000
std       10.013233  14377.333877  ...        NaN       3.102374
min        2.700000  -7020.670000  ...        NaN       0.000000
25%       28.175000  40416.130000  ...        NaN       3.000000
50%       34.600000  50726.830000  ...        NaN       5.000000
75%       41.700000  59808.250000  ...        NaN       7.000000
max       70.700000  92760.620000  ...        NaN      21.000000

[11 rows x 7 columns]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"married"</span>, <span class="st">"urban"</span>, <span class="st">"insurance"</span>]:</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> counts:"</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df[col].value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
married counts:
married
1.0    502
0.0    498
Name: count, dtype: int64

urban counts:
urban
1.0    707
0.0    293
Name: count, dtype: int64

insurance counts:
insurance
1.0    578
0.0    422
Name: count, dtype: int64</code></pre>
</div>
</div>

</div>
</div>
</div>
<p>The variables <code>married</code>, <code>urban</code>, and <code>insurance</code> are categorical with a small number of discrete levels, and can thus be treated as factors.</p>
</details></section><section id="d.-exploratory-data-analysis" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="d.-exploratory-data-analysis">D. Exploratory Data Analysis</h3>
<p>Following the horsehsoe crab example closely:</p>
<ol type="1">
<li><p>Bin <code>age</code> into 10 equally-sized groups, and compute the mean <code>age</code> and <code>doctor_visits</code> of each.</p></li>
<li><p>Overlay the bin means on the scatterplot produced in question B1.</p></li>
<li><p>Comment on the trend: How does doctor visitation vary with age? Does this trend (if any) appear linear?</p></li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary><div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-30-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-1" role="tab" aria-controls="tabset-30-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-30-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-2" role="tab" aria-controls="tabset-30-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-30-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-30-1-tab">
<div class="cell">
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">############################################################</span></span>
<span><span class="co"># D. Exploratory Data Analysis</span></span>
<span><span class="co">############################################################</span></span>
<span></span>
<span><span class="va">df_binned</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_bin <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ntile.html">ntile</a></span><span class="op">(</span><span class="va">age</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age_bin</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    mean_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>,</span>
<span>    mean_visits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">doctor_visits</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">doctor_visits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_binned</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mean_age</span>, y <span class="op">=</span> <span class="va">mean_visits</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_binned</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mean_age</span>, y <span class="op">=</span> <span class="va">mean_visits</span><span class="op">)</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Binned Mean Doctor Visits vs Age"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-30-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-30-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co"># D. Exploratory Data Analysis (Binning)</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"age_bin"</span>] <span class="op">=</span> pd.qcut(df[<span class="st">"age"</span>], <span class="dv">10</span>, labels<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>df_binned <span class="op">=</span> (</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    df.groupby(<span class="st">"age_bin"</span>)</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>      .agg(mean_age<span class="op">=</span>(<span class="st">"age"</span>, <span class="st">"mean"</span>),</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>           mean_visits<span class="op">=</span>(<span class="st">"doctor_visits"</span>, <span class="st">"mean"</span>))</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>      .reset_index()</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>plt.scatter(df[<span class="st">"age"</span>], df[<span class="st">"doctor_visits"</span>], alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>plt.plot(df_binned[<span class="st">"mean_age"</span>], df_binned[<span class="st">"mean_visits"</span>],</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>         color<span class="op">=</span><span class="st">"red"</span>, marker<span class="op">=</span><span class="st">"o"</span>)</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Binned Mean Doctor Visits vs Age"</span>)</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Age"</span>)</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Doctor Visits"</span>)</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>

</div>
</div>
</div>
<p>The number of doctor visits tend to increase with age on average—the binned means show a smooth upward trend that is not strictly linear on the response scale.</p>
</details></section><section id="e.-simple-data-modelling-estimation" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="e.-simple-data-modelling-estimation">E. Simple Data Modelling &amp; Estimation</h3>
<p>We will model the expected number of visits of some individual <span class="math inline">\(i\)</span> as <span class="math inline">\(\log(\lambda_i) = \beta_0 + \beta_1  X_{i,\text{age}}\)</span>.</p>
<ol type="1">
<li><p>Fit the univariate Poisson regression above.</p></li>
<li><p>Print a coefficient table.</p></li>
<li><p>Compute and display <span class="math inline">\(\text{IRR}(\text{exp}(\beta_1))\)</span>.</p></li>
<li><p>Compute and display the 95% confidence interval for <span class="math inline">\(\beta_1\)</span>.</p></li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary><div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-31-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-31-1" role="tab" aria-controls="tabset-31-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-31-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-31-2" role="tab" aria-controls="tabset-31-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-31-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-31-1-tab">
<div class="cell">
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">############################################################</span></span>
<span><span class="co"># E. Simple Data Modelling &amp; Estimation</span></span>
<span><span class="co">############################################################</span></span>
<span></span>
<span><span class="va">mod_uni</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">doctor_visits</span> <span class="op">~</span> <span class="va">age</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_uni</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = doctor_visits ~ age, family = poisson(), data = df)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 0.545217   0.054529   9.999   &lt;2e-16 ***
age         0.030181   0.001401  21.537   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 1822.8  on 999  degrees of freedom
Residual deviance: 1357.5  on 998  degrees of freedom
AIC: 4662.7

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">mod_uni</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>IRR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,</span>
<span>         IRR_low <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">conf.low</span><span class="op">)</span>,</span>
<span>         IRR_high <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">conf.high</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 10
  term   estimate std.error statistic   p.value conf.low conf.high   IRR IRR_low
  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 (Inte…   0.545    0.0545      10.00 1.54e- 23   0.438     0.652   1.72    1.55
2 age      0.0302   0.00140     21.5  7.04e-103   0.0274    0.0329  1.03    1.03
# ℹ 1 more variable: IRR_high &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-31-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-31-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co"># E. Simple Poisson Regression</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>mod_uni <span class="op">=</span> smf.glm(</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"doctor_visits ~ age"</span>,</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df,</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span>sm.families.Poisson()</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>).fit()</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mod_uni.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Generalized Linear Model Regression Results                  
==============================================================================
Dep. Variable:          doctor_visits   No. Observations:                 1000
Model:                            GLM   Df Residuals:                      998
Model Family:                 Poisson   Df Model:                            1
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -2329.3
Date:                Mon, 09 Feb 2026   Deviance:                       1357.5
Time:                        14:27:57   Pearson chi2:                 1.30e+03
No. Iterations:                     4   Pseudo R-squ. (CS):             0.3720
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.5452      0.055      9.999      0.000       0.438       0.652
age            0.0302      0.001     21.536      0.000       0.027       0.033
==============================================================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># IRRs + confidence intervals</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>uni_params <span class="op">=</span> mod_uni.params</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>uni_ci <span class="op">=</span> mod_uni.conf_int()</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>uni_results <span class="op">=</span> pd.DataFrame({</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"estimate"</span>: uni_params,</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"conf_low"</span>: uni_ci[<span class="dv">0</span>],</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"conf_high"</span>: uni_ci[<span class="dv">1</span>],</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IRR"</span>: np.exp(uni_params),</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IRR_low"</span>: np.exp(uni_ci[<span class="dv">0</span>]),</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IRR_high"</span>: np.exp(uni_ci[<span class="dv">1</span>])</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(uni_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           estimate  conf_low  conf_high       IRR   IRR_low  IRR_high
Intercept  0.545217  0.438340   0.652093  1.724982  1.550132  1.919554
age        0.030181  0.027435   0.032928  1.030641  1.027814  1.033476</code></pre>
</div>
</div>

</div>
</div>
</div>
<p>The IRR is the multiplicative change in the expected number of doctor visits associated with a one-year increase in age. The 95% confidence interval for <span class="math inline">\(\beta_1\)</span> does not include zero, indicating a <em>statistically significant</em> association between age and doctor visits.</p>
</details></section><section id="f.-goodness-of-fit" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="f.-goodness-of-fit">F. Goodness of Fit</h3>
<p>Using your univariate model from question E:</p>
<ol type="1">
<li><p>Report the residual deviance and the degrees of freedom.</p></li>
<li><p>Compute a chi-square goodness-of-fit test.</p></li>
<li><p>Compute the Pearson dispersion statistic.</p></li>
<li><p>Is this an overdispersion or underdispersion, and how do you know?</p></li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary><div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-32-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-32-1" role="tab" aria-controls="tabset-32-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-32-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-32-2" role="tab" aria-controls="tabset-32-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-32-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-32-1-tab">
<div class="cell">
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">############################################################</span></span>
<span><span class="co"># F. Goodness of Fit</span></span>
<span><span class="co">############################################################</span></span>
<span></span>
<span><span class="va">res_dev</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">mod_uni</span><span class="op">)</span></span>
<span><span class="va">df_res</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/df.residual.html">df.residual</a></span><span class="op">(</span><span class="va">mod_uni</span><span class="op">)</span></span>
<span><span class="va">gof_pval</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="va">res_dev</span>, <span class="va">df_res</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pearson_X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">mod_uni</span>, type <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">dispersion</span> <span class="op">&lt;-</span> <span class="va">pearson_X2</span> <span class="op">/</span> <span class="va">df_res</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Residual deviance ="</span>, <span class="va">res_dev</span>, <span class="st">"df ="</span>, <span class="va">df_res</span>, <span class="st">"GOF p-value ="</span>, <span class="va">gof_pval</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Residual deviance = 1357.524 df = 998 GOF p-value = 1.957323e-13 </code></pre>
</div>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Pearson X2 ="</span>, <span class="va">pearson_X2</span>, <span class="st">"Dispersion ="</span>, <span class="va">dispersion</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pearson X2 = 1299.367 Dispersion = 1.301971 </code></pre>
</div>
</div>
</div>
<div id="tabset-32-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-32-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="co"># F. Goodness of Fit</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>res_dev <span class="op">=</span> mod_uni.deviance</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>df_res  <span class="op">=</span> mod_uni.df_resid</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>gof_pval <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> chi2.cdf(res_dev, df_res)</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>pearson_X2 <span class="op">=</span> np.<span class="bu">sum</span>(mod_uni.resid_pearson<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>dispersion <span class="op">=</span> pearson_X2 <span class="op">/</span> df_res</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Residual deviance = </span><span class="sc">{</span>res_dev<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Residual deviance = 1357.524</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"df = </span><span class="sc">{</span>df_res<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>df = 998</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"GOF p-value = </span><span class="sc">{</span>gof_pval<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GOF p-value = 0.0000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Pearson X2 = </span><span class="sc">{</span>pearson_X2<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pearson X2 = 1299.367</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dispersion = </span><span class="sc">{</span>dispersion<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dispersion = 1.302</code></pre>
</div>
</div>

</div>
</div>
</div>
<p>The dispersion statistic is greater than 1, indicating mild <em>overdispersion</em> relative to the Poisson assumption.</p>
</details></section><section id="g.-inference" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="g.-inference">G. Inference</h3>
<ol type="1">
<li><p>Perform the Wald test for <span class="math inline">\(\beta_1\)</span>.</p></li>
<li><p>Determine the 95% confidence interval for the IRR computed in question E3.</p></li>
<li>
<p>Explain how the estimated coefficient <span class="math inline">\(\hat{\beta}_1\)</span> affects the relationship between age and the expected number of doctor visits. In particular:</p>
<ol type="a">
<li><p>Describe how the expected number of doctor visits changes as age increases.</p></li>
<li><p>Is the relationship linear, exponential, or something else? Explain your reasoning.</p></li>
<li><p>Do equal increases in age lead to multiplicative or additive changes in the expected number of visits? Why?</p></li>
</ol>
</li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary><div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-33-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-33-1" role="tab" aria-controls="tabset-33-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-33-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-33-2" role="tab" aria-controls="tabset-33-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-33-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-33-1-tab">
<div class="cell">
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">############################################################</span></span>
<span><span class="co"># G. Inference</span></span>
<span><span class="co">############################################################</span></span>
<span></span>
<span><span class="va">coef_uni</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">mod_uni</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">coef_uni</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term        estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)   0.545    0.0545      10.00 1.54e- 23   0.438     0.652 
2 age           0.0302   0.00140     21.5  7.04e-103   0.0274    0.0329</code></pre>
</div>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"IRR for age ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod_uni</span><span class="op">)</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>IRR for age = 1.030641 </code></pre>
</div>
</div>
<p>The estimated coefficient <span class="math inline">\(\hat{\beta}_1\)</span> is included in the model through the log link function, <span class="math display">\[
\log(\lambda_i) = \beta_0 + \beta_1 \,\text{age}_i.
\]</span> This implies that the expected number of doctor visits satisfies <span class="math display">\[
\lambda_i = \exp(\beta_0)\exp(\beta_1 \,\text{age}_i).
\]</span></p>
<p>As age increases, the expected number of doctor visits increases <strong>multiplicatively</strong> rather than additively: Each one-year increase in age multiplies the expected number of visits by a constant factor equal to the incidence rate ratio (IRR), i.e.&nbsp;<span class="math inline">\(\exp(\hat{\beta}_1)\)</span>.</p>
<p>Therefore, the relationship between age and expected doctor visits is <strong>exponential in the response scale</strong> and <strong>linear in the log scale</strong>. Equal increases in age produce proportionally equal changes in the expected count (a feature of all Poisson regression models).</p>
</div>
<div id="tabset-33-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-33-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="co"># G. Inference</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"IRR for age ="</span>, np.exp(mod_uni.params[<span class="st">"age"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>IRR for age = 1.0306414682533183</code></pre>
</div>
</div>

<p>The estimated coefficient <span class="math inline">\(\hat{\beta}_1\)</span> is included in the model through the log link function, <span class="math display">\[
\log(\lambda_i) = \beta_0 + \beta_1 \,\text{age}_i.
\]</span> This implies that the expected number of doctor visits satisfies <span class="math display">\[
\lambda_i = \exp(\beta_0)\exp(\beta_1 \,\text{age}_i).
\]</span></p>
<p>As age increases, the expected number of doctor visits increases <strong>multiplicatively</strong> rather than additively: Each one-year increase in age multiplies the expected number of visits by a constant factor equal to the incidence rate ratio (IRR), i.e.&nbsp;<span class="math inline">\(\exp(\hat{\beta}_1)\)</span>.</p>
<p>Therefore, the relationship between age and expected doctor visits is <strong>exponential in the response scale</strong> and <strong>linear in the log scale</strong>. Equal increases in age produce proportionally equal changes in the expected count (a feature of all Poisson regression models).</p>
</div>
</div>
</div>
</details></section><section id="h.-multivariate-poisson-regression" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="h.-multivariate-poisson-regression">H. Multivariate Poisson Regression</h3>
<p>Now, extend the model to: <span class="math display">\[\log(\lambda_i) = \beta_0 + \sum_{j}\beta_i X_{i,j},\]</span> where <span class="math inline">\(j\)</span> runs over <code>age</code>, <code>income</code>, <code>education_years</code>, <code>married</code>, <code>urban</code>, and <code>insurance</code>.</p>
<ol type="1">
<li><p>Fit the multivariable model above.</p></li>
<li><p>Compute the IRRs and 95% confidence intervals.</p></li>
<li><p>Interpret the effect of insurance (insured or not).</p></li>
<li><p>Which predictors are the most significant? How do you know?</p></li>
<li><p>Fit another model with <code>age * insurance</code>, and perform a likelihood-ratio test vs the additive model above.</p></li>
<li><p>Based on the result, does insurance modify the effect of age?</p></li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary><div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-34-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-34-1" role="tab" aria-controls="tabset-34-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-34-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-34-2" role="tab" aria-controls="tabset-34-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-34-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-34-1-tab">
<div class="cell">
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">############################################################</span></span>
<span><span class="co"># H. Multivariate Poisson Regression</span></span>
<span><span class="co">############################################################</span></span>
<span></span>
<span><span class="va">form_multi</span> <span class="op">&lt;-</span> <span class="va">doctor_visits</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">education_years</span> <span class="op">+</span></span>
<span>  <span class="va">married</span> <span class="op">+</span> <span class="va">urban</span> <span class="op">+</span> <span class="va">insurance</span></span>
<span></span>
<span><span class="va">mod_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">form_multi</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod_multi</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = form_multi, family = poisson(), data = df)

Coefficients:
                  Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)      1.710e-02  1.073e-01   0.159    0.873    
age              2.913e-02  1.396e-03  20.863  &lt; 2e-16 ***
income          -1.165e-05  9.493e-07 -12.276  &lt; 2e-16 ***
education_years  5.647e-02  4.571e-03  12.353  &lt; 2e-16 ***
married1         1.229e-01  2.814e-02   4.369 1.25e-05 ***
urban1           1.742e-01  3.181e-02   5.474 4.40e-08 ***
insurance1       1.359e-01  2.872e-02   4.730 2.24e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 1822.8  on 999  degrees of freedom
Residual deviance: 1002.2  on 993  degrees of freedom
AIC: 4317.3

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">mod_multi</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>IRR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,</span>
<span>         IRR_low <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">conf.low</span><span class="op">)</span>,</span>
<span>         IRR_high <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">conf.high</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 10
  term    estimate std.error statistic  p.value conf.low conf.high   IRR IRR_low
  &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 (Inter…  1.71e-2   1.07e-1     0.159 8.73e- 1 -1.94e-1   2.27e-1 1.02    0.824
2 age      2.91e-2   1.40e-3    20.9   1.15e-96  2.64e-2   3.19e-2 1.03    1.03 
3 income  -1.17e-5   9.49e-7   -12.3   1.22e-34 -1.35e-5  -9.79e-6 1.000   1.000
4 educat…  5.65e-2   4.57e-3    12.4   4.67e-35  4.75e-2   6.54e-2 1.06    1.05 
5 marrie…  1.23e-1   2.81e-2     4.37  1.25e- 5  6.78e-2   1.78e-1 1.13    1.07 
6 urban1   1.74e-1   3.18e-2     5.47  4.40e- 8  1.12e-1   2.37e-1 1.19    1.12 
7 insura…  1.36e-1   2.87e-2     4.73  2.24e- 6  7.97e-2   1.92e-1 1.15    1.08 
# ℹ 1 more variable: IRR_high &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Interaction: age * insurance</span></span>
<span><span class="va">mod_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">doctor_visits</span> <span class="op">~</span> <span class="va">age</span> <span class="op">*</span> <span class="va">insurance</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">education_years</span> <span class="op">+</span></span>
<span>                 <span class="va">married</span> <span class="op">+</span> <span class="va">urban</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">mod_multi</span>, <span class="va">mod_int</span>, test <span class="op">=</span> <span class="st">"Chisq"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: doctor_visits ~ age + income + education_years + married + urban + 
    insurance
Model 2: doctor_visits ~ age * insurance + income + education_years + 
    married + urban
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
1       993     1002.2                     
2       992     1001.8  1  0.43642   0.5089</code></pre>
</div>
</div>
</div>
<div id="tabset-34-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-34-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="co"># H. Multivariate Poisson Regression</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>formula_multi <span class="op">=</span> (</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"doctor_visits ~ age + income + education_years "</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"+ married + urban + insurance"</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>mod_multi <span class="op">=</span> smf.glm(</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>    formula_multi,</span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df,</span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span>sm.families.Poisson()</span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>).fit()</span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mod_multi.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Generalized Linear Model Regression Results                  
==============================================================================
Dep. Variable:          doctor_visits   No. Observations:                 1000
Model:                            GLM   Df Residuals:                      993
Model Family:                 Poisson   Df Model:                            6
Link Function:                    Log   Scale:                          1.0000
Method:                          IRLS   Log-Likelihood:                -2151.7
Date:                Mon, 09 Feb 2026   Deviance:                       1002.2
Time:                        14:27:57   Pearson chi2:                     940.
No. Iterations:                     4   Pseudo R-squ. (CS):             0.5598
Covariance Type:            nonrobust                                         
====================================================================================
                       coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------------
Intercept            0.0171      0.107      0.159      0.873      -0.193       0.227
married[T.1.0]       0.1229      0.028      4.369      0.000       0.068       0.178
urban[T.1.0]         0.1742      0.032      5.474      0.000       0.112       0.237
insurance[T.1.0]     0.1359      0.029      4.730      0.000       0.080       0.192
age                  0.0291      0.001     20.863      0.000       0.026       0.032
income           -1.165e-05   9.49e-07    -12.276      0.000   -1.35e-05   -9.79e-06
education_years      0.0565      0.005     12.353      0.000       0.048       0.065
====================================================================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>multi_params <span class="op">=</span> mod_multi.params</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>multi_ci <span class="op">=</span> mod_multi.conf_int()</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>multi_results <span class="op">=</span> pd.DataFrame({</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"estimate"</span>: multi_params,</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"conf_low"</span>: multi_ci[<span class="dv">0</span>],</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"conf_high"</span>: multi_ci[<span class="dv">1</span>],</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IRR"</span>: np.exp(multi_params),</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IRR_low"</span>: np.exp(multi_ci[<span class="dv">0</span>]),</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IRR_high"</span>: np.exp(multi_ci[<span class="dv">1</span>])</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(multi_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  estimate  conf_low  conf_high       IRR   IRR_low  IRR_high
Intercept         0.017104 -0.193212   0.227420  1.017251  0.824308  1.255357
married[T.1.0]    0.122949  0.067791   0.178106  1.130826  1.070142  1.194953
urban[T.1.0]      0.174160  0.111803   0.236516  1.190246  1.118293  1.266828
insurance[T.1.0]  0.135868  0.079568   0.192167  1.145530  1.082820  1.211873
age               0.029131  0.026394   0.031868  1.029559  1.026746  1.032381
income           -0.000012 -0.000014  -0.000010  0.999988  0.999986  0.999990
education_years   0.056471  0.047511   0.065431  1.058096  1.048658  1.067619</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interaction model</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>mod_int <span class="op">=</span> smf.glm(</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"doctor_visits ~ age * insurance + income + education_years + married + urban"</span>,</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df,</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span>sm.families.Poisson()</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>).fit()</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>lr_stat <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (mod_int.llf <span class="op">-</span> mod_multi.llf)</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>df_diff <span class="op">=</span> mod_int.df_model <span class="op">-</span> mod_multi.df_model</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>p_lr <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> chi2.cdf(lr_stat, df_diff)</span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"LR test statistic ="</span>, lr_stat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LR test statistic = 0.43641994780045934</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"df ="</span>, df_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>df = 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"p-value ="</span>, p_lr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p-value = 0.5088554748118505</code></pre>
</div>
</div>

</div>
</div>
</div>
<p>Holding all other variables constant, insured individuals are expected to have about 14.6% more doctor visits than uninsured individuals (IRR ≈ 1.15). The 95% confidence interval for the IRR does not include 1, indicating this effect is <strong>statistically significant</strong>.</p>
<p>The most statistically significant predictors are <code>age</code>, <code>education_years</code>, <code>married</code>, <code>urban</code>, and <code>insurance</code>, as their confidence intervals for the IRR do not include 1. Among these, <code>age</code> shows the most precise and consistent effect. <code>education_years</code> also shows a clear positive association with <code>doctor_visits</code>. <code>income</code> has a very small effect size despite being statistically significant.</p>
</details></section><section id="i.-prediction-kl-divergence" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="i.-prediction-kl-divergence">I. Prediction &amp; KL Divergence</h3>
<p>Using the multivariate model from question H:</p>
<ol type="1">
<li><p>Predict the expected number of doctor visits for a grid of age values, from 20 to 80.</p></li>
<li><p>Plot predicted visits for insured and uninsured groups, including 95% confidence interval bands.</p></li>
<li><p>Compute the KL divergence. How does this value reflect the model fit?</p></li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary><div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-35-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-35-1" role="tab" aria-controls="tabset-35-1" aria-selected="true">R Code</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-35-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-35-2" role="tab" aria-controls="tabset-35-2" aria-selected="false">Python Code</a></li>
</ul>
<div class="tab-content">
<div id="tabset-35-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-35-1-tab">
<div class="cell">
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">############################################################</span></span>
<span><span class="co"># I. Prediction &amp; KL Divergence</span></span>
<span><span class="co">############################################################</span></span>
<span></span>
<span><span class="co"># Prediction grid for ages</span></span>
<span><span class="va">age_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">age</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">age</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span></span>
<span>  age <span class="op">=</span> <span class="va">age_grid</span>,</span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">income</span><span class="op">)</span>,</span>
<span>  education_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">education_years</span><span class="op">)</span>,</span>
<span>  married <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">married</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  urban <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">urban</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  insurance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">insurance</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred_link</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_multi</span>, <span class="va">newdata</span>, type <span class="op">=</span> <span class="st">"link"</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">newdata</span><span class="op">$</span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">pred_link</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">newdata</span><span class="op">$</span><span class="va">lower95</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">pred_link</span><span class="op">$</span><span class="va">fit</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">pred_link</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="va">newdata</span><span class="op">$</span><span class="va">upper95</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">pred_link</span><span class="op">$</span><span class="va">fit</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">pred_link</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">newdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">fit</span>, color <span class="op">=</span> <span class="va">insurance</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower95</span>, ymax <span class="op">=</span> <span class="va">upper95</span>, fill <span class="op">=</span> <span class="va">insurance</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.15</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Predicted Doctor Visits"</span>, title <span class="op">=</span> <span class="st">"Predicted Visits by Age and Insurance"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># KL Divergence</span></span>
<span><span class="va">lambda_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">mod_multi</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">doctor_visits</span></span>
<span><span class="va">KL_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="fl">0</span>,</span>
<span>               <span class="op">-</span><span class="va">y</span> <span class="op">+</span> <span class="va">lambda_hat</span>,</span>
<span>               <span class="va">y</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">y</span> <span class="op">/</span> <span class="va">lambda_hat</span><span class="op">)</span> <span class="op">-</span> <span class="va">y</span> <span class="op">+</span> <span class="va">lambda_hat</span><span class="op">)</span></span>
<span><span class="va">KL_avg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">KL_i</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Average KL divergence ="</span>, <span class="va">KL_avg</span>, <span class="st">"\n"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average KL divergence = 0.5010995 </code></pre>
</div>
</div>
</div>
<div id="tabset-35-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-35-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I. Prediction &amp; KL Divergence</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co">############################################################</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>age_grid <span class="op">=</span> np.linspace(df[<span class="st">"age"</span>].<span class="bu">min</span>(), df[<span class="st">"age"</span>].<span class="bu">max</span>(), <span class="dv">100</span>)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>newdata <span class="op">=</span> pd.DataFrame({</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"age"</span>: np.repeat(age_grid, df[<span class="st">"insurance"</span>].cat.categories.size),</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"income"</span>: df[<span class="st">"income"</span>].mean(),</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"education_years"</span>: df[<span class="st">"education_years"</span>].mean(),</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"married"</span>: df[<span class="st">"married"</span>].cat.categories[<span class="dv">0</span>],</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"urban"</span>: df[<span class="st">"urban"</span>].cat.categories[<span class="dv">0</span>],</span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"insurance"</span>: np.tile(df[<span class="st">"insurance"</span>].cat.categories, <span class="dv">100</span>)</span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure categories match</span></span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"married"</span>, <span class="st">"urban"</span>, <span class="st">"insurance"</span>]:</span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a>    newdata[col] <span class="op">=</span> newdata[col].astype(<span class="st">"category"</span>)</span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a>    newdata[col] <span class="op">=</span> newdata[col].cat.set_categories(df[col].cat.categories)</span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> mod_multi.get_prediction(newdata)</span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a>pred_summary <span class="op">=</span> pred.summary_frame()</span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-24"><a href="#cb135-24" aria-hidden="true" tabindex="-1"></a>newdata[<span class="st">"fit"</span>] <span class="op">=</span> np.exp(pred_summary[<span class="st">"mean"</span>])</span>
<span id="cb135-25"><a href="#cb135-25" aria-hidden="true" tabindex="-1"></a>newdata[<span class="st">"lower95"</span>] <span class="op">=</span> np.exp(pred_summary[<span class="st">"mean_ci_lower"</span>])</span>
<span id="cb135-26"><a href="#cb135-26" aria-hidden="true" tabindex="-1"></a>newdata[<span class="st">"upper95"</span>] <span class="op">=</span> np.exp(pred_summary[<span class="st">"mean_ci_upper"</span>])</span>
<span id="cb135-27"><a href="#cb135-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-28"><a href="#cb135-28" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">5</span>))</span>
<span id="cb135-29"><a href="#cb135-29" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>newdata, x<span class="op">=</span><span class="st">"age"</span>, y<span class="op">=</span><span class="st">"fit"</span>, hue<span class="op">=</span><span class="st">"insurance"</span>)</span>
<span id="cb135-30"><a href="#cb135-30" aria-hidden="true" tabindex="-1"></a>plt.fill_between(</span>
<span id="cb135-31"><a href="#cb135-31" aria-hidden="true" tabindex="-1"></a>    newdata[<span class="st">"age"</span>],</span>
<span id="cb135-32"><a href="#cb135-32" aria-hidden="true" tabindex="-1"></a>    newdata[<span class="st">"lower95"</span>],</span>
<span id="cb135-33"><a href="#cb135-33" aria-hidden="true" tabindex="-1"></a>    newdata[<span class="st">"upper95"</span>],</span>
<span id="cb135-34"><a href="#cb135-34" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.15</span></span>
<span id="cb135-35"><a href="#cb135-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb135-36"><a href="#cb135-36" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Predicted Doctor Visits"</span>)</span>
<span id="cb135-37"><a href="#cb135-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Predicted Visits by Age and Insurance"</span>)</span>
<span id="cb135-38"><a href="#cb135-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-classical-poisson_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KL divergence</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>lambda_hat <span class="op">=</span> mod_multi.fittedvalues.values</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">"doctor_visits"</span>].values</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>KL_i <span class="op">=</span> np.where(</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>    y <span class="op">==</span> <span class="dv">0</span>,</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span>y <span class="op">+</span> lambda_hat,</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>    y <span class="op">*</span> np.log(y <span class="op">/</span> lambda_hat) <span class="op">-</span> y <span class="op">+</span> lambda_hat</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:5: RuntimeWarning: divide by zero encountered in log
&lt;string&gt;:5: RuntimeWarning: invalid value encountered in multiply</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>KL_avg <span class="op">=</span> KL_i.mean()</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Average KL divergence ="</span>, KL_avg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average KL divergence = 0.5010994579709896</code></pre>
</div>
</div>

</div>
</div>
</div>
<p>A smaller average KL divergence indicates that the fitted Poisson model produces predicted counts that are close to the observed data, reflecting better model fit.</p>
</details></section><section id="j.-storytelling" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="j.-storytelling">J. Storytelling</h3>
<p>The goal of this analysis was to understand how individual characteristics are associated with the expected number of doctor visits.</p>
<ol type="1">
<li><p>Summarize the main findings of the Poisson regression analysis. Which variables are most strongly associated with doctor visitation, and in what direction?</p></li>
<li><p>How do age, insurance status, and education jointly shape expected doctor visits? Describe the relationship in substantive terms rather than model coefficients.</p></li>
<li><p>Assess whether the classical Poisson model appears to be an appropriate choice for this dataset. What evidence supports or weakens this conclusion?</p></li>
<li><p>Based on the fitted model, what broad conclusions can be drawn about patterns of healthcare use in this population?</p></li>
</ol>
<details><summary><strong>Click to reveal answer</strong>
</summary><p>The Poisson regression analysis shows that doctor visitation increases systematically with age, education, insurance coverage, marital status, and urban residence. Within these, age and education show strong and precise positive associations, while having insurance coverage is associated with an increase in expected visits (vs being uninsured).</p>
<p>Older individuals and those with higher levels of education tend to visit doctors more frequently, and insured individuals have higher expected doctor use across all ages. Insurance primarily shifts the overall level of doctor visits upward rather than changing how visits increase with age.</p>
<p>The classical Poisson model appears reasonably appropriate for this dataset. The outcome variable is a non-negative count, the mean–variance relationship is approximately consistent with Poisson assumptions, and goodness-of-fit diagnostics show only mild overdispersion. Alternative models could be considered, but there is no strong evidence that the Poisson model is fundamentally misspecified.</p>
Overall, the results suggest that healthcare use in this population is strongly patterned by age and socioeconomic factors, with insurance coverage playing an important role in increasing access to healthcare care. The model provides a coherent and interpretable summary of how these factors relate to doctor visitation rates.
</details>

</section>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/alexrod61\.github\.io\/regression-cookbook\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="alexrod61/regression-cookbook" data-repo-id="R_kgDOMSJoUA" data-category="General" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../book/09-binomial-logistic.html" class="pagination-link" aria-label="Binomial Logistic Regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Binomial Logistic Regression</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../book/11-negative-binomial.html" class="pagination-link" aria-label="Negative Binomial Regression">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Negative Binomial Regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025; G. Alexi Rodríguez-Arelis, Andy Tai, and Ben Chen</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/alexrod61/regression-cookbook/edit/main/book/10-classical-poisson.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/alexrod61/regression-cookbook/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/alexrod61/regression-cookbook/blob/main/book/10-classical-poisson.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>